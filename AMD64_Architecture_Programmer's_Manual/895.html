<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p895" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_895{left:96px;bottom:47px;letter-spacing:-0.11px;word-spacing:0.01px;}
#t2_895{left:808px;bottom:47px;letter-spacing:0.17px;}
#t3_895{left:96px;bottom:1116px;letter-spacing:-0.17px;word-spacing:2.66px;}
#t4_895{left:684px;bottom:1116px;letter-spacing:-0.17px;word-spacing:0.06px;}
#t5_895{left:96px;bottom:1038px;letter-spacing:0.12px;word-spacing:-0.45px;}
#t6_895{left:96px;bottom:1017px;letter-spacing:0.11px;word-spacing:-0.44px;}
#t7_895{left:96px;bottom:996px;letter-spacing:0.09px;word-spacing:-0.44px;}
#t8_895{left:96px;bottom:974px;letter-spacing:0.12px;word-spacing:-0.45px;}
#t9_895{left:96px;bottom:939px;letter-spacing:0.12px;word-spacing:-0.46px;}
#ta_895{left:96px;bottom:918px;letter-spacing:0.11px;word-spacing:-0.47px;}
#tb_895{left:96px;bottom:896px;letter-spacing:0.14px;word-spacing:-0.41px;}
#tc_895{left:96px;bottom:875px;letter-spacing:0.1px;word-spacing:-0.74px;}
#td_895{left:96px;bottom:853px;letter-spacing:0.11px;word-spacing:-0.5px;}
#te_895{left:96px;bottom:832px;letter-spacing:0.09px;word-spacing:-0.42px;}
#tf_895{left:96px;bottom:797px;letter-spacing:0.09px;word-spacing:-0.45px;}
#tg_895{left:96px;bottom:775px;letter-spacing:0.08px;word-spacing:-0.41px;}
#th_895{left:96px;bottom:754px;letter-spacing:0.06px;word-spacing:-0.38px;}
#ti_895{left:96px;bottom:719px;letter-spacing:0.1px;word-spacing:-0.51px;}
#tj_895{left:96px;bottom:698px;letter-spacing:0.12px;word-spacing:-0.45px;}
#tk_895{left:96px;bottom:676px;letter-spacing:0.11px;word-spacing:-0.86px;}
#tl_895{left:96px;bottom:655px;letter-spacing:0.11px;word-spacing:-0.45px;}
#tm_895{left:96px;bottom:633px;letter-spacing:0.13px;word-spacing:-0.49px;}
#tn_895{left:96px;bottom:612px;letter-spacing:0.09px;word-spacing:-0.42px;}
#to_895{left:96px;bottom:591px;letter-spacing:0.13px;word-spacing:-0.45px;}
#tp_895{left:96px;bottom:555px;letter-spacing:0.1px;word-spacing:-0.81px;}
#tq_895{left:96px;bottom:534px;letter-spacing:0.11px;word-spacing:-0.47px;}
#tr_895{left:96px;bottom:513px;letter-spacing:0.09px;word-spacing:-0.43px;}
#ts_895{left:96px;bottom:491px;letter-spacing:0.11px;word-spacing:-0.45px;}
#tt_895{left:96px;bottom:470px;letter-spacing:0.12px;word-spacing:-0.46px;}
#tu_895{left:96px;bottom:435px;letter-spacing:0.08px;word-spacing:-0.55px;}
#tv_895{left:96px;bottom:413px;letter-spacing:0.11px;word-spacing:-0.44px;}
#tw_895{left:96px;bottom:392px;letter-spacing:0.09px;word-spacing:-0.42px;}
#tx_895{left:96px;bottom:370px;letter-spacing:0.13px;word-spacing:-0.45px;}
#ty_895{left:96px;bottom:349px;letter-spacing:0.12px;word-spacing:-0.45px;}
#tz_895{left:96px;bottom:314px;letter-spacing:0.08px;word-spacing:-0.41px;}
#t10_895{left:96px;bottom:293px;letter-spacing:0.05px;word-spacing:-0.4px;}
#t11_895{left:96px;bottom:271px;letter-spacing:0.07px;word-spacing:-1.05px;}
#t12_895{left:96px;bottom:250px;letter-spacing:0.11px;word-spacing:-0.44px;}
#t13_895{left:96px;bottom:228px;letter-spacing:0.12px;word-spacing:-0.45px;}
#t14_895{left:96px;bottom:207px;letter-spacing:0.13px;word-spacing:-1.1px;}
#t15_895{left:96px;bottom:186px;letter-spacing:0.08px;word-spacing:-0.41px;}
#t16_895{left:396px;bottom:12px;letter-spacing:0.16px;}

.s1_895{font-size:17px;font-family:Arial-Italic_62c;color:#000;}
.s2_895{font-size:18px;font-family:Arial-BoldItalic_623;color:#000;}
.s3_895{font-size:17px;font-family:Arial-BoldItalic_623;color:#000;}
.s4_895{font-size:18px;font-family:TimesNewRoman_61y;color:#000;}
.s5_895{font-size:18px;font-family:Arial_62w;color:#00AB00;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts895" type="text/css" >

@font-face {
	font-family: Arial-BoldItalic_623;
	src: url("fonts/Arial-BoldItalic_623.woff") format("woff");
}

@font-face {
	font-family: Arial-Italic_62c;
	src: url("fonts/Arial-Italic_62c.woff") format("woff");
}

@font-face {
	font-family: Arial_62w;
	src: url("fonts/Arial_62w.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_61y;
	src: url("fonts/TimesNewRoman_61y.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg895Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg895" style="-webkit-user-select: none;"><object width="935" height="1210" data="895/895.svg" type="image/svg+xml" id="pdf895" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_895" class="t s1_895">Software Debug and Performance Resources </span><span id="t2_895" class="t s2_895">440 </span>
<span id="t3_895" class="t s3_895">24593—Rev. 3.41—June 2023 </span><span id="t4_895" class="t s3_895">AMD64 Technology </span>
<span id="t5_895" class="t s4_895">An application should periodically remove event records from the ring buffer and advance the tail </span>
<span id="t6_895" class="t s4_895">pointer. (If the application does not process the event records quickly enough or often enough, the </span>
<span id="t7_895" class="t s4_895">LWP hardware will detect that the ring buffer is full and will miss events.) There are two ways to </span>
<span id="t8_895" class="t s4_895">process the gathered events: interrupts or polling. </span>
<span id="t9_895" class="t s4_895">The application can wait until a threshold interrupt occurs to process the event records in the ring </span>
<span id="ta_895" class="t s4_895">buffer. This requires OS or driver support. (As a consequence, interrupts can only be enabled if a </span>
<span id="tb_895" class="t s4_895">kernel mode routine allows it; see “LWP_CFG—LWP Configuration MSR” on page 454) One usage </span>
<span id="tc_895" class="t s4_895">model is to associate the LWP interrupt with a semaphore or mutex. When the interrupt occurs, the OS </span>
<span id="td_895" class="t s4_895">or driver signals the associated object. A thread waiting on the object wakes up and empties the ring </span>
<span id="te_895" class="t s4_895">buffer. Other models are possible, of course. </span>
<span id="tf_895" class="t s4_895">Alternatively, the application can have a thread that periodically polls the ring buffer. The polling </span>
<span id="tg_895" class="t s4_895">thread need not be part of the process that is using LWP. It can be in a separate process that shares the </span>
<span id="th_895" class="t s4_895">memory containing the LWP control block and ring buffer. </span>
<span id="ti_895" class="t s4_895">Access to the ring buffer uses a lockless protocol between the LWP hardware and the application. The </span>
<span id="tj_895" class="t s4_895">hardware owns the head pointer and the area in the ring buffer from the head pointer up to (but not </span>
<span id="tk_895" class="t s4_895">including) the tail pointer. The application must not modify the head pointer nor rely on any data in the </span>
<span id="tl_895" class="t s4_895">area of the ring buffer owned by the hardware. If the application has a stale value for the head pointer, </span>
<span id="tm_895" class="t s4_895">it may miss an existing event record but it will never read invalid data. When the application is done </span>
<span id="tn_895" class="t s4_895">emptying the ring buffer, it should refresh its copy of the head pointer to see if the LWP hardware has </span>
<span id="to_895" class="t s4_895">added any new event records. </span>
<span id="tp_895" class="t s4_895">Similarly, the application owns the tail pointer and the area in the ring buffer from the tail pointer up to </span>
<span id="tq_895" class="t s4_895">(but not including) the head pointer. The hardware will never modify the tail pointer or overwrite the </span>
<span id="tr_895" class="t s4_895">data in that region of the ring buffer. If the hardware has a stale value for the tail pointer, it may </span>
<span id="ts_895" class="t s4_895">consider that the ring buffer is full or at its threshold, but it will never overwrite valid data. Instead, it </span>
<span id="tt_895" class="t s4_895">refreshes its copy of the tail pointer and rechecks to see if the full or threshold condition still applies. </span>
<span id="tu_895" class="t s4_895">When LWP is in continuous mode, this lockless protocol does not work, since the LWP hardware may </span>
<span id="tv_895" class="t s4_895">overwrite the event records in the ring buffer when it advances the head pointer past the tail pointer. </span>
<span id="tw_895" class="t s4_895">Because of this, the application must stop LWP before removing event records from the ring buffer. </span>
<span id="tx_895" class="t s4_895">This prevents the hardware from wrapping through the ring buffer asynchronously from the </span>
<span id="ty_895" class="t s4_895">application’s attempt to remove data from it. </span>
<span id="tz_895" class="t s4_895">To use continuous mode properly, the application should set LWPCB.MissedEvents to 0 and set the </span>
<span id="t10_895" class="t s4_895">head and tail pointers to the start of the ring buffer before starting LWP. To empty the ring buffer, the </span>
<span id="t11_895" class="t s4_895">application should stop LWP. If LWPCB.MissedEvents is 0, the buffer did not wrap and there are event </span>
<span id="t12_895" class="t s4_895">records starting at the tail pointer and continuing up to (but not including) the head pointer. If </span>
<span id="t13_895" class="t s4_895">MissedEvents is not 0, the buffer wrapped and there are event records starting with the oldest one </span>
<span id="t14_895" class="t s4_895">pointed to by the head pointer and continuing (possibly wrapping) all the way around to the newest one </span>
<span id="t15_895" class="t s4_895">just before the head pointer. </span>
<span id="t16_895" class="t s5_895">[AMD Public Use] </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
