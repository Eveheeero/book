<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p932" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_932{left:96px;bottom:48px;letter-spacing:-0.15px;}
#t2_932{left:500px;bottom:48px;letter-spacing:-0.11px;word-spacing:0.01px;}
#t3_932{left:96px;bottom:1116px;letter-spacing:-0.17px;word-spacing:0.06px;}
#t4_932{left:601px;bottom:1116px;letter-spacing:-0.17px;word-spacing:2.71px;}
#t5_932{left:96px;bottom:1038px;letter-spacing:0.1px;word-spacing:-0.43px;}
#t6_932{left:96px;bottom:1017px;letter-spacing:0.08px;word-spacing:-0.41px;}
#t7_932{left:96px;bottom:977px;letter-spacing:0.13px;}
#t8_932{left:173px;bottom:977px;letter-spacing:0.16px;}
#t9_932{left:96px;bottom:945px;letter-spacing:0.13px;word-spacing:-0.46px;}
#ta_932{left:96px;bottom:924px;letter-spacing:0.1px;word-spacing:-0.63px;}
#tb_932{left:96px;bottom:902px;letter-spacing:0.1px;word-spacing:-0.43px;}
#tc_932{left:96px;bottom:881px;letter-spacing:0.1px;word-spacing:-0.91px;}
#td_932{left:96px;bottom:860px;letter-spacing:0.05px;word-spacing:-0.37px;}
#te_932{left:96px;bottom:820px;letter-spacing:0.13px;}
#tf_932{left:173px;bottom:820px;letter-spacing:0.15px;}
#tg_932{left:96px;bottom:788px;letter-spacing:0.1px;word-spacing:-0.87px;}
#th_932{left:96px;bottom:766px;letter-spacing:0.1px;word-spacing:-0.43px;}
#ti_932{left:96px;bottom:745px;letter-spacing:0.1px;word-spacing:-0.43px;}
#tj_932{left:96px;bottom:724px;letter-spacing:0.13px;word-spacing:-0.45px;}
#tk_932{left:96px;bottom:684px;letter-spacing:0.13px;}
#tl_932{left:173px;bottom:684px;letter-spacing:0.13px;word-spacing:-0.14px;}
#tm_932{left:96px;bottom:652px;letter-spacing:0.09px;word-spacing:-0.41px;}
#tn_932{left:96px;bottom:630px;letter-spacing:0.11px;word-spacing:-0.45px;}
#to_932{left:96px;bottom:609px;letter-spacing:0.1px;word-spacing:-0.43px;}
#tp_932{left:96px;bottom:574px;letter-spacing:0.09px;word-spacing:-0.42px;}
#tq_932{left:96px;bottom:552px;letter-spacing:0.09px;word-spacing:-0.43px;}
#tr_932{left:96px;bottom:531px;letter-spacing:0.13px;word-spacing:-0.46px;}
#ts_932{left:96px;bottom:496px;letter-spacing:0.1px;word-spacing:-0.44px;}
#tt_932{left:96px;bottom:474px;letter-spacing:0.13px;word-spacing:-0.45px;}
#tu_932{left:279px;bottom:484px;letter-spacing:-0.17px;}
#tv_932{left:294px;bottom:475px;letter-spacing:0.12px;word-spacing:-0.46px;}
#tw_932{left:528px;bottom:475px;letter-spacing:0.09px;}
#tx_932{left:637px;bottom:475px;letter-spacing:0.14px;word-spacing:-0.45px;}
#ty_932{left:691px;bottom:484px;letter-spacing:-0.17px;}
#tz_932{left:707px;bottom:475px;letter-spacing:0.13px;}
#t10_932{left:96px;bottom:435px;letter-spacing:0.13px;}
#t11_932{left:173px;bottom:435px;letter-spacing:0.16px;word-spacing:0.04px;}
#t12_932{left:96px;bottom:403px;letter-spacing:0.08px;word-spacing:-0.94px;}
#t13_932{left:96px;bottom:381px;letter-spacing:0.13px;word-spacing:-0.45px;}
#t14_932{left:96px;bottom:342px;letter-spacing:0.15px;word-spacing:-0.05px;}
#t15_932{left:96px;bottom:317px;letter-spacing:0.13px;}
#t16_932{left:124px;bottom:317px;letter-spacing:0.14px;word-spacing:-0.07px;}
#t17_932{left:124px;bottom:296px;letter-spacing:0.11px;word-spacing:0.03px;}
#t18_932{left:124px;bottom:274px;letter-spacing:-0.17px;word-spacing:0.32px;}
#t19_932{left:124px;bottom:247px;letter-spacing:0.12px;word-spacing:-0.44px;}
#t1a_932{left:124px;bottom:225px;letter-spacing:-0.02px;word-spacing:-0.3px;}
#t1b_932{left:96px;bottom:195px;letter-spacing:0.13px;}
#t1c_932{left:124px;bottom:195px;letter-spacing:0.04px;word-spacing:0.12px;}
#t1d_932{left:96px;bottom:164px;letter-spacing:0.13px;}
#t1e_932{left:124px;bottom:164px;letter-spacing:0.09px;word-spacing:0.05px;}
#t1f_932{left:396px;bottom:12px;letter-spacing:0.16px;}

.s1_932{font-size:17px;font-family:Arial-BoldItalic_623;color:#000;}
.s2_932{font-size:17px;font-family:Arial-Italic_62c;color:#000;}
.s3_932{font-size:18px;font-family:TimesNewRoman_61y;color:#000;}
.s4_932{font-size:18px;font-family:Arial-Bold_61q;color:#000;}
.s5_932{font-size:15px;font-family:TimesNewRoman_61y;color:#000;}
.s6_932{font-size:18px;font-family:TimesNewRoman-Italic_626;color:#000;}
.s7_932{font-size:18px;font-family:Arial_62w;color:#00AB00;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts932" type="text/css" >

@font-face {
	font-family: Arial-BoldItalic_623;
	src: url("fonts/Arial-BoldItalic_623.woff") format("woff");
}

@font-face {
	font-family: Arial-Bold_61q;
	src: url("fonts/Arial-Bold_61q.woff") format("woff");
}

@font-face {
	font-family: Arial-Italic_62c;
	src: url("fonts/Arial-Italic_62c.woff") format("woff");
}

@font-face {
	font-family: Arial_62w;
	src: url("fonts/Arial_62w.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman-Italic_626;
	src: url("fonts/TimesNewRoman-Italic_626.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_61y;
	src: url("fonts/TimesNewRoman_61y.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg932Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg932" style="-webkit-user-select: none;"><object width="935" height="1210" data="932/932.svg" type="image/svg+xml" id="pdf932" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_932" class="t s1_932">477 </span><span id="t2_932" class="t s2_932">Software Debug and Performance Resources </span>
<span id="t3_932" class="t s1_932">AMD64 Technology </span><span id="t4_932" class="t s1_932">24593—Rev. 3.41—June 2023 </span>
<span id="t5_932" class="t s3_932">moment in the future if LWP context is saved and restored due to context switching. Software must </span>
<span id="t6_932" class="t s3_932">stop and restart LWP to ensure that any changes reliably take effect. </span>
<span id="t7_932" class="t s4_932">13.4.8.4 </span><span id="t8_932" class="t s4_932">Security </span>
<span id="t9_932" class="t s3_932">The operating system must ensure that information does not leak from one process to another or from </span>
<span id="ta_932" class="t s3_932">the kernel to a user process. Hence, if it supports LWP at all, the operating system must ensure that the </span>
<span id="tb_932" class="t s3_932">state of the LWP hardware is set appropriately when a context switch occurs and when a new process </span>
<span id="tc_932" class="t s3_932">or thread is created. LWP state for a new thread can be initialized by executing XRSTOR with bit 62 of </span>
<span id="td_932" class="t s3_932">XSAVE.HEADER.XSTATE_BV set to 0 and the corresponding bit in EDX:EAX set to 1. </span>
<span id="te_932" class="t s4_932">13.4.8.5 </span><span id="tf_932" class="t s4_932">Interrupts </span>
<span id="tg_932" class="t s3_932">The LWP threshold interrupt vector number is specified in the LWP_CFG MSR. The operating system </span>
<span id="th_932" class="t s3_932">must assign a vector for LWP threshold interrupts and fill in the corresponding entry in the interrupt- </span>
<span id="ti_932" class="t s3_932">descriptor table. Note that the LWP interrupt is not shared with the performance counter interrupt, </span>
<span id="tj_932" class="t s3_932">since the system allows concurrent and independent use of those two mechanisms. </span>
<span id="tk_932" class="t s4_932">13.4.8.6 </span><span id="tl_932" class="t s4_932">Memory Access During LWP Operation </span>
<span id="tm_932" class="t s3_932">When LWP needs to save an event record in the event ring buffer, it accesses the user memory </span>
<span id="tn_932" class="t s3_932">containing the ring buffer and sometimes the memory containing the LWPCB. This causes a Page </span>
<span id="to_932" class="t s3_932">Fault (#PF) exception if those pages are not in memory. </span>
<span id="tp_932" class="t s3_932">A particular implementation of LWP has several ways to deal with page faults when storing an event </span>
<span id="tq_932" class="t s3_932">record. These may include saving the event record in the XSAVE area and retrying the store later, re- </span>
<span id="tr_932" class="t s3_932">executing the instruction, or discarding the event and reporting the next event of the appropriate type. </span>
<span id="ts_932" class="t s3_932">Note that this reinforces the notion that LWP is a sampling mechanism. Programs cannot rely on it to </span>
<span id="tt_932" class="t s3_932">precisely capture every n </span>
<span id="tu_932" class="t s5_932">th </span>
<span id="tv_932" class="t s3_932">instance of an event. It captures </span><span id="tw_932" class="t s6_932">approximately </span><span id="tx_932" class="t s3_932">every n </span>
<span id="ty_932" class="t s5_932">th </span>
<span id="tz_932" class="t s3_932">instance. </span>
<span id="t10_932" class="t s4_932">13.4.8.7 </span><span id="t11_932" class="t s4_932">Guidelines for Operating Systems </span>
<span id="t12_932" class="t s3_932">To support LWP, an operating system should follow the following guidelines. Most of these operations </span>
<span id="t13_932" class="t s3_932">should be done on each core of a multi-core system. </span>
<span id="t14_932" class="t s4_932">System initialization </span>
<span id="t15_932" class="t s3_932">1. </span><span id="t16_932" class="t s3_932">Use CPUID Fn0000_0000 to ensure that the system is running on an “Authentic AMD” </span>
<span id="t17_932" class="t s3_932">processor, and then check CPUID Fn8000_0001_ECX[LWP] to ensure that the processor </span>
<span id="t18_932" class="t s3_932">supports LWP. </span>
<span id="t19_932" class="t s3_932">Alternatively, check CPUID Fn0000_000D_EDX_x0[30] to ensure that the system supports the </span>
<span id="t1a_932" class="t s3_932">LWP XSAVE area, indicating that the processor supports LWP. </span>
<span id="t1b_932" class="t s3_932">2. </span><span id="t1c_932" class="t s3_932">Enable XSAVE operations by setting CR4[OSXSAVE]. </span>
<span id="t1d_932" class="t s3_932">3. </span><span id="t1e_932" class="t s3_932">Enable LWP by executing XSETBV to set bit 62 of XCR0. </span>
<span id="t1f_932" class="t s7_932">[AMD Public Use] </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
