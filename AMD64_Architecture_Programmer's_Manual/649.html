<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p649" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_649{left:96px;bottom:47px;letter-spacing:-0.12px;word-spacing:0.01px;}
#t2_649{left:808px;bottom:47px;letter-spacing:0.17px;}
#t3_649{left:96px;bottom:1116px;letter-spacing:-0.17px;word-spacing:2.66px;}
#t4_649{left:684px;bottom:1116px;letter-spacing:-0.17px;word-spacing:0.06px;}
#t5_649{left:96px;bottom:1038px;}
#t6_649{left:124px;bottom:1038px;letter-spacing:0.13px;word-spacing:-0.46px;}
#t7_649{left:96px;bottom:1011px;}
#t8_649{left:124px;bottom:1011px;letter-spacing:0.11px;word-spacing:-0.45px;}
#t9_649{left:96px;bottom:976px;letter-spacing:0.13px;word-spacing:-0.34px;}
#ta_649{left:289px;bottom:976px;}
#tb_649{left:295px;bottom:976px;letter-spacing:0.12px;word-spacing:-0.42px;}
#tc_649{left:96px;bottom:954px;letter-spacing:0.11px;word-spacing:-0.44px;}
#td_649{left:96px;bottom:933px;letter-spacing:0.12px;word-spacing:-0.62px;}
#te_649{left:96px;bottom:911px;letter-spacing:0.12px;word-spacing:-0.91px;}
#tf_649{left:96px;bottom:890px;letter-spacing:0.12px;word-spacing:-0.45px;}
#tg_649{left:96px;bottom:855px;letter-spacing:0.13px;word-spacing:-0.45px;}
#th_649{left:96px;bottom:834px;letter-spacing:0.1px;word-spacing:-0.42px;}
#ti_649{left:96px;bottom:798px;letter-spacing:0.12px;word-spacing:-0.46px;}
#tj_649{left:96px;bottom:777px;letter-spacing:0.12px;word-spacing:-0.81px;}
#tk_649{left:96px;bottom:742px;letter-spacing:0.13px;word-spacing:-1.08px;}
#tl_649{left:96px;bottom:720px;letter-spacing:0.13px;word-spacing:-0.45px;}
#tm_649{left:96px;bottom:699px;letter-spacing:0.13px;word-spacing:-0.48px;}
#tn_649{left:96px;bottom:678px;letter-spacing:0.12px;word-spacing:-0.48px;}
#to_649{left:96px;bottom:656px;letter-spacing:0.13px;word-spacing:-0.45px;}
#tp_649{left:96px;bottom:617px;letter-spacing:0.11px;}
#tq_649{left:147px;bottom:617px;letter-spacing:0.17px;}
#tr_649{left:96px;bottom:581px;letter-spacing:0.13px;word-spacing:-0.91px;}
#ts_649{left:96px;bottom:560px;letter-spacing:0.12px;word-spacing:-0.46px;}
#tt_649{left:96px;bottom:539px;letter-spacing:0.13px;word-spacing:-0.46px;}
#tu_649{left:96px;bottom:503px;letter-spacing:0.12px;word-spacing:-1.01px;}
#tv_649{left:96px;bottom:482px;letter-spacing:0.13px;word-spacing:-1.05px;}
#tw_649{left:96px;bottom:461px;letter-spacing:0.12px;word-spacing:-0.45px;}
#tx_649{left:447px;bottom:461px;}
#ty_649{left:462px;bottom:461px;letter-spacing:0.13px;word-spacing:-0.45px;}
#tz_649{left:608px;bottom:461px;}
#t10_649{left:627px;bottom:461px;letter-spacing:0.12px;word-spacing:-0.45px;}
#t11_649{left:751px;bottom:461px;}
#t12_649{left:763px;bottom:461px;}
#t13_649{left:96px;bottom:430px;letter-spacing:0.13px;}
#t14_649{left:124px;bottom:430px;letter-spacing:0.11px;word-spacing:1.55px;}
#t15_649{left:678px;bottom:430px;}
#t16_649{left:695px;bottom:430px;letter-spacing:0.12px;word-spacing:1.66px;}
#t17_649{left:823px;bottom:430px;}
#t18_649{left:124px;bottom:409px;letter-spacing:0.11px;word-spacing:-0.02px;}
#t19_649{left:96px;bottom:378px;letter-spacing:0.13px;}
#t1a_649{left:124px;bottom:378px;letter-spacing:0.12px;word-spacing:1.61px;}
#t1b_649{left:124px;bottom:357px;letter-spacing:0.1px;}
#t1c_649{left:163px;bottom:357px;}
#t1d_649{left:180px;bottom:357px;letter-spacing:0.13px;}
#t1e_649{left:369px;bottom:357px;}
#t1f_649{left:385px;bottom:357px;}
#t1g_649{left:96px;bottom:326px;letter-spacing:0.13px;}
#t1h_649{left:124px;bottom:326px;letter-spacing:0.12px;word-spacing:-0.2px;}
#t1i_649{left:96px;bottom:291px;letter-spacing:0.13px;word-spacing:-0.46px;}
#t1j_649{left:710px;bottom:291px;}
#t1k_649{left:722px;bottom:291px;letter-spacing:0.05px;word-spacing:-0.39px;}
#t1l_649{left:96px;bottom:270px;letter-spacing:0.12px;word-spacing:-0.45px;}
#t1m_649{left:576px;bottom:270px;}
#t1n_649{left:595px;bottom:270px;letter-spacing:0.12px;word-spacing:-0.45px;}
#t1o_649{left:96px;bottom:248px;letter-spacing:0.1px;}
#t1p_649{left:135px;bottom:248px;}
#t1q_649{left:150px;bottom:248px;letter-spacing:0.13px;word-spacing:-0.48px;}
#t1r_649{left:707px;bottom:248px;letter-spacing:0.14px;word-spacing:-0.46px;}
#t1s_649{left:794px;bottom:248px;letter-spacing:0.13px;}
#t1t_649{left:96px;bottom:227px;letter-spacing:0.12px;word-spacing:-0.45px;}
#t1u_649{left:489px;bottom:227px;letter-spacing:0.16px;}
#t1v_649{left:522px;bottom:227px;letter-spacing:0.13px;word-spacing:-0.45px;}
#t1w_649{left:96px;bottom:205px;letter-spacing:0.12px;word-spacing:-0.68px;}
#t1x_649{left:96px;bottom:184px;letter-spacing:0.12px;word-spacing:-0.51px;}
#t1y_649{left:96px;bottom:163px;letter-spacing:0.13px;word-spacing:-0.45px;}
#t1z_649{left:96px;bottom:141px;letter-spacing:0.12px;}
#t20_649{left:396px;bottom:12px;letter-spacing:0.16px;}

.s1_649{font-size:17px;font-family:Arial-Italic_62c;color:#000;}
.s2_649{font-size:18px;font-family:Arial-BoldItalic_623;color:#000;}
.s3_649{font-size:17px;font-family:Arial-BoldItalic_623;color:#000;}
.s4_649{font-size:18px;font-family:TimesNewRoman-Bold_61v;color:#000;}
.s5_649{font-size:18px;font-family:TimesNewRoman_61y;color:#000;}
.s6_649{font-size:18px;font-family:TimesNewRoman_627;color:#000;}
.s7_649{font-size:18px;font-family:Arial-Bold_61q;color:#000;}
.s8_649{font-size:18px;font-family:TimesNewRoman-Italic_626;color:#000;}
.s9_649{font-size:18px;font-family:Arial_62w;color:#00AB00;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts649" type="text/css" >

@font-face {
	font-family: Arial-BoldItalic_623;
	src: url("fonts/Arial-BoldItalic_623.woff") format("woff");
}

@font-face {
	font-family: Arial-Bold_61q;
	src: url("fonts/Arial-Bold_61q.woff") format("woff");
}

@font-face {
	font-family: Arial-Italic_62c;
	src: url("fonts/Arial-Italic_62c.woff") format("woff");
}

@font-face {
	font-family: Arial_62w;
	src: url("fonts/Arial_62w.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman-Bold_61v;
	src: url("fonts/TimesNewRoman-Bold_61v.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman-Italic_626;
	src: url("fonts/TimesNewRoman-Italic_626.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_61y;
	src: url("fonts/TimesNewRoman_61y.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_627;
	src: url("fonts/TimesNewRoman_627.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg649Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg649" style="-webkit-user-select: none;"><object width="935" height="1210" data="649/649.svg" type="image/svg+xml" id="pdf649" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_649" class="t s1_649">Memory System </span><span id="t2_649" class="t s2_649">194 </span>
<span id="t3_649" class="t s3_649">24593—Rev. 3.41—June 2023 </span><span id="t4_649" class="t s3_649">AMD64 Technology </span>
<span id="t5_649" class="t s4_649">• </span><span id="t6_649" class="t s5_649">Read probes indicate the external master is requesting the data for read purposes. </span>
<span id="t7_649" class="t s4_649">• </span><span id="t8_649" class="t s5_649">Write probes indicate the external master is requesting the data for the purpose of modifying it. </span>
<span id="t9_649" class="t s5_649">Referring back to Figure 7</span><span id="ta_649" class="t s6_649">-</span><span id="tb_649" class="t s5_649">2 on page 193, the state transitions involving probes are initiated by other </span>
<span id="tc_649" class="t s5_649">processors and external bus masters into the processor. Some read probes are initiated by devices that </span>
<span id="td_649" class="t s5_649">intend to cache the data. Others, such as those initiated by I/O devices, do not intend to cache the data. </span>
<span id="te_649" class="t s5_649">Some processor implementations do not change the data MOESI state if the read probe is initiated by a </span>
<span id="tf_649" class="t s5_649">device that does not intend to cache the data. </span>
<span id="tg_649" class="t s5_649">State transitions involving read misses and write misses can cause the processor to generate probes </span>
<span id="th_649" class="t s5_649">into external bus masters and to read main memory. </span>
<span id="ti_649" class="t s5_649">Read hits do not cause a MOESI-state change. Write hits generally cause a MOESI-state change into </span>
<span id="tj_649" class="t s5_649">the modified state. If the cache line is already in the modified state, a write hit does not change its state. </span>
<span id="tk_649" class="t s5_649">The specific operation of external-bus signals and transactions and how they influence a cache MOESI </span>
<span id="tl_649" class="t s5_649">state are implementation dependent. For example, an implementation could convert a write miss to a </span>
<span id="tm_649" class="t s5_649">WB memory type into two separate MOESI-state changes. The first would be a read-miss placing the </span>
<span id="tn_649" class="t s5_649">cache line in the exclusive state. This would be followed by a write hit into the exclusive cache line, </span>
<span id="to_649" class="t s5_649">changing the cache-line state to modified. </span>
<span id="tp_649" class="t s7_649">7.3.1 </span><span id="tq_649" class="t s7_649">Special Coherency Considerations </span>
<span id="tr_649" class="t s5_649">In some cases, data can be modified in a manner that is impossible for the memory-coherency protocol </span>
<span id="ts_649" class="t s5_649">to handle due to the effects of instruction prefetching. In such situations software must use serializing </span>
<span id="tt_649" class="t s5_649">instructions and/or cache-invalidation instructions to ensure subsequent data accesses are coherent. </span>
<span id="tu_649" class="t s5_649">An example of this type of a situation is a page-table update followed by accesses to the physical pages </span>
<span id="tv_649" class="t s5_649">referenced by the updated page tables. The following sequence of events shows what can happen when </span>
<span id="tw_649" class="t s5_649">software changes the translation of virtual-page </span><span id="tx_649" class="t s8_649">A </span><span id="ty_649" class="t s5_649">from physical-page </span><span id="tz_649" class="t s8_649">M </span><span id="t10_649" class="t s5_649">to physical-page </span><span id="t11_649" class="t s8_649">N</span><span id="t12_649" class="t s5_649">: </span>
<span id="t13_649" class="t s5_649">1. </span><span id="t14_649" class="t s5_649">Software invalidates the TLB entry. The tables that translate virtual-page </span><span id="t15_649" class="t s8_649">A </span><span id="t16_649" class="t s5_649">to physical-page </span><span id="t17_649" class="t s8_649">M </span>
<span id="t18_649" class="t s5_649">are now held only in main memory. They are not cached by the TLB. </span>
<span id="t19_649" class="t s5_649">2. </span><span id="t1a_649" class="t s5_649">Software changes the page-table entry for virtual-page A in main memory to point to physical- </span>
<span id="t1b_649" class="t s5_649">page </span><span id="t1c_649" class="t s8_649">N </span><span id="t1d_649" class="t s5_649">rather than physical-page </span><span id="t1e_649" class="t s8_649">M</span><span id="t1f_649" class="t s5_649">. </span>
<span id="t1g_649" class="t s5_649">3. </span><span id="t1h_649" class="t s5_649">Software accesses data in virtual-page A. </span>
<span id="t1i_649" class="t s5_649">During Step 3, software expects the processor to access the data from physical-page </span><span id="t1j_649" class="t s8_649">N</span><span id="t1k_649" class="t s5_649">. However, it is </span>
<span id="t1l_649" class="t s5_649">possible for the processor to prefetch the data from physical-page </span><span id="t1m_649" class="t s8_649">M </span><span id="t1n_649" class="t s5_649">before the page table for virtual- </span>
<span id="t1o_649" class="t s5_649">page </span><span id="t1p_649" class="t s8_649">A </span><span id="t1q_649" class="t s5_649">is updated in Step 2. This is because the physical-memory references for the </span><span id="t1r_649" class="t s8_649">page tables </span><span id="t1s_649" class="t s5_649">are </span>
<span id="t1t_649" class="t s5_649">different than the physical-memory references for the </span><span id="t1u_649" class="t s8_649">data</span><span id="t1v_649" class="t s5_649">. Because the physical-memory references </span>
<span id="t1w_649" class="t s5_649">are different, the processor does not recognize them as requiring coherency checking and believes it is </span>
<span id="t1x_649" class="t s5_649">safe to prefetch the data from virtual-page A, which is translated into a read from physical page M. </span>
<span id="t1y_649" class="t s5_649">Similar behavior can occur when instructions are prefetched from beyond the page table update </span>
<span id="t1z_649" class="t s5_649">instruction. </span>
<span id="t20_649" class="t s9_649">[AMD Public Use] </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
