<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p101" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_101{left:110px;bottom:946px;letter-spacing:-0.24px;word-spacing:3.95px;}
#t2_101{left:110px;bottom:852px;letter-spacing:-0.33px;word-spacing:5.23px;}
#t3_101{left:110px;bottom:806px;letter-spacing:-0.25px;word-spacing:5.09px;}
#t4_101{left:110px;bottom:719px;letter-spacing:-0.17px;word-spacing:3.65px;}
#t5_101{left:585px;bottom:719px;letter-spacing:-0.14px;word-spacing:3.6px;}
#t6_101{left:110px;bottom:698px;letter-spacing:-0.19px;word-spacing:3.69px;}
#t7_101{left:714px;bottom:698px;letter-spacing:-0.17px;word-spacing:3.61px;}
#t8_101{left:110px;bottom:678px;letter-spacing:-0.23px;word-spacing:1.41px;}
#t9_101{left:110px;bottom:657px;letter-spacing:-0.15px;word-spacing:0.41px;}
#ta_101{left:110px;bottom:636px;letter-spacing:-0.14px;word-spacing:1.35px;}
#tb_101{left:110px;bottom:600px;letter-spacing:-0.17px;word-spacing:2.16px;}
#tc_101{left:110px;bottom:580px;letter-spacing:-0.16px;word-spacing:2.35px;}
#td_101{left:110px;bottom:559px;letter-spacing:-0.16px;word-spacing:2.75px;}
#te_101{left:777px;bottom:559px;letter-spacing:-0.16px;}
#tf_101{left:110px;bottom:538px;letter-spacing:-0.17px;word-spacing:0.78px;}
#tg_101{left:110px;bottom:518px;letter-spacing:-0.16px;word-spacing:3.07px;}
#th_101{left:396px;bottom:518px;letter-spacing:-0.18px;word-spacing:3.07px;}
#ti_101{left:110px;bottom:497px;letter-spacing:-0.11px;word-spacing:1.9px;}
#tj_101{left:364px;bottom:497px;letter-spacing:-0.14px;}
#tk_101{left:385px;bottom:497px;letter-spacing:-0.15px;word-spacing:1.96px;}
#tl_101{left:110px;bottom:476px;letter-spacing:-0.15px;word-spacing:1.39px;}
#tm_101{left:110px;bottom:440px;letter-spacing:-0.16px;word-spacing:3.06px;}
#tn_101{left:631px;bottom:440px;letter-spacing:-0.17px;}
#to_101{left:648px;bottom:440px;letter-spacing:-0.16px;word-spacing:3.06px;}
#tp_101{left:110px;bottom:420px;letter-spacing:-0.15px;word-spacing:3.26px;}
#tq_101{left:494px;bottom:420px;letter-spacing:-0.17px;}
#tr_101{left:511px;bottom:420px;letter-spacing:-0.26px;word-spacing:3.44px;}
#ts_101{left:110px;bottom:399px;letter-spacing:-0.12px;word-spacing:1.35px;}
#tt_101{left:110px;bottom:363px;letter-spacing:-0.13px;word-spacing:1.59px;}
#tu_101{left:110px;bottom:342px;letter-spacing:-0.15px;word-spacing:1.38px;}
#tv_101{left:152px;bottom:298px;letter-spacing:0.03px;word-spacing:2.69px;}
#tw_101{left:152px;bottom:279px;letter-spacing:0.08px;word-spacing:2.69px;}
#tx_101{left:152px;bottom:261px;letter-spacing:0.05px;word-spacing:1.92px;}
#ty_101{left:152px;bottom:243px;word-spacing:2.4px;}
#tz_101{left:152px;bottom:225px;word-spacing:2.35px;}
#t10_101{left:152px;bottom:206px;letter-spacing:0.04px;word-spacing:1.74px;}
#t11_101{left:177px;bottom:188px;letter-spacing:0.03px;word-spacing:2.02px;}
#t12_101{left:152px;bottom:170px;letter-spacing:-0.02px;word-spacing:1.85px;}
#t13_101{left:152px;bottom:151px;letter-spacing:-0.05px;word-spacing:2.19px;}
#t14_101{left:152px;bottom:133px;letter-spacing:-0.02px;word-spacing:1.86px;}
#t15_101{left:459px;bottom:67px;letter-spacing:-0.17px;}

.s1_101{font-size:32px;font-family:CMBX12_26j;color:#000;}
.s2_101{font-size:38px;font-family:CMBX12_26j;color:#000;}
.s3_101{font-size:17px;font-family:CMR10_270;color:#000;}
.s4_101{font-size:17px;font-family:CMR10_270;color:#000080;}
.s5_101{font-size:15px;font-family:CMTI10_27t;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts101" type="text/css" >

@font-face {
	font-family: CMBX12_26j;
	src: url("fonts/CMBX12_26j.woff") format("woff");
}

@font-face {
	font-family: CMR10_270;
	src: url("fonts/CMR10_270.woff") format("woff");
}

@font-face {
	font-family: CMTI10_27t;
	src: url("fonts/CMTI10_27t.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg101Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg101" style="-webkit-user-select: none;"><object width="935" height="1210" data="101/101.svg" type="image/svg+xml" id="pdf101" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_101" class="t s1_101">Chapter 14 </span>
<span id="t2_101" class="t s2_101">RVWMO Memory Consistency </span>
<span id="t3_101" class="t s2_101">Model, Version 0.1 </span>
<span id="t4_101" class="t s3_101" data-mappings='[[15,"fi"]]'>This chapter deﬁnes the RISC-V memory consistency model. </span><span id="t5_101" class="t s3_101">A memory consistency model is </span>
<span id="t6_101" class="t s3_101">a set of rules specifying the values that can be returned by loads of memory. </span><span id="t7_101" class="t s3_101">RISC-V uses a </span>
<span id="t8_101" class="t s3_101">memory model called “RVWMO” (RISC-V Weak Memory Ordering) which is designed to provide </span>
<span id="t9_101" class="t s3_101" data-mappings='[[0,"fl"]]'>ﬂexibility for architects to build high-performance scalable designs while simultaneously supporting </span>
<span id="ta_101" class="t s3_101">a tractable programming model. </span>
<span id="tb_101" class="t s3_101">Under RVWMO, code running on a single hart appears to execute in order from the perspective </span>
<span id="tc_101" class="t s3_101">of other memory instructions in the same hart, but memory instructions from another hart may </span>
<span id="td_101" class="t s3_101" data-mappings='[[41,"fi"],[73,"ff"]]'>observe the memory instructions from the ﬁrst hart being executed in a diﬀerent order. </span><span id="te_101" class="t s3_101">There- </span>
<span id="tf_101" class="t s3_101">fore, multithreaded code may require explicit synchronization to guarantee ordering between mem- </span>
<span id="tg_101" class="t s3_101" data-mappings='[[24,"ff"]]'>ory instructions from diﬀerent harts. </span><span id="th_101" class="t s3_101">The base RISC-V ISA provides a FENCE instruction for </span>
<span id="ti_101" class="t s3_101">this purpose, described in Section </span><span id="tj_101" class="t s4_101">2.7</span><span id="tk_101" class="t s3_101" data-mappings='[[49,"fi"]]'>, while the atomics extension “A” additionally deﬁnes load- </span>
<span id="tl_101" class="t s3_101">reserved/store-conditional and atomic read-modify-write instructions. </span>
<span id="tm_101" class="t s3_101">The standard ISA extension for misaligned atomics “Zam” (Chapter </span><span id="tn_101" class="t s4_101">22</span><span id="to_101" class="t s3_101">) and the standard ISA </span>
<span id="tp_101" class="t s3_101">extension for total store ordering “Ztso” (Chapter </span><span id="tq_101" class="t s4_101">23</span><span id="tr_101" class="t s3_101">) augment RVWMO with additional rules </span>
<span id="ts_101" class="t s3_101" data-mappings='[[5,"fi"]]'>speciﬁc to those extensions. </span>
<span id="tt_101" class="t s3_101" data-mappings='[[28,"fi"]]'>The appendices to this speciﬁcation provide both axiomatic and operational formalizations of the </span>
<span id="tu_101" class="t s3_101">memory consistency model as well as additional explanatory material. </span>
<span id="tv_101" class="t s5_101" data-mappings='[[15,"fi"]]'>This chapter deﬁnes the memory model for regular main memory operations. The interaction </span>
<span id="tw_101" class="t s5_101">of the memory model with I/O memory, instruction fetches, FENCE.I, page table walks, and </span>
<span id="tx_101" class="t s5_101">SFENCE.VMA is not (yet) formalized. Some or all of the above may be formalized in a future </span>
<span id="ty_101" class="t s5_101" data-mappings='[[22,"fi"]]'>revision of this speciﬁcation. The RV128 base ISA and future ISA extensions such as the “V” </span>
<span id="tz_101" class="t s5_101">vector, “T” transactional memory, and “J” JIT extensions will need to be incorporated into a </span>
<span id="t10_101" class="t s5_101">future revision as well. </span>
<span id="t11_101" class="t s5_101" data-mappings='[[70,"ff"]]'>Memory consistency models supporting overlapping memory accesses of diﬀerent widths si- </span>
<span id="t12_101" class="t s5_101">multaneously remain an active area of academic research and are not yet fully understood. The </span>
<span id="t13_101" class="t s5_101" data-mappings='[[5,"fi"],[37,"ff"],[80,"fi"]]'>speciﬁcs of how memory accesses of diﬀerent sizes interact under RVWMO are speciﬁed to the </span>
<span id="t14_101" class="t s5_101">best of our current abilities, but they are subject to revision should new issues be uncovered. </span>
<span id="t15_101" class="t s3_101">83 </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
