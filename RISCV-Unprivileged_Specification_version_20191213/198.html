<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p198" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_198{left:110px;bottom:1129px;letter-spacing:-0.17px;}
#t2_198{left:475px;bottom:1129px;letter-spacing:-0.21px;word-spacing:1.47px;}
#t3_198{left:110px;bottom:1082px;letter-spacing:-0.16px;word-spacing:-0.05px;}
#t4_198{left:110px;bottom:1062px;letter-spacing:-0.15px;word-spacing:0.11px;}
#t5_198{left:110px;bottom:1041px;letter-spacing:-0.16px;word-spacing:1.47px;}
#t6_198{left:110px;bottom:1020px;letter-spacing:-0.14px;word-spacing:1.37px;}
#t7_198{left:110px;bottom:950px;letter-spacing:-0.05px;}
#t8_198{left:172px;bottom:950px;letter-spacing:-0.04px;word-spacing:2.74px;}
#t9_198{left:168px;bottom:898px;letter-spacing:-0.14px;word-spacing:1.32px;}
#ta_198{left:334px;bottom:898px;letter-spacing:-0.4px;word-spacing:1.75px;}
#tb_198{left:168px;bottom:873px;letter-spacing:-0.18px;}
#tc_198{left:334px;bottom:873px;}
#td_198{left:343px;bottom:873px;}
#te_198{left:351px;bottom:873px;letter-spacing:-0.17px;}
#tf_198{left:413px;bottom:873px;}
#tg_198{left:421px;bottom:873px;letter-spacing:-0.18px;word-spacing:4.58px;}
#th_198{left:168px;bottom:852px;letter-spacing:-0.15px;}
#ti_198{left:334px;bottom:852px;letter-spacing:-0.18px;word-spacing:4.58px;}
#tj_198{left:448px;bottom:852px;}
#tk_198{left:456px;bottom:852px;letter-spacing:-0.18px;}
#tl_198{left:518px;bottom:852px;}
#tm_198{left:168px;bottom:820px;letter-spacing:-0.27px;word-spacing:1.53px;}
#tn_198{left:334px;bottom:831px;letter-spacing:-0.17px;}
#to_198{left:404px;bottom:831px;}
#tp_198{left:413px;bottom:831px;letter-spacing:-0.18px;}
#tq_198{left:439px;bottom:831px;}
#tr_198{left:447px;bottom:831px;letter-spacing:-0.18px;}
#ts_198{left:500px;bottom:831px;letter-spacing:-0.25px;}
#tt_198{left:334px;bottom:810px;letter-spacing:-0.17px;word-spacing:4.58px;}
#tu_198{left:413px;bottom:810px;}
#tv_198{left:421px;bottom:810px;letter-spacing:-0.18px;}
#tw_198{left:448px;bottom:810px;}
#tx_198{left:456px;bottom:810px;letter-spacing:-0.18px;word-spacing:4.58px;}
#ty_198{left:578px;bottom:810px;}
#tz_198{left:587px;bottom:810px;letter-spacing:-0.18px;}
#t10_198{left:613px;bottom:810px;}
#t11_198{left:621px;bottom:810px;letter-spacing:-0.18px;word-spacing:4.58px;}
#t12_198{left:168px;bottom:789px;letter-spacing:-0.51px;}
#t13_198{left:334px;bottom:789px;letter-spacing:-0.18px;word-spacing:4.58px;}
#t14_198{left:228px;bottom:754px;letter-spacing:-0.17px;word-spacing:1.64px;}
#t15_198{left:110px;bottom:716px;letter-spacing:-0.51px;}
#t16_198{left:157px;bottom:716px;letter-spacing:-0.17px;}
#t17_198{left:189px;bottom:716px;letter-spacing:-0.17px;word-spacing:2.23px;}
#t18_198{left:110px;bottom:695px;letter-spacing:-0.16px;word-spacing:2.61px;}
#t19_198{left:110px;bottom:674px;letter-spacing:-0.18px;word-spacing:1.96px;}
#t1a_198{left:110px;bottom:654px;letter-spacing:-0.23px;word-spacing:2.12px;}
#t1b_198{left:110px;bottom:633px;letter-spacing:-0.27px;word-spacing:3.55px;}
#t1c_198{left:523px;bottom:633px;letter-spacing:-0.15px;word-spacing:3.32px;}
#t1d_198{left:110px;bottom:612px;letter-spacing:-0.16px;word-spacing:1.54px;}
#t1e_198{left:110px;bottom:591px;letter-spacing:-0.08px;word-spacing:0.71px;}
#t1f_198{left:186px;bottom:591px;letter-spacing:-0.16px;}
#t1g_198{left:207px;bottom:591px;letter-spacing:-0.18px;}
#t1h_198{left:239px;bottom:591px;letter-spacing:-0.11px;}
#t1i_198{left:256px;bottom:591px;letter-spacing:-0.15px;word-spacing:0.9px;}
#t1j_198{left:420px;bottom:591px;letter-spacing:-0.16px;}
#t1k_198{left:442px;bottom:591px;letter-spacing:-0.13px;word-spacing:0.87px;}
#t1l_198{left:110px;bottom:571px;letter-spacing:-0.01px;}
#t1m_198{left:149px;bottom:571px;letter-spacing:-0.16px;}
#t1n_198{left:171px;bottom:571px;letter-spacing:-0.18px;}
#t1o_198{left:203px;bottom:571px;letter-spacing:-0.11px;}
#t1p_198{left:219px;bottom:571px;letter-spacing:-0.17px;word-spacing:1.36px;}
#t1q_198{left:110px;bottom:550px;letter-spacing:-0.11px;}
#t1r_198{left:127px;bottom:550px;letter-spacing:-0.15px;word-spacing:1.39px;}
#t1s_198{left:110px;bottom:514px;letter-spacing:-0.26px;word-spacing:1.39px;}
#t1t_198{left:270px;bottom:514px;letter-spacing:-0.17px;}
#t1u_198{left:300px;bottom:514px;letter-spacing:-0.19px;word-spacing:1.38px;}
#t1v_198{left:814px;bottom:514px;letter-spacing:-0.11px;}
#t1w_198{left:110px;bottom:493px;letter-spacing:-0.31px;word-spacing:2.23px;}
#t1x_198{left:410px;bottom:493px;}
#t1y_198{left:424px;bottom:493px;letter-spacing:-0.2px;word-spacing:1.62px;}
#t1z_198{left:110px;bottom:473px;letter-spacing:-0.21px;word-spacing:2.66px;}
#t20_198{left:679px;bottom:473px;letter-spacing:-0.11px;word-spacing:2.42px;}
#t21_198{left:110px;bottom:452px;letter-spacing:-0.13px;word-spacing:-0.1px;}
#t22_198{left:278px;bottom:452px;letter-spacing:-0.16px;}
#t23_198{left:298px;bottom:452px;letter-spacing:-0.13px;word-spacing:0.17px;}
#t24_198{left:110px;bottom:431px;letter-spacing:-0.18px;word-spacing:1.04px;}
#t25_198{left:110px;bottom:411px;letter-spacing:-0.18px;word-spacing:1.44px;}
#t26_198{left:312px;bottom:374px;letter-spacing:-0.24px;word-spacing:1.54px;}
#t27_198{left:460px;bottom:374px;letter-spacing:-0.4px;word-spacing:1.75px;}
#t28_198{left:312px;bottom:349px;letter-spacing:-0.18px;}
#t29_198{left:460px;bottom:349px;}
#t2a_198{left:469px;bottom:349px;}
#t2b_198{left:477px;bottom:349px;letter-spacing:-0.18px;}
#t2c_198{left:538px;bottom:349px;}
#t2d_198{left:312px;bottom:328px;letter-spacing:-0.21px;}
#t2e_198{left:460px;bottom:328px;letter-spacing:-0.18px;}
#t2f_198{left:486px;bottom:328px;}
#t2g_198{left:494px;bottom:328px;letter-spacing:-0.18px;}
#t2h_198{left:521px;bottom:328px;}
#t2i_198{left:312px;bottom:306px;letter-spacing:-0.15px;}
#t2j_198{left:460px;bottom:306px;}
#t2k_198{left:469px;bottom:306px;}
#t2l_198{left:477px;bottom:306px;letter-spacing:-0.18px;}
#t2m_198{left:538px;bottom:306px;}
#t2n_198{left:312px;bottom:285px;letter-spacing:-0.15px;}
#t2o_198{left:460px;bottom:285px;letter-spacing:-0.18px;}
#t2p_198{left:486px;bottom:285px;}
#t2q_198{left:494px;bottom:285px;letter-spacing:-0.18px;}
#t2r_198{left:521px;bottom:285px;}
#t2s_198{left:312px;bottom:264px;letter-spacing:-0.17px;}
#t2t_198{left:460px;bottom:264px;letter-spacing:-0.18px;}
#t2u_198{left:312px;bottom:242px;letter-spacing:-0.17px;}
#t2v_198{left:460px;bottom:242px;letter-spacing:-0.18px;word-spacing:4.58px;}
#t2w_198{left:312px;bottom:221px;letter-spacing:-0.17px;}
#t2x_198{left:460px;bottom:221px;letter-spacing:-0.18px;word-spacing:4.58px;}
#t2y_198{left:223px;bottom:186px;letter-spacing:-0.2px;word-spacing:1.7px;}
#t2z_198{left:110px;bottom:147px;letter-spacing:-0.51px;}
#t30_198{left:156px;bottom:147px;letter-spacing:-0.17px;}
#t31_198{left:187px;bottom:147px;letter-spacing:-0.19px;word-spacing:1.45px;}
#t32_198{left:110px;bottom:126px;letter-spacing:-0.22px;word-spacing:3.81px;}

.s1_198{font-size:17px;font-family:CMR10_270;color:#000;}
.s2_198{font-size:17px;font-family:CMSL10_27d;color:#000;}
.s3_198{font-size:22px;font-family:CMBX12_26j;color:#000;}
.s4_198{font-size:17px;font-family:CMTT10_27z;color:#000;}
.s5_198{font-size:17px;font-family:CMSY10_27j;color:#000;}
.s6_198{font-size:17px;font-family:CMR10_270;color:#000080;}
.s7_198{font-size:17px;font-family:CMTI10_27t;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts198" type="text/css" >

@font-face {
	font-family: CMBX12_26j;
	src: url("fonts/CMBX12_26j.woff") format("woff");
}

@font-face {
	font-family: CMR10_270;
	src: url("fonts/CMR10_270.woff") format("woff");
}

@font-face {
	font-family: CMSL10_27d;
	src: url("fonts/CMSL10_27d.woff") format("woff");
}

@font-face {
	font-family: CMSY10_27j;
	src: url("fonts/CMSY10_27j.woff") format("woff");
}

@font-face {
	font-family: CMTI10_27t;
	src: url("fonts/CMTI10_27t.woff") format("woff");
}

@font-face {
	font-family: CMTT10_27z;
	src: url("fonts/CMTT10_27z.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg198Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg198" style="-webkit-user-select: none;"><object width="935" height="1210" data="198/198.svg" type="image/svg+xml" id="pdf198" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_198" class="t s1_198">180 </span><span id="t2_198" class="t s2_198">Volume I: RISC-V Unprivileged ISA V20191213 </span>
<span id="t3_198" class="t s1_198" data-mappings='[[77,"fi"]]'>The ordering guarantees in this section may not apply beyond a platform-speciﬁc boundary between </span>
<span id="t4_198" class="t s1_198">the RISC-V cores and the device. In particular, I/O accesses sent across an external bus (e.g., PCIe) </span>
<span id="t5_198" class="t s1_198">may be reordered before they reach their ultimate destination. Ordering must be enforced in such </span>
<span id="t6_198" class="t s1_198" data-mappings='[[42,"fi"]]'>situations according to the platform-speciﬁc rules of those external devices and buses. </span>
<span id="t7_198" class="t s3_198">A.5 </span><span id="t8_198" class="t s3_198">Code Porting and Mapping Guidelines </span>
<span id="t9_198" class="t s1_198">x86/TSO Operation </span><span id="ta_198" class="t s1_198">RVWMO Mapping </span>
<span id="tb_198" class="t s1_198">Load </span><span id="tc_198" class="t s4_198">l</span><span id="td_198" class="t s5_198">{</span><span id="te_198" class="t s4_198">b|h|w|d</span><span id="tf_198" class="t s5_198">}</span><span id="tg_198" class="t s4_198">; fence r,rw </span>
<span id="th_198" class="t s1_198">Store </span><span id="ti_198" class="t s4_198">fence rw,w; s</span><span id="tj_198" class="t s5_198">{</span><span id="tk_198" class="t s4_198">b|h|w|d</span><span id="tl_198" class="t s5_198">} </span>
<span id="tm_198" class="t s1_198">Atomic RMW </span>
<span id="tn_198" class="t s4_198">amo&lt;op&gt;.</span><span id="to_198" class="t s5_198">{</span><span id="tp_198" class="t s4_198">w|d</span><span id="tq_198" class="t s5_198">}</span><span id="tr_198" class="t s4_198">.aqrl </span><span id="ts_198" class="t s1_198">OR </span>
<span id="tt_198" class="t s4_198">loop: lr.</span><span id="tu_198" class="t s5_198">{</span><span id="tv_198" class="t s4_198">w|d</span><span id="tw_198" class="t s5_198">}</span><span id="tx_198" class="t s4_198">.aq; &lt;op&gt;; sc.</span><span id="ty_198" class="t s5_198">{</span><span id="tz_198" class="t s4_198">w|d</span><span id="t10_198" class="t s5_198">}</span><span id="t11_198" class="t s4_198">.aqrl; bnez loop </span>
<span id="t12_198" class="t s1_198">Fence </span><span id="t13_198" class="t s4_198">fence rw,rw </span>
<span id="t14_198" class="t s1_198">Table A.2: Mappings from TSO operations to RISC-V operations </span>
<span id="t15_198" class="t s1_198">Table </span><span id="t16_198" class="t s6_198">A.2 </span><span id="t17_198" class="t s1_198">provides a mapping from TSO memory operations onto RISC-V memory instructions. </span>
<span id="t18_198" class="t s1_198">Normal x86 loads and stores are all inherently acquire-RCpc and release-RCpc operations: TSO </span>
<span id="t19_198" class="t s1_198">enforces all load-load, load-store, and store-store ordering by default. Therefore, under RVWMO, </span>
<span id="t1a_198" class="t s1_198">all TSO loads must be mapped onto a load followed by FENCE R,RW, and all TSO stores must </span>
<span id="t1b_198" class="t s1_198">be mapped onto FENCE RW,W followed by a store. </span><span id="t1c_198" class="t s1_198">TSO atomic read-modify-writes and x86 </span>
<span id="t1d_198" class="t s1_198" data-mappings='[[31,"fi"]]'>instructions using the LOCK preﬁx are fully-ordered and can be implemented either via an AMO </span>
<span id="t1e_198" class="t s1_198">with both </span><span id="t1f_198" class="t s7_198">aq </span><span id="t1g_198" class="t s1_198">and </span><span id="t1h_198" class="t s7_198">rl </span><span id="t1i_198" class="t s1_198">set, or via an LR with </span><span id="t1j_198" class="t s7_198">aq </span><span id="t1k_198" class="t s1_198">set, the arithmetic operation in question, an SC with </span>
<span id="t1l_198" class="t s1_198">both </span><span id="t1m_198" class="t s7_198">aq </span><span id="t1n_198" class="t s1_198">and </span><span id="t1o_198" class="t s7_198">rl </span><span id="t1p_198" class="t s1_198">set, and a conditional branch checking the success condition. In the latter case, the </span>
<span id="t1q_198" class="t s7_198">rl </span><span id="t1r_198" class="t s1_198">annotation on the LR turns out (for non-obvious reasons) to be redundant and can be omitted. </span>
<span id="t1s_198" class="t s1_198">Alternatives to Table </span><span id="t1t_198" class="t s6_198">A.2 </span><span id="t1u_198" class="t s1_198">are also possible. A TSO store can be mapped onto AMOSWAP with </span><span id="t1v_198" class="t s7_198">rl </span>
<span id="t1w_198" class="t s1_198">set. However, since RVWMO PPO Rule </span><span id="t1x_198" class="t s6_198">3 </span><span id="t1y_198" class="t s1_198">forbids forwarding of values from AMOs to subsequent </span>
<span id="t1z_198" class="t s1_198" data-mappings='[[53,"ff"]]'>loads, the use of AMOSWAP for stores may negatively aﬀect performance. </span><span id="t20_198" class="t s1_198">A TSO load can be </span>
<span id="t21_198" class="t s1_198">mapped using LR with </span><span id="t22_198" class="t s7_198">aq </span><span id="t23_198" class="t s1_198">set: all such LR instructions will be unpaired, but that fact in and of itself </span>
<span id="t24_198" class="t s1_198" data-mappings='[[93,"ff"]]'>does not preclude the use of LR for loads. However, again, this mapping may also negatively aﬀect </span>
<span id="t25_198" class="t s1_198">performance if it puts more pressure on the reservation mechanism than was originally intended. </span>
<span id="t26_198" class="t s1_198">Power Operation </span><span id="t27_198" class="t s1_198">RVWMO Mapping </span>
<span id="t28_198" class="t s1_198">Load </span><span id="t29_198" class="t s4_198">l</span><span id="t2a_198" class="t s5_198">{</span><span id="t2b_198" class="t s4_198">b|h|w|d</span><span id="t2c_198" class="t s5_198">} </span>
<span id="t2d_198" class="t s1_198">Load-Reserve </span><span id="t2e_198" class="t s4_198">lr.</span><span id="t2f_198" class="t s5_198">{</span><span id="t2g_198" class="t s4_198">w|d</span><span id="t2h_198" class="t s5_198">} </span>
<span id="t2i_198" class="t s1_198">Store </span><span id="t2j_198" class="t s4_198">s</span><span id="t2k_198" class="t s5_198">{</span><span id="t2l_198" class="t s4_198">b|h|w|d</span><span id="t2m_198" class="t s5_198">} </span>
<span id="t2n_198" class="t s1_198">Store-Conditional </span><span id="t2o_198" class="t s4_198">sc.</span><span id="t2p_198" class="t s5_198">{</span><span id="t2q_198" class="t s4_198">w|d</span><span id="t2r_198" class="t s5_198">} </span>
<span id="t2s_198" class="t s4_198">lwsync </span><span id="t2t_198" class="t s4_198">fence.tso </span>
<span id="t2u_198" class="t s4_198">sync </span><span id="t2v_198" class="t s4_198">fence rw,rw </span>
<span id="t2w_198" class="t s4_198">isync </span><span id="t2x_198" class="t s4_198">fence.i; fence r,r </span>
<span id="t2y_198" class="t s1_198">Table A.3: Mappings from Power operations to RISC-V operations </span>
<span id="t2z_198" class="t s1_198">Table </span><span id="t30_198" class="t s6_198">A.3 </span><span id="t31_198" class="t s1_198">provides a mapping from Power memory operations onto RISC-V memory instructions. </span>
<span id="t32_198" class="t s1_198">Power ISYNC maps on RISC-V to a FENCE.I followed by a FENCE R,R; the latter fence is </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
