<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p189" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_189{left:110px;bottom:1129px;letter-spacing:-0.21px;word-spacing:1.47px;}
#t2_189{left:800px;bottom:1129px;letter-spacing:-0.17px;}
#t3_189{left:110px;bottom:1082px;letter-spacing:-0.15px;word-spacing:1.9px;}
#t4_189{left:110px;bottom:1062px;letter-spacing:-0.14px;word-spacing:1.18px;}
#t5_189{left:110px;bottom:1041px;letter-spacing:-0.14px;word-spacing:0.19px;}
#t6_189{left:110px;bottom:1020px;letter-spacing:-0.17px;word-spacing:2.74px;}
#t7_189{left:110px;bottom:999px;letter-spacing:-0.18px;word-spacing:0.57px;}
#t8_189{left:110px;bottom:979px;letter-spacing:-0.15px;word-spacing:0.89px;}
#t9_189{left:110px;bottom:958px;letter-spacing:-0.16px;word-spacing:1.86px;}
#ta_189{left:110px;bottom:937px;letter-spacing:-0.14px;word-spacing:1.39px;}
#tb_189{left:110px;bottom:901px;letter-spacing:-0.16px;word-spacing:2.33px;}
#tc_189{left:110px;bottom:881px;letter-spacing:-0.16px;word-spacing:1.65px;}
#td_189{left:110px;bottom:860px;letter-spacing:-0.23px;word-spacing:2.99px;}
#te_189{left:110px;bottom:839px;letter-spacing:-0.15px;word-spacing:1.5px;}
#tf_189{left:135px;bottom:790px;}
#tg_189{left:152px;bottom:790px;letter-spacing:-0.69px;word-spacing:2.31px;}
#th_189{left:135px;bottom:755px;}
#ti_189{left:152px;bottom:755px;letter-spacing:-0.22px;}
#tj_189{left:135px;bottom:721px;}
#tk_189{left:152px;bottom:721px;letter-spacing:-0.49px;word-spacing:1.91px;}
#tl_189{left:135px;bottom:687px;}
#tm_189{left:152px;bottom:687px;letter-spacing:-0.48px;word-spacing:1.91px;}
#tn_189{left:135px;bottom:652px;}
#to_189{left:152px;bottom:652px;letter-spacing:-0.21px;word-spacing:1.38px;}
#tp_189{left:135px;bottom:618px;}
#tq_189{left:152px;bottom:618px;letter-spacing:-0.23px;word-spacing:1.38px;}
#tr_189{left:110px;bottom:568px;letter-spacing:-0.19px;word-spacing:3.74px;}
#ts_189{left:802px;bottom:568px;letter-spacing:-1.63px;}
#tt_189{left:110px;bottom:547px;letter-spacing:-0.2px;word-spacing:1.65px;}
#tu_189{left:110px;bottom:527px;letter-spacing:-0.14px;word-spacing:1.36px;}
#tv_189{left:110px;bottom:491px;letter-spacing:-0.19px;word-spacing:0.64px;}
#tw_189{left:110px;bottom:470px;letter-spacing:-0.15px;word-spacing:0.81px;}
#tx_189{left:110px;bottom:449px;letter-spacing:-0.17px;word-spacing:1.41px;}
#ty_189{left:110px;bottom:389px;letter-spacing:0.14px;}
#tz_189{left:178px;bottom:389px;letter-spacing:0.11px;word-spacing:2.33px;}
#t10_189{left:470px;bottom:389px;}
#t11_189{left:481px;bottom:389px;}
#t12_189{left:491px;bottom:389px;}
#t13_189{left:501px;bottom:389px;}
#t14_189{left:181px;bottom:343px;letter-spacing:-0.17px;}
#t15_189{left:220px;bottom:343px;}
#t16_189{left:229px;bottom:343px;}
#t17_189{left:241px;bottom:343px;}
#t18_189{left:255px;bottom:343px;letter-spacing:-0.15px;word-spacing:1.39px;}
#t19_189{left:181px;bottom:322px;letter-spacing:-0.17px;}
#t1a_189{left:220px;bottom:322px;}
#t1b_189{left:229px;bottom:322px;}
#t1c_189{left:241px;bottom:322px;}
#t1d_189{left:254px;bottom:322px;letter-spacing:-0.15px;word-spacing:1.39px;}
#t1e_189{left:181px;bottom:302px;letter-spacing:-0.17px;}
#t1f_189{left:220px;bottom:302px;}
#t1g_189{left:229px;bottom:302px;}
#t1h_189{left:241px;bottom:302px;}
#t1i_189{left:255px;bottom:302px;letter-spacing:-0.18px;}
#t1j_189{left:288px;bottom:302px;}
#t1k_189{left:300px;bottom:302px;letter-spacing:-0.21px;word-spacing:1.49px;}
#t1l_189{left:181px;bottom:281px;letter-spacing:-0.17px;}
#t1m_189{left:220px;bottom:281px;}
#t1n_189{left:229px;bottom:281px;}
#t1o_189{left:241px;bottom:281px;}
#t1p_189{left:255px;bottom:281px;letter-spacing:-0.14px;word-spacing:1.39px;}
#t1q_189{left:361px;bottom:281px;}
#t1r_189{left:110px;bottom:246px;letter-spacing:-0.22px;}
#t1s_189{left:140px;bottom:246px;letter-spacing:-0.43px;}
#t1t_189{left:199px;bottom:246px;letter-spacing:-0.14px;word-spacing:3.87px;}
#t1u_189{left:110px;bottom:226px;letter-spacing:-0.15px;word-spacing:1.56px;}
#t1v_189{left:110px;bottom:205px;letter-spacing:-0.14px;}
#t1w_189{left:165px;bottom:205px;letter-spacing:-0.15px;word-spacing:3.2px;}
#t1x_189{left:110px;bottom:184px;letter-spacing:-0.16px;word-spacing:2.6px;}
#t1y_189{left:110px;bottom:164px;letter-spacing:-0.17px;word-spacing:1.84px;}
#t1z_189{left:110px;bottom:143px;letter-spacing:-0.21px;word-spacing:1.92px;}
#t20_189{left:110px;bottom:122px;letter-spacing:-0.12px;word-spacing:1.34px;}

.s1_189{font-size:17px;font-family:CMSL10_27d;color:#000;}
.s2_189{font-size:17px;font-family:CMR10_270;color:#000;}
.s3_189{font-size:17px;font-family:CMSY10_27j;color:#000;}
.s4_189{font-size:18px;font-family:CMBX12_26j;color:#000;}
.s5_189{font-size:18px;font-family:CMBX12_26j;color:#000080;}
.s6_189{font-size:17px;font-family:CMR10_270;color:#000080;}
.s7_189{font-size:17px;font-family:CMMI10_26t;color:#000;}
.s8_189{font-size:17px;font-family:CMTI10_27t;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts189" type="text/css" >

@font-face {
	font-family: CMBX12_26j;
	src: url("fonts/CMBX12_26j.woff") format("woff");
}

@font-face {
	font-family: CMMI10_26t;
	src: url("fonts/CMMI10_26t.woff") format("woff");
}

@font-face {
	font-family: CMR10_270;
	src: url("fonts/CMR10_270.woff") format("woff");
}

@font-face {
	font-family: CMSL10_27d;
	src: url("fonts/CMSL10_27d.woff") format("woff");
}

@font-face {
	font-family: CMSY10_27j;
	src: url("fonts/CMSY10_27j.woff") format("woff");
}

@font-face {
	font-family: CMTI10_27t;
	src: url("fonts/CMTI10_27t.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg189Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg189" style="-webkit-user-select: none;"><object width="935" height="1210" data="189/189.svg" type="image/svg+xml" id="pdf189" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_189" class="t s1_189">Volume I: RISC-V Unprivileged ISA V20191213 </span><span id="t2_189" class="t s2_189">171 </span>
<span id="t3_189" class="t s2_189">By default, the FENCE instruction ensures that all memory accesses from instructions preceding </span>
<span id="t4_189" class="t s2_189">the fence in program order (the “predecessor set”) appear earlier in the global memory order than </span>
<span id="t5_189" class="t s2_189">memory accesses from instructions appearing after the fence in program order (the “successor set”). </span>
<span id="t6_189" class="t s2_189">However, fences can optionally further restrict the predecessor set and/or the successor set to a </span>
<span id="t7_189" class="t s2_189" data-mappings='[[70,"fi"]]'>smaller set of memory accesses in order to provide some speedup. Speciﬁcally, fences have PR, PW, </span>
<span id="t8_189" class="t s2_189">SR, and SW bits which restrict the predecessor and/or successor sets. The predecessor set includes </span>
<span id="t9_189" class="t s2_189">loads (resp. stores) if and only if PR (resp. PW) is set. Similarly, the successor set includes loads </span>
<span id="ta_189" class="t s2_189">(resp. stores) if and only if SR (resp. SW) is set. </span>
<span id="tb_189" class="t s2_189">The FENCE encoding currently has nine non-trivial combinations of the four bits PR, PW, SR, </span>
<span id="tc_189" class="t s2_189">and SW, plus one extra encoding FENCE.TSO which facilitates mapping of “acquire+release” or </span>
<span id="td_189" class="t s2_189">RVTSO semantics. The remaining seven combinations have empty predecessor and/or successor </span>
<span id="te_189" class="t s2_189">sets and hence are no-ops. Of the ten non-trivial options, only six are commonly used in practice: </span>
<span id="tf_189" class="t s3_189">• </span><span id="tg_189" class="t s2_189">FENCE RW,RW </span>
<span id="th_189" class="t s3_189">• </span><span id="ti_189" class="t s2_189">FENCE.TSO </span>
<span id="tj_189" class="t s3_189">• </span><span id="tk_189" class="t s2_189">FENCE RW,W </span>
<span id="tl_189" class="t s3_189">• </span><span id="tm_189" class="t s2_189">FENCE R,RW </span>
<span id="tn_189" class="t s3_189">• </span><span id="to_189" class="t s2_189">FENCE R,R </span>
<span id="tp_189" class="t s3_189">• </span><span id="tq_189" class="t s2_189">FENCE W,W </span>
<span id="tr_189" class="t s2_189">FENCE instructions using any other combination of PR, PW, SR, and SW are reserved. </span><span id="ts_189" class="t s2_189">We </span>
<span id="tt_189" class="t s2_189">strongly recommend that programmers stick to these six. Other combinations may have unknown </span>
<span id="tu_189" class="t s2_189">or unexpected interactions with the memory model. </span>
<span id="tv_189" class="t s2_189">Finally, we note that since RISC-V uses a multi-copy atomic memory model, programmers can rea- </span>
<span id="tw_189" class="t s2_189">son about fences bits in a thread-local manner. There is no complex notion of “fence cumulativity” </span>
<span id="tx_189" class="t s2_189">as found in memory models that are not multi-copy atomic. </span>
<span id="ty_189" class="t s4_189">A.3.7 </span><span id="tz_189" class="t s4_189">Explicit Synchronization (Rules </span><span id="t10_189" class="t s5_189">5</span><span id="t11_189" class="t s4_189">–</span><span id="t12_189" class="t s5_189">8</span><span id="t13_189" class="t s4_189">) </span>
<span id="t14_189" class="t s2_189">Rule </span><span id="t15_189" class="t s6_189">5</span><span id="t16_189" class="t s2_189">: </span><span id="t17_189" class="t s7_189">a </span><span id="t18_189" class="t s2_189">has an acquire annotation </span>
<span id="t19_189" class="t s2_189">Rule </span><span id="t1a_189" class="t s6_189">6</span><span id="t1b_189" class="t s2_189">: </span><span id="t1c_189" class="t s7_189">b </span><span id="t1d_189" class="t s2_189">has a release annotation </span>
<span id="t1e_189" class="t s2_189">Rule </span><span id="t1f_189" class="t s6_189">7</span><span id="t1g_189" class="t s2_189">: </span><span id="t1h_189" class="t s7_189">a </span><span id="t1i_189" class="t s2_189">and </span><span id="t1j_189" class="t s7_189">b </span><span id="t1k_189" class="t s2_189">both have RCsc annotations </span>
<span id="t1l_189" class="t s2_189">Rule </span><span id="t1m_189" class="t s6_189">8</span><span id="t1n_189" class="t s2_189">: </span><span id="t1o_189" class="t s7_189">a </span><span id="t1p_189" class="t s2_189">is paired with </span><span id="t1q_189" class="t s7_189">b </span>
<span id="t1r_189" class="t s2_189">An </span><span id="t1s_189" class="t s8_189">acquire </span><span id="t1t_189" class="t s2_189">operation, as would be used at the start of a critical section, requires all memory </span>
<span id="t1u_189" class="t s2_189">operations following the acquire in program order to also follow the acquire in the global memory </span>
<span id="t1v_189" class="t s2_189">order. </span><span id="t1w_189" class="t s2_189">This ensures, for example, that all loads and stores inside the critical section are up to </span>
<span id="t1x_189" class="t s2_189">date with respect to the synchronization variable being used to protect it. Acquire ordering can </span>
<span id="t1y_189" class="t s2_189">be enforced in one of two ways: with an acquire annotation, which enforces ordering with respect </span>
<span id="t1z_189" class="t s2_189">to just the synchronization variable itself, or with a FENCE R,RW, which enforces ordering with </span>
<span id="t20_189" class="t s2_189">respect to all previous loads. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
