<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p180" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_180{left:110px;bottom:1129px;letter-spacing:-0.17px;}
#t2_180{left:475px;bottom:1129px;letter-spacing:-0.21px;word-spacing:1.47px;}
#t3_180{left:110px;bottom:1082px;letter-spacing:-0.14px;word-spacing:0.4px;}
#t4_180{left:110px;bottom:1062px;letter-spacing:-0.29px;word-spacing:1.62px;}
#t5_180{left:110px;bottom:1026px;letter-spacing:-0.19px;word-spacing:2.53px;}
#t6_180{left:110px;bottom:1005px;letter-spacing:-0.23px;word-spacing:1.36px;}
#t7_180{left:110px;bottom:984px;letter-spacing:-0.26px;word-spacing:1.34px;}
#t8_180{left:110px;bottom:964px;letter-spacing:-0.18px;word-spacing:1.82px;}
#t9_180{left:110px;bottom:943px;letter-spacing:-0.17px;word-spacing:1.43px;}
#ta_180{left:110px;bottom:873px;letter-spacing:-0.05px;}
#tb_180{left:172px;bottom:873px;letter-spacing:-0.35px;word-spacing:3.35px;}
#tc_180{left:110px;bottom:823px;letter-spacing:-0.18px;word-spacing:2.4px;}
#td_180{left:452px;bottom:823px;letter-spacing:-0.14px;word-spacing:2.67px;}
#te_180{left:535px;bottom:823px;letter-spacing:-0.15px;word-spacing:2.37px;}
#tf_180{left:110px;bottom:802px;letter-spacing:-0.14px;word-spacing:1.77px;}
#tg_180{left:546px;bottom:802px;letter-spacing:-0.17px;}
#th_180{left:577px;bottom:802px;letter-spacing:-0.2px;word-spacing:1.62px;}
#ti_180{left:110px;bottom:781px;letter-spacing:-0.21px;word-spacing:2.53px;}
#tj_180{left:110px;bottom:761px;letter-spacing:-0.16px;word-spacing:1.17px;}
#tk_180{left:203px;bottom:761px;letter-spacing:-0.17px;}
#tl_180{left:221px;bottom:761px;}
#tm_180{left:229px;bottom:761px;letter-spacing:-0.17px;}
#tn_180{left:252px;bottom:761px;letter-spacing:-0.17px;word-spacing:1.21px;}
#to_180{left:620px;bottom:761px;letter-spacing:-0.18px;}
#tp_180{left:642px;bottom:761px;letter-spacing:-0.12px;word-spacing:1.1px;}
#tq_180{left:110px;bottom:740px;}
#tr_180{left:119px;bottom:740px;}
#ts_180{left:130px;bottom:740px;letter-spacing:-0.17px;}
#tt_180{left:154px;bottom:740px;letter-spacing:-0.15px;}
#tu_180{left:198px;bottom:740px;}
#tv_180{left:207px;bottom:740px;letter-spacing:-0.15px;word-spacing:2.27px;}
#tw_180{left:251px;bottom:740px;letter-spacing:-0.17px;}
#tx_180{left:275px;bottom:740px;letter-spacing:-0.15px;}
#ty_180{left:319px;bottom:740px;}
#tz_180{left:328px;bottom:740px;letter-spacing:-0.15px;word-spacing:2.27px;}
#t10_180{left:388px;bottom:740px;}
#t11_180{left:396px;bottom:740px;}
#t12_180{left:407px;bottom:740px;}
#t13_180{left:416px;bottom:740px;letter-spacing:-0.15px;word-spacing:2.27px;}
#t14_180{left:460px;bottom:740px;}
#t15_180{left:475px;bottom:740px;letter-spacing:-0.16px;word-spacing:2.12px;}
#t16_180{left:110px;bottom:719px;letter-spacing:-0.15px;word-spacing:0.77px;}
#t17_180{left:110px;bottom:698px;letter-spacing:-0.24px;word-spacing:1.6px;}
#t18_180{left:195px;bottom:665px;letter-spacing:0.12px;word-spacing:4.19px;}
#t19_180{left:345px;bottom:665px;letter-spacing:0.12px;word-spacing:4.19px;}
#t1a_180{left:194px;bottom:648px;}
#t1b_180{left:194px;bottom:642px;}
#t1c_180{left:194px;bottom:636px;}
#t1d_180{left:347px;bottom:648px;}
#t1e_180{left:347px;bottom:642px;}
#t1f_180{left:347px;bottom:636px;}
#t1g_180{left:194px;bottom:617px;letter-spacing:0.12px;word-spacing:4.19px;}
#t1h_180{left:347px;bottom:617px;letter-spacing:0.12px;word-spacing:4.19px;}
#t1i_180{left:152px;bottom:599px;letter-spacing:0.12px;}
#t1j_180{left:194px;bottom:599px;letter-spacing:0.12px;word-spacing:4.19px;}
#t1k_180{left:304px;bottom:599px;letter-spacing:0.12px;}
#t1l_180{left:347px;bottom:599px;letter-spacing:0.12px;word-spacing:4.19px;}
#t1m_180{left:194px;bottom:582px;}
#t1n_180{left:194px;bottom:576px;}
#t1o_180{left:194px;bottom:570px;}
#t1p_180{left:347px;bottom:582px;}
#t1q_180{left:347px;bottom:576px;}
#t1r_180{left:347px;bottom:570px;}
#t1s_180{left:194px;bottom:552px;letter-spacing:0.12px;word-spacing:4.19px;}
#t1t_180{left:152px;bottom:534px;letter-spacing:0.12px;}
#t1u_180{left:194px;bottom:534px;letter-spacing:0.12px;word-spacing:4.19px;}
#t1v_180{left:194px;bottom:517px;}
#t1w_180{left:194px;bottom:511px;}
#t1x_180{left:194px;bottom:505px;}
#t1y_180{left:347px;bottom:517px;}
#t1z_180{left:347px;bottom:511px;}
#t20_180{left:347px;bottom:505px;}
#t21_180{left:152px;bottom:487px;letter-spacing:0.12px;}
#t22_180{left:194px;bottom:487px;letter-spacing:0.12px;word-spacing:4.19px;}
#t23_180{left:194px;bottom:470px;}
#t24_180{left:194px;bottom:464px;}
#t25_180{left:194px;bottom:458px;}
#t26_180{left:347px;bottom:470px;}
#t27_180{left:347px;bottom:464px;}
#t28_180{left:347px;bottom:458px;}
#t29_180{left:194px;bottom:440px;letter-spacing:0.12px;word-spacing:4.19px;}
#t2a_180{left:347px;bottom:440px;letter-spacing:0.12px;word-spacing:4.19px;}
#t2b_180{left:152px;bottom:422px;letter-spacing:0.12px;}
#t2c_180{left:194px;bottom:422px;letter-spacing:0.12px;word-spacing:4.19px;}
#t2d_180{left:304px;bottom:422px;letter-spacing:0.12px;}
#t2e_180{left:347px;bottom:422px;letter-spacing:0.12px;word-spacing:4.19px;}
#t2f_180{left:194px;bottom:405px;}
#t2g_180{left:194px;bottom:399px;}
#t2h_180{left:194px;bottom:393px;}
#t2i_180{left:347px;bottom:405px;}
#t2j_180{left:347px;bottom:399px;}
#t2k_180{left:347px;bottom:393px;}
#t2l_180{left:534px;bottom:639px;letter-spacing:0.14px;word-spacing:3.38px;}
#t2m_180{left:533px;bottom:565px;letter-spacing:0.14px;word-spacing:3.38px;}
#t2n_180{left:536px;bottom:491px;letter-spacing:0.13px;word-spacing:3.38px;}
#t2o_180{left:533px;bottom:416px;letter-spacing:0.14px;word-spacing:3.38px;}
#t2p_180{left:646px;bottom:584px;letter-spacing:0.14px;word-spacing:3.38px;}
#t2q_180{left:647px;bottom:509px;letter-spacing:0.14px;word-spacing:3.38px;}
#t2r_180{left:579px;bottom:609px;letter-spacing:0.12px;}
#t2s_180{left:617px;bottom:573px;letter-spacing:0.08px;}
#t2t_180{left:537px;bottom:610px;letter-spacing:0.12px;}
#t2u_180{left:614px;bottom:499px;letter-spacing:0.12px;}
#t2v_180{left:502px;bottom:573px;letter-spacing:0.08px;}
#t2w_180{left:553px;bottom:514px;letter-spacing:0.08px;}
#t2x_180{left:553px;bottom:462px;letter-spacing:0.08px;}
#t2y_180{left:660px;bottom:532px;letter-spacing:0.12px;}
#t2z_180{left:212px;bottom:358px;letter-spacing:-0.16px;word-spacing:1.59px;}
#t30_180{left:677px;bottom:358px;letter-spacing:-0.18px;}
#t31_180{left:712px;bottom:358px;letter-spacing:-0.11px;}
#t32_180{left:110px;bottom:318px;letter-spacing:-0.15px;word-spacing:3.13px;}
#t33_180{left:110px;bottom:297px;letter-spacing:-0.19px;word-spacing:1.7px;}
#t34_180{left:495px;bottom:297px;letter-spacing:-0.17px;}
#t35_180{left:520px;bottom:297px;letter-spacing:-0.23px;word-spacing:1.56px;}
#t36_180{left:658px;bottom:297px;letter-spacing:-0.18px;}
#t37_180{left:681px;bottom:297px;letter-spacing:-0.14px;word-spacing:1.37px;}
#t38_180{left:110px;bottom:276px;letter-spacing:-0.16px;word-spacing:2.75px;}
#t39_180{left:110px;bottom:256px;letter-spacing:-0.19px;word-spacing:2.64px;}
#t3a_180{left:241px;bottom:256px;letter-spacing:-0.23px;word-spacing:2.81px;}
#t3b_180{left:573px;bottom:256px;letter-spacing:-0.18px;}
#t3c_180{left:597px;bottom:256px;letter-spacing:-0.15px;word-spacing:2.56px;}
#t3d_180{left:110px;bottom:235px;letter-spacing:-0.2px;word-spacing:1.55px;}
#t3e_180{left:110px;bottom:214px;letter-spacing:-0.19px;word-spacing:1.58px;}
#t3f_180{left:110px;bottom:178px;letter-spacing:-0.19px;word-spacing:1.4px;}
#t3g_180{left:110px;bottom:158px;letter-spacing:-0.14px;word-spacing:-0.21px;}
#t3h_180{left:110px;bottom:137px;letter-spacing:-0.13px;word-spacing:1.7px;}
#t3i_180{left:110px;bottom:116px;letter-spacing:-0.15px;word-spacing:2.61px;}
#t3j_180{left:283px;bottom:116px;letter-spacing:-0.14px;word-spacing:2.61px;}
#t3k_180{left:483px;bottom:116px;letter-spacing:-0.15px;}
#t3l_180{left:521px;bottom:116px;letter-spacing:-0.14px;word-spacing:2.55px;}
#t3m_180{left:752px;bottom:116px;letter-spacing:-0.17px;}
#t3n_180{left:777px;bottom:116px;}
#t3o_180{left:793px;bottom:116px;letter-spacing:-0.16px;}

.s1_180{font-size:17px;font-family:CMR10_270;color:#000;}
.s2_180{font-size:17px;font-family:CMSL10_27d;color:#000;}
.s3_180{font-size:22px;font-family:CMBX12_26j;color:#000;}
.s4_180{font-size:17px;font-family:CMTI10_27t;color:#000;}
.s5_180{font-size:17px;font-family:CMR10_270;color:#000080;}
.s6_180{font-size:17px;font-family:CMTT10_27z;color:#000;}
.s7_180{font-size:15px;font-family:CMTT10_27z;color:#000;}
.s8_180{font-size:18px;font-family:CMSS12_27h;color:#000;}
.s9_180{font-size:18px;font-family:CMSS12_27h;color:#00F;}
.sa_180{font-size:18px;font-family:CMSS12_27h;color:#F00;}
.sb_180{font-size:18px;font-family:CMSS12_27h;color:#FFA040;}
.sc_180{font-size:17px;font-family:CMSS10_27f;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts180" type="text/css" >

@font-face {
	font-family: CMBX12_26j;
	src: url("fonts/CMBX12_26j.woff") format("woff");
}

@font-face {
	font-family: CMR10_270;
	src: url("fonts/CMR10_270.woff") format("woff");
}

@font-face {
	font-family: CMSL10_27d;
	src: url("fonts/CMSL10_27d.woff") format("woff");
}

@font-face {
	font-family: CMSS10_27f;
	src: url("fonts/CMSS10_27f.woff") format("woff");
}

@font-face {
	font-family: CMSS12_27h;
	src: url("fonts/CMSS12_27h.woff") format("woff");
}

@font-face {
	font-family: CMTI10_27t;
	src: url("fonts/CMTI10_27t.woff") format("woff");
}

@font-face {
	font-family: CMTT10_27z;
	src: url("fonts/CMTT10_27z.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg180Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg180" style="-webkit-user-select: none;"><object width="935" height="1210" data="180/180.svg" type="image/svg+xml" id="pdf180" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_180" class="t s1_180">162 </span><span id="t2_180" class="t s2_180">Volume I: RISC-V Unprivileged ISA V20191213 </span>
<span id="t3_180" class="t s1_180">(e.g., to facilitate porting from x86) or whether to instead prioritize compatibility with other RISC- </span>
<span id="t4_180" class="t s1_180">V cores implementing RVWMO. </span>
<span id="t5_180" class="t s1_180">Some fences and/or memory ordering annotations in code written for RVWMO may become re- </span>
<span id="t6_180" class="t s1_180">dundant under RVTSO; the cost that the default of RVWMO imposes on Ztso implementations is </span>
<span id="t7_180" class="t s1_180">the incremental overhead of fetching those fences (e.g., FENCE R,RW and FENCE RW,W) which </span>
<span id="t8_180" class="t s1_180">become no-ops on that implementation. However, these fences must remain present in the code if </span>
<span id="t9_180" class="t s1_180">compatibility with non-Ztso implementations is desired. </span>
<span id="ta_180" class="t s3_180">A.2 </span><span id="tb_180" class="t s3_180">Litmus Tests </span>
<span id="tc_180" class="t s1_180">The explanations in this chapter make use of </span><span id="td_180" class="t s4_180">litmus tests</span><span id="te_180" class="t s1_180">, or small programs designed to test or </span>
<span id="tf_180" class="t s1_180">highlight one particular aspect of a memory model. Figure </span><span id="tg_180" class="t s5_180">A.1 </span><span id="th_180" class="t s1_180">shows an example of a litmus test </span>
<span id="ti_180" class="t s1_180" data-mappings='[[41,"fi"],[59,"fi"]]'>with two harts. As a convention for this ﬁgure and for all ﬁgures that follow in this chapter, we </span>
<span id="tj_180" class="t s1_180">assume that </span><span id="tk_180" class="t s6_180">s0</span><span id="tl_180" class="t s1_180">–</span><span id="tm_180" class="t s6_180">s2 </span><span id="tn_180" class="t s1_180">are pre-set to the same value in all harts and that </span><span id="to_180" class="t s6_180">s0 </span><span id="tp_180" class="t s1_180">holds the address labeled </span>
<span id="tq_180" class="t s6_180">x</span><span id="tr_180" class="t s1_180">, </span><span id="ts_180" class="t s6_180">s1 </span><span id="tt_180" class="t s1_180">holds </span><span id="tu_180" class="t s6_180">y</span><span id="tv_180" class="t s1_180">, and </span><span id="tw_180" class="t s6_180">s2 </span><span id="tx_180" class="t s1_180">holds </span><span id="ty_180" class="t s6_180">z</span><span id="tz_180" class="t s1_180">, where </span><span id="t10_180" class="t s6_180">x</span><span id="t11_180" class="t s1_180">, </span><span id="t12_180" class="t s6_180">y</span><span id="t13_180" class="t s1_180">, and </span><span id="t14_180" class="t s6_180">z </span><span id="t15_180" class="t s1_180">are disjoint memory locations aligned to 8 byte </span>
<span id="t16_180" class="t s1_180" data-mappings='[[17,"fi"]]'>boundaries. Each ﬁgure shows the litmus test code on the left, and a visualization of one particular </span>
<span id="t17_180" class="t s1_180">valid or invalid execution on the right. </span>
<span id="t18_180" class="t s7_180">Hart 0 </span><span id="t19_180" class="t s7_180">Hart 1 </span>
<span id="t1a_180" class="t s7_180">. </span>
<span id="t1b_180" class="t s7_180">. </span>
<span id="t1c_180" class="t s7_180">. </span>
<span id="t1d_180" class="t s7_180">. </span>
<span id="t1e_180" class="t s7_180">. </span>
<span id="t1f_180" class="t s7_180">. </span>
<span id="t1g_180" class="t s7_180">li t1,1 </span><span id="t1h_180" class="t s7_180">li t4,4 </span>
<span id="t1i_180" class="t s7_180">(a) </span><span id="t1j_180" class="t s7_180">sw t1,0(s0) </span><span id="t1k_180" class="t s7_180">(e) </span><span id="t1l_180" class="t s7_180">sw t4,0(s0) </span>
<span id="t1m_180" class="t s7_180">. </span>
<span id="t1n_180" class="t s7_180">. </span>
<span id="t1o_180" class="t s7_180">. </span>
<span id="t1p_180" class="t s7_180">. </span>
<span id="t1q_180" class="t s7_180">. </span>
<span id="t1r_180" class="t s7_180">. </span>
<span id="t1s_180" class="t s7_180">li t2,2 </span>
<span id="t1t_180" class="t s7_180">(b) </span><span id="t1u_180" class="t s7_180">sw t2,0(s0) </span>
<span id="t1v_180" class="t s7_180">. </span>
<span id="t1w_180" class="t s7_180">. </span>
<span id="t1x_180" class="t s7_180">. </span>
<span id="t1y_180" class="t s7_180">. </span>
<span id="t1z_180" class="t s7_180">. </span>
<span id="t20_180" class="t s7_180">. </span>
<span id="t21_180" class="t s7_180">(c) </span><span id="t22_180" class="t s7_180">lw a0,0(s0) </span>
<span id="t23_180" class="t s7_180">. </span>
<span id="t24_180" class="t s7_180">. </span>
<span id="t25_180" class="t s7_180">. </span>
<span id="t26_180" class="t s7_180">. </span>
<span id="t27_180" class="t s7_180">. </span>
<span id="t28_180" class="t s7_180">. </span>
<span id="t29_180" class="t s7_180">li t3,3 </span><span id="t2a_180" class="t s7_180">li t5,5 </span>
<span id="t2b_180" class="t s7_180">(d) </span><span id="t2c_180" class="t s7_180">sw t3,0(s0) </span><span id="t2d_180" class="t s7_180">(f) </span><span id="t2e_180" class="t s7_180">sw t5,0(s0) </span>
<span id="t2f_180" class="t s7_180">. </span>
<span id="t2g_180" class="t s7_180">. </span>
<span id="t2h_180" class="t s7_180">. </span>
<span id="t2i_180" class="t s7_180">. </span>
<span id="t2j_180" class="t s7_180">. </span>
<span id="t2k_180" class="t s7_180">. </span>
<span id="t2l_180" class="t s8_180">a: Wx=1 </span>
<span id="t2m_180" class="t s8_180">b: Wx=2 </span>
<span id="t2n_180" class="t s8_180">c: Rx=1 </span>
<span id="t2o_180" class="t s8_180">d: Wx=3 </span>
<span id="t2p_180" class="t s8_180">e: Wx=4 </span>
<span id="t2q_180" class="t s8_180">f: Wx=5 </span>
<span id="t2r_180" class="t s9_180">co </span>
<span id="t2s_180" class="t sa_180">rf </span>
<span id="t2t_180" class="t s9_180">co </span>
<span id="t2u_180" class="t s9_180">co </span>
<span id="t2v_180" class="t sb_180">fr </span>
<span id="t2w_180" class="t sb_180">fr </span>
<span id="t2x_180" class="t sb_180">fr </span>
<span id="t2y_180" class="t s9_180">co </span>
<span id="t2z_180" class="t s1_180">Figure A.1: A sample litmus test and one forbidden execution (</span><span id="t30_180" class="t s6_180">a0=1</span><span id="t31_180" class="t s1_180">). </span>
<span id="t32_180" class="t s1_180" data-mappings='[[81,"fi"]]'>Litmus tests are used to understand the implications of the memory model in speciﬁc concrete </span>
<span id="t33_180" class="t s1_180">situations. For example, in the litmus test of Figure </span><span id="t34_180" class="t s5_180">A.1</span><span id="t35_180" class="t s1_180" data-mappings='[[6,"fi"]]'>, the ﬁnal value of </span><span id="t36_180" class="t s6_180">a0 </span><span id="t37_180" class="t s1_180" data-mappings='[[7,"fi"]]'>in the ﬁrst hart can </span>
<span id="t38_180" class="t s1_180">be either 2, 4, or 5, depending on the dynamic interleaving of the instruction stream from each </span>
<span id="t39_180" class="t s1_180">hart at runtime. </span><span id="t3a_180" class="t s1_180" data-mappings='[[30,"fi"]]'>However, in this example, the ﬁnal value of </span><span id="t3b_180" class="t s6_180">a0 </span><span id="t3c_180" class="t s1_180">in Hart 0 will never be 1 or 3; </span>
<span id="t3d_180" class="t s1_180">intuitively, the value 1 will no longer be visible at the time the load executes, and the value 3 will </span>
<span id="t3e_180" class="t s1_180">not yet be visible by the time the load executes. We analyze this test and many others below. </span>
<span id="t3f_180" class="t s1_180">The diagram shown to the right of each litmus test shows a visual representation of the particular </span>
<span id="t3g_180" class="t s1_180">execution candidate being considered. These diagrams use a notation that is common in the memory </span>
<span id="t3h_180" class="t s1_180">model literature for constraining the set of possible global memory orders that could produce the </span>
<span id="t3i_180" class="t s1_180">execution in question. </span><span id="t3j_180" class="t s1_180">It is also the basis for the </span><span id="t3k_180" class="t sc_180">herd </span><span id="t3l_180" class="t s1_180">models presented in Appendix </span><span id="t3m_180" class="t s5_180">B.2</span><span id="t3n_180" class="t s1_180">. </span><span id="t3o_180" class="t s1_180">This </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
