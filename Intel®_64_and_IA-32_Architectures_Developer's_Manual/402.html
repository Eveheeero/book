<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p402" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_402{left:69px;bottom:68px;letter-spacing:0.11px;}
#t2_402{left:103px;bottom:68px;letter-spacing:0.09px;}
#t3_402{left:69px;bottom:1141px;letter-spacing:-0.14px;word-spacing:0.02px;}
#t4_402{left:69px;bottom:1084px;letter-spacing:-0.09px;}
#t5_402{left:154px;bottom:1084px;letter-spacing:-0.1px;word-spacing:0.02px;}
#t6_402{left:69px;bottom:1062px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t7_402{left:69px;bottom:1045px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t8_402{left:69px;bottom:1028px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#t9_402{left:69px;bottom:978px;letter-spacing:-0.1px;}
#ta_402{left:154px;bottom:978px;letter-spacing:-0.1px;word-spacing:0.01px;}
#tb_402{left:69px;bottom:954px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#tc_402{left:69px;bottom:937px;letter-spacing:-0.14px;word-spacing:-1.05px;}
#td_402{left:69px;bottom:920px;letter-spacing:-0.16px;word-spacing:-0.46px;}
#te_402{left:69px;bottom:904px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tf_402{left:69px;bottom:887px;letter-spacing:-0.15px;word-spacing:-0.48px;}
#tg_402{left:69px;bottom:828px;letter-spacing:0.13px;}
#th_402{left:151px;bottom:828px;letter-spacing:0.15px;word-spacing:0.01px;}
#ti_402{left:69px;bottom:806px;letter-spacing:-0.15px;word-spacing:-0.72px;}
#tj_402{left:69px;bottom:789px;letter-spacing:-0.15px;word-spacing:-0.78px;}
#tk_402{left:69px;bottom:772px;letter-spacing:-0.15px;word-spacing:-0.49px;}
#tl_402{left:69px;bottom:714px;letter-spacing:0.13px;}
#tm_402{left:151px;bottom:714px;letter-spacing:0.15px;word-spacing:0.01px;}
#tn_402{left:69px;bottom:691px;letter-spacing:-0.16px;word-spacing:-0.98px;}
#to_402{left:69px;bottom:674px;letter-spacing:-0.14px;word-spacing:-0.44px;}
#tp_402{left:69px;bottom:648px;}
#tq_402{left:95px;bottom:652px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#tr_402{left:95px;bottom:635px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#ts_402{left:95px;bottom:618px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tt_402{left:95px;bottom:601px;letter-spacing:-0.17px;word-spacing:-0.43px;}
#tu_402{left:69px;bottom:575px;}
#tv_402{left:95px;bottom:578px;letter-spacing:-0.14px;word-spacing:-1.06px;}
#tw_402{left:95px;bottom:561px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tx_402{left:95px;bottom:545px;letter-spacing:-0.14px;word-spacing:-0.63px;}
#ty_402{left:95px;bottom:528px;letter-spacing:-0.13px;word-spacing:-0.48px;}
#tz_402{left:95px;bottom:511px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t10_402{left:69px;bottom:488px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t11_402{left:69px;bottom:471px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t12_402{left:69px;bottom:454px;letter-spacing:-0.13px;word-spacing:-1.21px;}
#t13_402{left:69px;bottom:438px;letter-spacing:-0.14px;word-spacing:-0.52px;}
#t14_402{left:69px;bottom:379px;letter-spacing:0.13px;}
#t15_402{left:151px;bottom:379px;letter-spacing:0.15px;word-spacing:0.01px;}
#t16_402{left:69px;bottom:357px;letter-spacing:-0.17px;word-spacing:-0.84px;}
#t17_402{left:69px;bottom:340px;letter-spacing:-0.14px;word-spacing:-1.15px;}
#t18_402{left:69px;bottom:323px;letter-spacing:-0.14px;word-spacing:-0.64px;}
#t19_402{left:69px;bottom:306px;letter-spacing:-0.15px;word-spacing:-0.43px;}
#t1a_402{left:69px;bottom:256px;letter-spacing:-0.08px;}
#t1b_402{left:155px;bottom:256px;letter-spacing:-0.1px;word-spacing:-0.01px;}
#t1c_402{left:69px;bottom:234px;letter-spacing:-0.17px;word-spacing:-1.3px;}
#t1d_402{left:69px;bottom:217px;letter-spacing:-0.15px;word-spacing:-1.15px;}
#t1e_402{left:69px;bottom:200px;letter-spacing:-0.14px;word-spacing:-1.19px;}
#t1f_402{left:69px;bottom:183px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#t1g_402{left:69px;bottom:166px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t1h_402{left:69px;bottom:150px;letter-spacing:-0.21px;word-spacing:-0.46px;}
#t1i_402{left:69px;bottom:127px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t1j_402{left:69px;bottom:110px;letter-spacing:-0.13px;word-spacing:-1.03px;}

.s1_402{font-size:12px;font-family:NeoSansIntel_6wv3;color:#000;}
.s2_402{font-size:14px;font-family:NeoSansIntel_6wv3;color:#0860A8;}
.s3_402{font-size:17px;font-family:NeoSansIntelMedium_6wv2;color:#0860A8;}
.s4_402{font-size:14px;font-family:Verdana_b5t;color:#000;}
.s5_402{font-size:18px;font-family:NeoSansIntelMedium_6wv2;color:#0860A8;}
.s6_402{font-size:21px;font-family:TimesNewRoman_b5y;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts402" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_6wv2;
	src: url("fonts/NeoSansIntelMedium_6wv2.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_6wv3;
	src: url("fonts/NeoSansIntel_6wv3.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_b5y;
	src: url("fonts/TimesNewRoman_b5y.woff") format("woff");
}

@font-face {
	font-family: Verdana_b5t;
	src: url("fonts/Verdana_b5t.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg402Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg402" style="-webkit-user-select: none;"><object width="935" height="1210" data="402/402.svg" type="image/svg+xml" id="pdf402" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_402" class="t s1_402">16-4 </span><span id="t2_402" class="t s1_402">Vol. 1 </span>
<span id="t3_402" class="t s2_402">PROGRAMMING WITH INTEL® TRANSACTIONAL SYNCHRONIZATION EXTENSIONS </span>
<span id="t4_402" class="t s3_402">16.3.1.3 </span><span id="t5_402" class="t s3_402">Detection of XTEST Instruction </span>
<span id="t6_402" class="t s4_402">A processor supports the XTEST instruction if it supports either HLE or RTM. An application must check either of </span>
<span id="t7_402" class="t s4_402">these feature flags before using the XTEST instruction. This instruction will generate a #UD exception when used </span>
<span id="t8_402" class="t s4_402">on a processor that does not support either HLE or RTM. </span>
<span id="t9_402" class="t s3_402">16.3.1.4 </span><span id="ta_402" class="t s3_402">Detection of Intel® TSX Suspend Load Address Tracking </span>
<span id="tb_402" class="t s4_402">A processor supports Intel TSX suspend/resume of load address tracking if CPUID.07H.EDX.TSXLDTRK [bit 16] = </span>
<span id="tc_402" class="t s4_402">1. An application must check if the processor supports Intel TSX suspend/resume of load address tracking before it </span>
<span id="td_402" class="t s4_402">uses the Intel TSX suspend/resume load address tracking instructions (XSUSLDTRK and XRESLDTRK). These </span>
<span id="te_402" class="t s4_402">instructions will generate a #UD exception when used on a processor that does not support Intel TSX </span>
<span id="tf_402" class="t s4_402">suspend/resume load address tracking. </span>
<span id="tg_402" class="t s5_402">16.3.2 </span><span id="th_402" class="t s5_402">Querying Transactional Execution Status </span>
<span id="ti_402" class="t s4_402">The XTEST instruction can be used to determine the transactional status of a transactional region specified by HLE </span>
<span id="tj_402" class="t s4_402">or RTM. Note, while the HLE prefixes are ignored on processors that do not support HLE, the XTEST instruction will </span>
<span id="tk_402" class="t s4_402">generate a #UD exception when used on processors that do not support either HLE or RTM. </span>
<span id="tl_402" class="t s5_402">16.3.3 </span><span id="tm_402" class="t s5_402">Requirements for HLE Locks </span>
<span id="tn_402" class="t s4_402">For HLE execution to successfully commit transactionally, the lock must satisfy certain properties and access to the </span>
<span id="to_402" class="t s4_402">lock must follow certain guidelines. </span>
<span id="tp_402" class="t s6_402">• </span><span id="tq_402" class="t s4_402">An XRELEASE prefixed instruction must restore the value of the elided lock to the value it had before the lock </span>
<span id="tr_402" class="t s4_402">acquisition. This allows hardware to safely elide locks by not adding them to the write-set. The data size and </span>
<span id="ts_402" class="t s4_402">data address of the lock release (XRELEASE prefixed) instruction must match that of the lock acquire </span>
<span id="tt_402" class="t s4_402">(XACQUIRE prefixed) and the lock must not cross a cache line boundary. </span>
<span id="tu_402" class="t s6_402">• </span><span id="tv_402" class="t s4_402">Software should not write to the elided lock inside a transactional HLE region with any instruction other than an </span>
<span id="tw_402" class="t s4_402">XRELEASE prefixed instruction, otherwise it may cause a transactional abort. In addition, recursive locks </span>
<span id="tx_402" class="t s4_402">(where a thread acquires the same lock multiple times without first releasing the lock) may also cause a trans- </span>
<span id="ty_402" class="t s4_402">actional abort. Note that software can observe the result of the elided lock acquire inside the critical section. </span>
<span id="tz_402" class="t s4_402">Such a read operation will return the value of the write to the lock. </span>
<span id="t10_402" class="t s4_402">The processor automatically detects violations to these guidelines, and safely transitions to a non-transactional </span>
<span id="t11_402" class="t s4_402">execution without elision. Since Intel TSX detects conflicts at the granularity of a cache line, writes to data collo- </span>
<span id="t12_402" class="t s4_402">cated on the same cache line as the elided lock may be detected as data conflicts by other logical processors eliding </span>
<span id="t13_402" class="t s4_402">the same lock. </span>
<span id="t14_402" class="t s5_402">16.3.4 </span><span id="t15_402" class="t s5_402">Transactional Nesting </span>
<span id="t16_402" class="t s4_402">Both HLE- and RTM-based transactional executions support nested transactional regions. However, a transactional </span>
<span id="t17_402" class="t s4_402">abort restores state to the operation that started transactional execution: either the outermost XACQUIRE prefixed </span>
<span id="t18_402" class="t s4_402">HLE eligible instruction or the outermost XBEGIN instruction. The processor treats all nested transactional regions </span>
<span id="t19_402" class="t s4_402">as one monolithic transactional region. </span>
<span id="t1a_402" class="t s3_402">16.3.4.1 </span><span id="t1b_402" class="t s3_402">HLE Nesting and Elision </span>
<span id="t1c_402" class="t s4_402">Programmers can nest HLE regions up to an implementation specific depth of MAX_HLE_NEST_COUNT. Each logical </span>
<span id="t1d_402" class="t s4_402">processor tracks the nesting count internally but this count is not available to software. An XACQUIRE prefixed HLE- </span>
<span id="t1e_402" class="t s4_402">eligible instruction increments the nesting count, and an XRELEASE prefixed HLE-eligible instruction decrements it. </span>
<span id="t1f_402" class="t s4_402">The logical processor enters transactional execution when the nesting count goes from zero to one. The logical </span>
<span id="t1g_402" class="t s4_402">processor attempts to commit only when the nesting count becomes zero. A transactional abort may occur if the </span>
<span id="t1h_402" class="t s4_402">nesting count exceeds MAX_HLE_NEST_COUNT. </span>
<span id="t1i_402" class="t s4_402">In addition to supporting nested HLE regions, the processor can also elide multiple nested locks. The processor </span>
<span id="t1j_402" class="t s4_402">tracks a lock for elision beginning with the XACQUIRE prefixed HLE eligible instruction for that lock and ending with </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
