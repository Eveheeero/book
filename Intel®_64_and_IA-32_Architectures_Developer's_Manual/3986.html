<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p3986" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_3986{left:69px;bottom:68px;letter-spacing:0.12px;}
#t2_3986{left:110px;bottom:68px;letter-spacing:0.1px;}
#t3_3986{left:69px;bottom:1141px;letter-spacing:-0.15px;word-spacing:0.01px;}
#t4_3986{left:69px;bottom:1088px;letter-spacing:-0.14px;word-spacing:-0.43px;}
#t5_3986{left:69px;bottom:1071px;letter-spacing:-0.14px;word-spacing:-0.42px;}
#t6_3986{left:69px;bottom:1045px;}
#t7_3986{left:95px;bottom:1048px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t8_3986{left:95px;bottom:1031px;letter-spacing:-0.15px;word-spacing:-0.41px;}
#t9_3986{left:69px;bottom:1005px;}
#ta_3986{left:95px;bottom:1008px;letter-spacing:-0.14px;word-spacing:-0.67px;}
#tb_3986{left:95px;bottom:991px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tc_3986{left:95px;bottom:975px;letter-spacing:-0.14px;word-spacing:-0.4px;}
#td_3986{left:69px;bottom:950px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#te_3986{left:69px;bottom:933px;letter-spacing:-0.14px;word-spacing:-0.42px;}
#tf_3986{left:69px;bottom:875px;letter-spacing:0.13px;}
#tg_3986{left:151px;bottom:875px;letter-spacing:0.15px;word-spacing:0.01px;}
#th_3986{left:69px;bottom:851px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#ti_3986{left:69px;bottom:834px;letter-spacing:-0.16px;word-spacing:-0.65px;}
#tj_3986{left:69px;bottom:817px;letter-spacing:-0.16px;word-spacing:-0.47px;}
#tk_3986{left:69px;bottom:800px;letter-spacing:-0.16px;word-spacing:-0.48px;}
#tl_3986{left:69px;bottom:776px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tm_3986{left:69px;bottom:717px;letter-spacing:0.13px;}
#tn_3986{left:151px;bottom:717px;letter-spacing:0.15px;}
#to_3986{left:69px;bottom:694px;letter-spacing:-0.17px;word-spacing:-0.96px;}
#tp_3986{left:462px;bottom:694px;letter-spacing:-0.14px;word-spacing:-1.03px;}
#tq_3986{left:69px;bottom:677px;letter-spacing:-0.15px;word-spacing:-0.41px;}
#tr_3986{left:69px;bottom:652px;letter-spacing:-0.15px;word-spacing:-0.43px;}
#ts_3986{left:69px;bottom:635px;letter-spacing:-0.18px;word-spacing:-0.45px;}
#tt_3986{left:69px;bottom:619px;letter-spacing:-0.15px;word-spacing:-1.2px;}
#tu_3986{left:69px;bottom:602px;letter-spacing:-0.18px;word-spacing:-0.44px;}
#tv_3986{left:69px;bottom:585px;letter-spacing:-0.17px;word-spacing:-0.44px;}
#tw_3986{left:69px;bottom:561px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#tx_3986{left:69px;bottom:544px;letter-spacing:-0.13px;word-spacing:-1.04px;}
#ty_3986{left:235px;bottom:544px;letter-spacing:-0.14px;word-spacing:-1.05px;}
#tz_3986{left:69px;bottom:527px;letter-spacing:-0.16px;word-spacing:-0.46px;}
#t10_3986{left:69px;bottom:503px;letter-spacing:-0.16px;word-spacing:-0.46px;}
#t11_3986{left:69px;bottom:486px;letter-spacing:-0.2px;}
#t12_3986{left:95px;bottom:486px;letter-spacing:-0.13px;word-spacing:-1.31px;}
#t13_3986{left:69px;bottom:469px;letter-spacing:-0.14px;word-spacing:-0.42px;}
#t14_3986{left:69px;bottom:419px;letter-spacing:-0.09px;}
#t15_3986{left:154px;bottom:419px;letter-spacing:-0.1px;word-spacing:0.01px;}
#t16_3986{left:69px;bottom:395px;letter-spacing:-0.14px;word-spacing:-0.44px;}
#t17_3986{left:69px;bottom:378px;letter-spacing:-0.16px;word-spacing:-1.13px;}
#t18_3986{left:69px;bottom:361px;letter-spacing:-0.17px;word-spacing:-0.44px;}
#t19_3986{left:69px;bottom:337px;letter-spacing:-0.16px;word-spacing:-0.6px;}
#t1a_3986{left:69px;bottom:320px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t1b_3986{left:69px;bottom:303px;letter-spacing:-0.15px;word-spacing:-0.44px;}
#t1c_3986{left:69px;bottom:279px;letter-spacing:-0.14px;word-spacing:-1px;}
#t1d_3986{left:69px;bottom:262px;letter-spacing:-0.13px;word-spacing:-0.48px;}
#t1e_3986{left:69px;bottom:245px;letter-spacing:-0.13px;word-spacing:-0.47px;}
#t1f_3986{left:69px;bottom:221px;letter-spacing:-0.15px;word-spacing:-0.44px;}
#t1g_3986{left:69px;bottom:204px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#t1h_3986{left:69px;bottom:187px;letter-spacing:-0.15px;word-spacing:-0.41px;}

.s1_3986{font-size:12px;font-family:NeoSansIntel_6wv3;color:#000;}
.s2_3986{font-size:14px;font-family:NeoSansIntel_6wv3;color:#0860A8;}
.s3_3986{font-size:14px;font-family:Verdana_b5t;color:#000;}
.s4_3986{font-size:21px;font-family:TimesNewRoman_b5y;color:#000;}
.s5_3986{font-size:18px;font-family:NeoSansIntelMedium_6wv2;color:#0860A8;}
.s6_3986{font-size:17px;font-family:NeoSansIntelMedium_6wv2;color:#0860A8;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts3986" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_6wv2;
	src: url("fonts/NeoSansIntelMedium_6wv2.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_6wv3;
	src: url("fonts/NeoSansIntel_6wv3.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_b5y;
	src: url("fonts/TimesNewRoman_b5y.woff") format("woff");
}

@font-face {
	font-family: Verdana_b5t;
	src: url("fonts/Verdana_b5t.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg3986Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg3986" style="-webkit-user-select: none;"><object width="935" height="1210" data="3986/3986.svg" type="image/svg+xml" id="pdf3986" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_3986" class="t s1_3986">26-16 </span><span id="t2_3986" class="t s1_3986">Vol. 3C </span>
<span id="t3_3986" class="t s2_3986">VMX NON-ROOT OPERATION </span>
<span id="t4_3986" class="t s3_3986">An MTF VM exit occurs on the instruction boundary on which it is pending unless a higher priority event takes </span>
<span id="t5_3986" class="t s3_3986">precedence or the MTF VM exit is blocked due to the activity state: </span>
<span id="t6_3986" class="t s4_3986">• </span><span id="t7_3986" class="t s3_3986">System-management interrupts (SMIs), INIT signals, and higher priority events take priority over MTF </span>
<span id="t8_3986" class="t s3_3986">VM exits. MTF VM exits take priority over debug-trap exceptions and lower priority events. </span>
<span id="t9_3986" class="t s4_3986">• </span><span id="ta_3986" class="t s3_3986">No MTF VM exit occurs if the processor is in either the shutdown activity state or wait-for-SIPI activity state. If </span>
<span id="tb_3986" class="t s3_3986">a non-maskable interrupt subsequently takes the logical processor out of the shutdown activity state without </span>
<span id="tc_3986" class="t s3_3986">causing a VM exit, an MTF VM exit is pending after delivery of that interrupt. </span>
<span id="td_3986" class="t s3_3986">Special treatment may apply to Intel SGX instructions or if the logical processor is in enclave mode. See Section </span>
<span id="te_3986" class="t s3_3986">40.2 for details. </span>
<span id="tf_3986" class="t s5_3986">26.5.3 </span><span id="tg_3986" class="t s5_3986">Translation of Guest-Physical Addresses Using EPT </span>
<span id="th_3986" class="t s3_3986">The extended page-table mechanism (EPT) is a feature that can be used to support the virtualization of physical </span>
<span id="ti_3986" class="t s3_3986">memory. When EPT is in use, certain physical addresses are treated as guest-physical addresses and are not used </span>
<span id="tj_3986" class="t s3_3986">to access memory directly. Instead, guest-physical addresses are translated by traversing a set of EPT paging </span>
<span id="tk_3986" class="t s3_3986">structures to produce physical addresses that are used to access memory. </span>
<span id="tl_3986" class="t s3_3986">Details of the EPT mechanism are given in Section 29.3. </span>
<span id="tm_3986" class="t s5_3986">26.5.4 </span><span id="tn_3986" class="t s5_3986">Translation of Guest-Physical Addresses Used by Intel Processor Trace </span>
<span id="to_3986" class="t s3_3986">As described in Chapter 33, Intel® Processor Trace (Intel </span><span id="tp_3986" class="t s3_3986">PT) captures information about software execution using </span>
<span id="tq_3986" class="t s3_3986">dedicated hardware facilities. </span>
<span id="tr_3986" class="t s3_3986">Intel PT can be configured so that the trace output is written to memory using physical addresses. For example, </span>
<span id="ts_3986" class="t s3_3986">when the ToPA (table of physical addresses) output mechanism is used, the IA32_RTIT_OUTPUT_BASE MSR </span>
<span id="tt_3986" class="t s3_3986">contains the physical address of the base of the current ToPA. Each entry in that table contains the physical address </span>
<span id="tu_3986" class="t s3_3986">of an output region in memory. When an output region becomes full, the ToPA output mechanism directs subse- </span>
<span id="tv_3986" class="t s3_3986">quent trace output to the next output region as indicated in the ToPA. </span>
<span id="tw_3986" class="t s3_3986">When the “Intel PT uses guest physical addresses” VM-execution control is 1, the logical processor treats the </span>
<span id="tx_3986" class="t s3_3986">addresses used by Intel </span><span id="ty_3986" class="t s3_3986">PT (the output addresses as well as those used to discover the output addresses) as guest- </span>
<span id="tz_3986" class="t s3_3986">physical addresses, translating to physical addresses using EPT before trace output is written to memory. </span>
<span id="t10_3986" class="t s3_3986">Translating these addresses through EPT implies that the trace-output mechanism may cause EPT violations and </span>
<span id="t11_3986" class="t s3_3986">VM </span><span id="t12_3986" class="t s3_3986">exits; details are provided in Section 26.5.4.1. Section 26.5.4.2 describes a mechanism that ensures that these </span>
<span id="t13_3986" class="t s3_3986">VM exits do not cause loss of trace data. </span>
<span id="t14_3986" class="t s6_3986">26.5.4.1 </span><span id="t15_3986" class="t s6_3986">Guest-Physical Address Translation for Intel PT: Details </span>
<span id="t16_3986" class="t s3_3986">When the “Intel PT uses guest physical addresses” VM-execution control is 1, the addresses used by Intel PT are </span>
<span id="t17_3986" class="t s3_3986">treated as guest-physical addresses and translated using EPT. These addresses include the addresses of the output </span>
<span id="t18_3986" class="t s3_3986">regions as well as the addresses of the ToPA entries that contain the output-region addresses. </span>
<span id="t19_3986" class="t s3_3986">Translation of accesses by the trace-output process may result in EPT violations or EPT misconfigurations (Section </span>
<span id="t1a_3986" class="t s3_3986">29.3.3), resulting in VM exits. EPT violations resulting for the trace-output process always cause VM exits and are </span>
<span id="t1b_3986" class="t s3_3986">never converted to virtualization exceptions (Section 26.5.7.1). </span>
<span id="t1c_3986" class="t s3_3986">If no EPT violation or EPT misconfiguration occurs and if page-modification logging (Section 29.3.6) is enabled, the </span>
<span id="t1d_3986" class="t s3_3986">address of an output region may be added to the page-modification log. If the log is full, a page-modification log- </span>
<span id="t1e_3986" class="t s3_3986">full event occurs, resulting in a VM exit. </span>
<span id="t1f_3986" class="t s3_3986">If the “virtualize APIC accesses” VM-execution control is 1, a guest-physical address used by the trace-output </span>
<span id="t1g_3986" class="t s3_3986">process may be translated to an address on the APIC-access page. In this case, the access by the trace-output </span>
<span id="t1h_3986" class="t s3_3986">process causes an APIC-access VM exit as discussed in Section 30.4.6.1. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
