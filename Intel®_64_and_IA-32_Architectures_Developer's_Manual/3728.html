<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p3728" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_3728{left:69px;bottom:68px;letter-spacing:0.12px;}
#t2_3728{left:110px;bottom:68px;letter-spacing:0.1px;}
#t3_3728{left:69px;bottom:1141px;letter-spacing:-0.15px;word-spacing:0.01px;}
#t4_3728{left:69px;bottom:1088px;letter-spacing:-0.15px;word-spacing:-0.41px;}
#t5_3728{left:69px;bottom:1071px;letter-spacing:-0.13px;word-spacing:-1.03px;}
#t6_3728{left:69px;bottom:1054px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t7_3728{left:69px;bottom:1037px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t8_3728{left:69px;bottom:1013px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t9_3728{left:69px;bottom:988px;letter-spacing:-0.15px;}
#ta_3728{left:69px;bottom:964px;letter-spacing:-0.14px;word-spacing:-1px;}
#tb_3728{left:69px;bottom:947px;letter-spacing:-0.17px;word-spacing:-0.44px;}
#tc_3728{left:69px;bottom:923px;letter-spacing:-0.15px;word-spacing:-0.55px;}
#td_3728{left:69px;bottom:906px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#te_3728{left:69px;bottom:889px;letter-spacing:-0.15px;word-spacing:-0.47px;}
#tf_3728{left:69px;bottom:872px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#tg_3728{left:69px;bottom:498px;letter-spacing:-0.16px;word-spacing:-0.93px;}
#th_3728{left:69px;bottom:481px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#ti_3728{left:69px;bottom:464px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#tj_3728{left:69px;bottom:440px;letter-spacing:-0.14px;word-spacing:-0.82px;}
#tk_3728{left:69px;bottom:423px;letter-spacing:-0.16px;word-spacing:-0.51px;}
#tl_3728{left:69px;bottom:399px;letter-spacing:-0.16px;word-spacing:-1.22px;}
#tm_3728{left:69px;bottom:382px;letter-spacing:-0.15px;word-spacing:-0.44px;}
#tn_3728{left:69px;bottom:365px;letter-spacing:-0.13px;word-spacing:-0.47px;}
#to_3728{left:69px;bottom:348px;letter-spacing:-0.15px;word-spacing:-0.51px;}
#tp_3728{left:69px;bottom:324px;letter-spacing:-0.16px;word-spacing:-0.47px;}
#tq_3728{left:69px;bottom:299px;letter-spacing:-0.14px;word-spacing:-1.19px;}
#tr_3728{left:69px;bottom:283px;letter-spacing:-0.16px;word-spacing:-0.43px;}
#ts_3728{left:69px;bottom:266px;letter-spacing:-0.16px;word-spacing:-1.19px;}
#tt_3728{left:69px;bottom:249px;letter-spacing:-0.15px;word-spacing:-0.77px;}
#tu_3728{left:69px;bottom:224px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tv_3728{left:69px;bottom:208px;letter-spacing:-0.13px;word-spacing:-0.98px;}
#tw_3728{left:69px;bottom:191px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tx_3728{left:69px;bottom:174px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#ty_3728{left:69px;bottom:157px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tz_3728{left:69px;bottom:140px;letter-spacing:-0.14px;word-spacing:-0.81px;}
#t10_3728{left:69px;bottom:124px;letter-spacing:-0.15px;word-spacing:-0.47px;}
#t11_3728{left:231px;bottom:828px;letter-spacing:0.12px;word-spacing:0.02px;}
#t12_3728{left:317px;bottom:828px;letter-spacing:0.12px;}
#t13_3728{left:78px;bottom:805px;letter-spacing:-0.14px;word-spacing:0.07px;}
#t14_3728{left:204px;bottom:805px;letter-spacing:-0.11px;}
#t15_3728{left:465px;bottom:805px;letter-spacing:-0.12px;word-spacing:-0.04px;}
#t16_3728{left:591px;bottom:805px;letter-spacing:-0.11px;}
#t17_3728{left:78px;bottom:781px;letter-spacing:-0.19px;}
#t18_3728{left:204px;bottom:781px;letter-spacing:-0.14px;}
#t19_3728{left:465px;bottom:781px;letter-spacing:-0.15px;}
#t1a_3728{left:591px;bottom:781px;letter-spacing:-0.15px;}
#t1b_3728{left:78px;bottom:756px;letter-spacing:-0.18px;}
#t1c_3728{left:204px;bottom:756px;letter-spacing:-0.12px;}
#t1d_3728{left:465px;bottom:756px;letter-spacing:-0.14px;}
#t1e_3728{left:591px;bottom:756px;letter-spacing:-0.14px;}
#t1f_3728{left:78px;bottom:732px;letter-spacing:-0.18px;}
#t1g_3728{left:204px;bottom:732px;letter-spacing:-0.15px;}
#t1h_3728{left:465px;bottom:732px;letter-spacing:-0.15px;}
#t1i_3728{left:591px;bottom:732px;letter-spacing:-0.15px;}
#t1j_3728{left:78px;bottom:707px;letter-spacing:-0.18px;}
#t1k_3728{left:204px;bottom:707px;letter-spacing:-0.15px;}
#t1l_3728{left:465px;bottom:707px;letter-spacing:-0.14px;}
#t1m_3728{left:591px;bottom:707px;letter-spacing:-0.14px;}
#t1n_3728{left:78px;bottom:683px;letter-spacing:-0.18px;}
#t1o_3728{left:204px;bottom:683px;letter-spacing:-0.15px;}
#t1p_3728{left:465px;bottom:683px;letter-spacing:-0.14px;}
#t1q_3728{left:591px;bottom:683px;letter-spacing:-0.14px;}
#t1r_3728{left:78px;bottom:658px;letter-spacing:-0.18px;}
#t1s_3728{left:204px;bottom:658px;letter-spacing:-0.14px;}
#t1t_3728{left:465px;bottom:658px;letter-spacing:-0.15px;}
#t1u_3728{left:591px;bottom:658px;letter-spacing:-0.14px;}
#t1v_3728{left:78px;bottom:634px;letter-spacing:-0.18px;}
#t1w_3728{left:204px;bottom:634px;letter-spacing:-0.13px;}
#t1x_3728{left:465px;bottom:634px;letter-spacing:-0.14px;}
#t1y_3728{left:591px;bottom:634px;letter-spacing:-0.14px;}
#t1z_3728{left:78px;bottom:609px;letter-spacing:-0.19px;}
#t20_3728{left:204px;bottom:609px;letter-spacing:-0.13px;}
#t21_3728{left:465px;bottom:609px;letter-spacing:-0.13px;}
#t22_3728{left:591px;bottom:609px;letter-spacing:-0.15px;}
#t23_3728{left:78px;bottom:585px;letter-spacing:-0.18px;}
#t24_3728{left:204px;bottom:585px;letter-spacing:-0.15px;}
#t25_3728{left:465px;bottom:585px;letter-spacing:-0.13px;}
#t26_3728{left:591px;bottom:585px;letter-spacing:-0.12px;}
#t27_3728{left:78px;bottom:561px;letter-spacing:-0.18px;}
#t28_3728{left:204px;bottom:561px;letter-spacing:-0.15px;}
#t29_3728{left:465px;bottom:561px;letter-spacing:-0.16px;}
#t2a_3728{left:591px;bottom:561px;letter-spacing:-0.12px;}
#t2b_3728{left:78px;bottom:536px;letter-spacing:-0.17px;}
#t2c_3728{left:204px;bottom:536px;letter-spacing:-0.19px;}
#t2d_3728{left:465px;bottom:536px;letter-spacing:-0.16px;}
#t2e_3728{left:591px;bottom:536px;letter-spacing:-0.12px;word-spacing:0.01px;}

.s1_3728{font-size:12px;font-family:NeoSansIntel_6wv3;color:#000;}
.s2_3728{font-size:14px;font-family:NeoSansIntel_6wv3;color:#0860A8;}
.s3_3728{font-size:14px;font-family:Verdana_b5t;color:#000;}
.s4_3728{font-size:14px;font-family:Verdana-Bold_b5u;color:#000;}
.s5_3728{font-size:15px;font-family:NeoSansIntelMedium_6wv2;color:#0860A8;}
.s6_3728{font-size:14px;font-family:NeoSansIntelMedium_6wv2;color:#000;}
.s7_3728{font-size:14px;font-family:NeoSansIntel_6wv3;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts3728" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_6wv2;
	src: url("fonts/NeoSansIntelMedium_6wv2.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_6wv3;
	src: url("fonts/NeoSansIntel_6wv3.woff") format("woff");
}

@font-face {
	font-family: Verdana-Bold_b5u;
	src: url("fonts/Verdana-Bold_b5u.woff") format("woff");
}

@font-face {
	font-family: Verdana_b5t;
	src: url("fonts/Verdana_b5t.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg3728Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg3728" style="-webkit-user-select: none;"><object width="935" height="1210" data="3728/3728.svg" type="image/svg+xml" id="pdf3728" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_3728" class="t s1_3728">20-20 </span><span id="t2_3728" class="t s1_3728">Vol. 3B </span>
<span id="t3_3728" class="t s2_3728">PERFORMANCE MONITORING </span>
<span id="t4_3728" class="t s3_3728">The behavior of PEBS assists is reported by IA32_PERF_CAPABILITIES[6] (see Figure 20-65). The return instruc- </span>
<span id="t5_3728" class="t s3_3728">tion pointer (RIP) reported in the PEBS record will point to the instruction after (+1) the instruction that causes the </span>
<span id="t6_3728" class="t s3_3728">PEBS assist. The machine state reported in the PEBS record is the machine state after the instruction that causes </span>
<span id="t7_3728" class="t s3_3728">the PEBS assist is retired. For instance, if the instructions: </span>
<span id="t8_3728" class="t s3_3728">mov eax, [eax] ; causes PEBS assist </span>
<span id="t9_3728" class="t s3_3728">nop </span>
<span id="ta_3728" class="t s3_3728">are executed, the PEBS record will report the address of the nop, and the value of EAX in the PEBS record will show </span>
<span id="tb_3728" class="t s3_3728">the value read from memory, not the target address of the read operation. </span>
<span id="tc_3728" class="t s3_3728">The PEBS record format is shown in Table 20-3, and each field in the PEBS record is 64 bits long. The PEBS record </span>
<span id="td_3728" class="t s3_3728">format, along with debug/store area storage format, does not change regardless of IA-32e mode is active or not. </span>
<span id="te_3728" class="t s3_3728">CPUID.01H:ECX.DTES64[bit 2] reports whether the processor's DS storage format support is mode-independent. </span>
<span id="tf_3728" class="t s3_3728">When set, it uses 64-bit DS storage format. </span>
<span id="tg_3728" class="t s3_3728">In IA-32e mode, the full 64-bit value is written to the register. If the processor is not operating in IA-32e mode, 32- </span>
<span id="th_3728" class="t s3_3728">bit value is written to registers with bits 63:32 zeroed. Registers not defined when the processor is not in IA-32e </span>
<span id="ti_3728" class="t s3_3728">mode are written to zero. </span>
<span id="tj_3728" class="t s3_3728">Bytes AFH:90H are enhancement to the PEBS record format. Support for this enhanced PEBS record format is indi- </span>
<span id="tk_3728" class="t s3_3728">cated by IA32_PERF_CAPABILITIES[11:8] encoding of 0001B. </span>
<span id="tl_3728" class="t s3_3728">The value written to bytes 97H:90H is the state of the IA32_PERF_GLOBAL_STATUS register before the PEBS assist </span>
<span id="tm_3728" class="t s3_3728">occurred. This value is written so software can determine which counters overflowed when this PEBS record was </span>
<span id="tn_3728" class="t s3_3728">written. Note that this field indicates the overflow status for all counters, regardless of whether they were </span>
<span id="to_3728" class="t s3_3728">programmed for PEBS or not. </span>
<span id="tp_3728" class="t s4_3728">Programming PEBS Facility </span>
<span id="tq_3728" class="t s3_3728">Only a subset of non-architectural performance events in the processor support PEBS. The subset of precise events </span>
<span id="tr_3728" class="t s3_3728">are listed in Table 20-84. In addition to using IA32_PERFEVTSELx to specify event unit/mask settings and setting </span>
<span id="ts_3728" class="t s3_3728">the EN_PMCx bit in the IA32_PEBS_ENABLE register for the respective counter, the software must also initialize the </span>
<span id="tt_3728" class="t s3_3728">DS_BUFFER_MANAGEMENT_AREA data structure in memory to support capturing PEBS records for precise events. </span>
<span id="tu_3728" class="t s3_3728">The recording of PEBS records may not operate properly if accesses to the linear addresses in the DS buffer </span>
<span id="tv_3728" class="t s3_3728">management area or in the PEBS buffer (see below) cause page faults, VM exits, or the setting of accessed or dirty </span>
<span id="tw_3728" class="t s3_3728">flags in the paging structures (ordinary or EPT). For that reason, system software should establish paging struc- </span>
<span id="tx_3728" class="t s3_3728">tures (both ordinary and EPT) to prevent such occurrences. Implications of this may be that an operating system </span>
<span id="ty_3728" class="t s3_3728">should allocate this memory from a non-paged pool and that system software cannot do “lazy” page-table entry </span>
<span id="tz_3728" class="t s3_3728">propagation for these pages. A virtual-machine monitor may choose to allow use of PEBS by guest software only if </span>
<span id="t10_3728" class="t s3_3728">EPT maps all guest-physical memory as present and read/write. </span>
<span id="t11_3728" class="t s5_3728">Table 20-3. </span><span id="t12_3728" class="t s5_3728">PEBS Record Format for Intel Core i7 Processor Family </span>
<span id="t13_3728" class="t s6_3728">Byte Offset </span><span id="t14_3728" class="t s6_3728">Field </span><span id="t15_3728" class="t s6_3728">Byte Offset </span><span id="t16_3728" class="t s6_3728">Field </span>
<span id="t17_3728" class="t s7_3728">00H </span><span id="t18_3728" class="t s7_3728">R/EFLAGS </span><span id="t19_3728" class="t s7_3728">58H </span><span id="t1a_3728" class="t s7_3728">R9 </span>
<span id="t1b_3728" class="t s7_3728">08H </span><span id="t1c_3728" class="t s7_3728">R/EIP </span><span id="t1d_3728" class="t s7_3728">60H </span><span id="t1e_3728" class="t s7_3728">R10 </span>
<span id="t1f_3728" class="t s7_3728">10H </span><span id="t1g_3728" class="t s7_3728">R/EAX </span><span id="t1h_3728" class="t s7_3728">68H </span><span id="t1i_3728" class="t s7_3728">R11 </span>
<span id="t1j_3728" class="t s7_3728">18H </span><span id="t1k_3728" class="t s7_3728">R/EBX </span><span id="t1l_3728" class="t s7_3728">70H </span><span id="t1m_3728" class="t s7_3728">R12 </span>
<span id="t1n_3728" class="t s7_3728">20H </span><span id="t1o_3728" class="t s7_3728">R/ECX </span><span id="t1p_3728" class="t s7_3728">78H </span><span id="t1q_3728" class="t s7_3728">R13 </span>
<span id="t1r_3728" class="t s7_3728">28H </span><span id="t1s_3728" class="t s7_3728">R/EDX </span><span id="t1t_3728" class="t s7_3728">80H </span><span id="t1u_3728" class="t s7_3728">R14 </span>
<span id="t1v_3728" class="t s7_3728">30H </span><span id="t1w_3728" class="t s7_3728">R/ESI </span><span id="t1x_3728" class="t s7_3728">88H </span><span id="t1y_3728" class="t s7_3728">R15 </span>
<span id="t1z_3728" class="t s7_3728">38H </span><span id="t20_3728" class="t s7_3728">R/EDI </span><span id="t21_3728" class="t s7_3728">90H </span><span id="t22_3728" class="t s7_3728">IA32_PERF_GLOBAL_STATUS </span>
<span id="t23_3728" class="t s7_3728">40H </span><span id="t24_3728" class="t s7_3728">R/EBP </span><span id="t25_3728" class="t s7_3728">98H </span><span id="t26_3728" class="t s7_3728">Data Linear Address </span>
<span id="t27_3728" class="t s7_3728">48H </span><span id="t28_3728" class="t s7_3728">R/ESP </span><span id="t29_3728" class="t s7_3728">A0H </span><span id="t2a_3728" class="t s7_3728">Data Source Encoding </span>
<span id="t2b_3728" class="t s7_3728">50H </span><span id="t2c_3728" class="t s7_3728">R8 </span><span id="t2d_3728" class="t s7_3728">A8H </span><span id="t2e_3728" class="t s7_3728">Latency value (core cycles) </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
