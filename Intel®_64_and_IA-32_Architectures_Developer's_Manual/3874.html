<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p3874" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_3874{left:69px;bottom:68px;letter-spacing:0.12px;}
#t2_3874{left:110px;bottom:68px;letter-spacing:0.1px;}
#t3_3874{left:69px;bottom:1141px;letter-spacing:-0.15px;word-spacing:0.01px;}
#t4_3874{left:95px;bottom:1088px;letter-spacing:-0.15px;word-spacing:-0.55px;}
#t5_3874{left:95px;bottom:1071px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t6_3874{left:95px;bottom:1054px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t7_3874{left:95px;bottom:1037px;letter-spacing:-0.14px;word-spacing:-0.49px;}
#t8_3874{left:95px;bottom:1020px;letter-spacing:-0.13px;word-spacing:-0.46px;}
#t9_3874{left:69px;bottom:994px;}
#ta_3874{left:95px;bottom:998px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tb_3874{left:95px;bottom:981px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tc_3874{left:95px;bottom:964px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#td_3874{left:95px;bottom:947px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#te_3874{left:95px;bottom:930px;letter-spacing:-0.14px;word-spacing:-0.89px;}
#tf_3874{left:95px;bottom:914px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tg_3874{left:95px;bottom:897px;letter-spacing:-0.14px;word-spacing:-0.44px;}
#th_3874{left:95px;bottom:874px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#ti_3874{left:95px;bottom:857px;letter-spacing:-0.14px;word-spacing:-1.24px;}
#tj_3874{left:95px;bottom:840px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tk_3874{left:95px;bottom:823px;letter-spacing:-0.14px;word-spacing:-0.52px;}
#tl_3874{left:69px;bottom:797px;}
#tm_3874{left:95px;bottom:800px;letter-spacing:-0.13px;word-spacing:-0.49px;}
#tn_3874{left:95px;bottom:784px;letter-spacing:-0.14px;word-spacing:-1.4px;}
#to_3874{left:95px;bottom:767px;letter-spacing:-0.15px;word-spacing:-0.51px;}
#tp_3874{left:69px;bottom:740px;}
#tq_3874{left:95px;bottom:744px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#tr_3874{left:95px;bottom:727px;letter-spacing:-0.17px;word-spacing:-0.45px;}
#ts_3874{left:95px;bottom:710px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#tt_3874{left:69px;bottom:686px;letter-spacing:-0.14px;word-spacing:-1.3px;}
#tu_3874{left:69px;bottom:669px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#tv_3874{left:69px;bottom:611px;letter-spacing:0.13px;}
#tw_3874{left:151px;bottom:611px;letter-spacing:0.14px;word-spacing:0.01px;}
#tx_3874{left:69px;bottom:587px;letter-spacing:-0.2px;word-spacing:-0.86px;}
#ty_3874{left:685px;bottom:587px;}
#tz_3874{left:694px;bottom:587px;letter-spacing:-0.13px;word-spacing:-0.94px;}
#t10_3874{left:69px;bottom:570px;letter-spacing:-0.16px;word-spacing:-0.84px;}
#t11_3874{left:69px;bottom:553px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t12_3874{left:69px;bottom:529px;letter-spacing:-0.15px;word-spacing:-1.19px;}
#t13_3874{left:69px;bottom:512px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t14_3874{left:69px;bottom:495px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t15_3874{left:69px;bottom:436px;letter-spacing:0.13px;}
#t16_3874{left:151px;bottom:436px;letter-spacing:0.15px;word-spacing:0.01px;}
#t17_3874{left:69px;bottom:412px;letter-spacing:-0.15px;word-spacing:-0.98px;}
#t18_3874{left:69px;bottom:396px;letter-spacing:-0.15px;word-spacing:-0.47px;}
#t19_3874{left:69px;bottom:379px;letter-spacing:-0.16px;word-spacing:-0.46px;}
#t1a_3874{left:69px;bottom:362px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t1b_3874{left:69px;bottom:338px;letter-spacing:-0.14px;word-spacing:-0.64px;}
#t1c_3874{left:69px;bottom:321px;letter-spacing:-0.15px;word-spacing:-0.48px;}
#t1d_3874{left:69px;bottom:294px;}
#t1e_3874{left:95px;bottom:298px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t1f_3874{left:69px;bottom:271px;}
#t1g_3874{left:95px;bottom:275px;letter-spacing:-0.18px;word-spacing:-0.42px;}
#t1h_3874{left:69px;bottom:249px;}
#t1i_3874{left:95px;bottom:252px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t1j_3874{left:69px;bottom:226px;}
#t1k_3874{left:95px;bottom:229px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t1l_3874{left:69px;bottom:205px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t1m_3874{left:69px;bottom:188px;letter-spacing:-0.17px;}

.s1_3874{font-size:12px;font-family:NeoSansIntel_6wv3;color:#000;}
.s2_3874{font-size:14px;font-family:NeoSansIntel_6wv3;color:#0860A8;}
.s3_3874{font-size:14px;font-family:Verdana_b5t;color:#000;}
.s4_3874{font-size:21px;font-family:TimesNewRoman_b5y;color:#000;}
.s5_3874{font-size:18px;font-family:NeoSansIntelMedium_6wv2;color:#0860A8;}
.s6_3874{font-size:14px;font-family:Verdana-Italic_b5x;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts3874" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_6wv2;
	src: url("fonts/NeoSansIntelMedium_6wv2.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_6wv3;
	src: url("fonts/NeoSansIntel_6wv3.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_b5y;
	src: url("fonts/TimesNewRoman_b5y.woff") format("woff");
}

@font-face {
	font-family: Verdana-Italic_b5x;
	src: url("fonts/Verdana-Italic_b5x.woff") format("woff");
}

@font-face {
	font-family: Verdana_b5t;
	src: url("fonts/Verdana_b5t.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg3874Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg3874" style="-webkit-user-select: none;"><object width="935" height="1210" data="3874/3874.svg" type="image/svg+xml" id="pdf3874" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_3874" class="t s1_3874">21-10 </span><span id="t2_3874" class="t s1_3874">Vol. 3B </span>
<span id="t3_3874" class="t s2_3874">8086 EMULATION </span>
<span id="t4_3874" class="t s3_3874">exception or hardware interrupt through the protected-mode IDT (normally through an interrupt or trap gate) </span>
<span id="t5_3874" class="t s3_3874">and the protected-mode exception- and interrupt-handlers. The processor may handle the exception or </span>
<span id="t6_3874" class="t s3_3874">interrupt within the context of the virtual 8086 task and return to virtual-8086 mode on a return from the </span>
<span id="t7_3874" class="t s3_3874">handler procedure. The processor may also execute a task switch and handle the exception or interrupt in the </span>
<span id="t8_3874" class="t s3_3874">context of another task. </span>
<span id="t9_3874" class="t s4_3874">• </span><span id="ta_3874" class="t s3_3874">The processor services a software interrupt generated by code executing in the virtual-8086 task (such as a </span>
<span id="tb_3874" class="t s3_3874">software interrupt to call a MS-DOS* operating system routine). The processor provides several methods of </span>
<span id="tc_3874" class="t s3_3874">handling these software interrupts, which are discussed in detail in Section 21.3.3, “Class 3—Software </span>
<span id="td_3874" class="t s3_3874">Interrupt Handling in Virtual-8086 Mode.” Most of them involve the processor entering protected mode, often </span>
<span id="te_3874" class="t s3_3874">by means of a general-protection (#GP) exception. In protected mode, the processor can send the interrupt to </span>
<span id="tf_3874" class="t s3_3874">the virtual-8086 monitor for handling and/or redirect the interrupt back to the application program running in </span>
<span id="tg_3874" class="t s3_3874">virtual-8086 mode task for handling. </span>
<span id="th_3874" class="t s3_3874">IA-32 processors that incorporate the virtual mode extension (enabled with the VME flag in control register </span>
<span id="ti_3874" class="t s3_3874">CR4) are capable of redirecting software-generated interrupts back to the program’s interrupt handlers without </span>
<span id="tj_3874" class="t s3_3874">leaving virtual-8086 mode. See Section 21.3.3.4, “Method 5: Software Interrupt Handling,” for more </span>
<span id="tk_3874" class="t s3_3874">information on this mechanism. </span>
<span id="tl_3874" class="t s4_3874">• </span><span id="tm_3874" class="t s3_3874">A hardware reset initiated by asserting the RESET or INIT pin is a special kind of interrupt. When a RESET or </span>
<span id="tn_3874" class="t s3_3874">INIT is signaled while the processor is in virtual-8086 mode, the processor leaves virtual-8086 mode and enters </span>
<span id="to_3874" class="t s3_3874">real-address mode. </span>
<span id="tp_3874" class="t s4_3874">• </span><span id="tq_3874" class="t s3_3874">Execution of the HLT instruction in virtual-8086 mode will cause a general-protection (GP#) fault, which the </span>
<span id="tr_3874" class="t s3_3874">protected-mode handler generally sends to the virtual-8086 monitor. The virtual-8086 monitor then </span>
<span id="ts_3874" class="t s3_3874">determines the correct execution sequence after verifying that it was entered as a result of a HLT execution. </span>
<span id="tt_3874" class="t s3_3874">See Section 21.3, “Interrupt and Exception Handling in Virtual-8086 Mode,” for information on leaving virtual-8086 </span>
<span id="tu_3874" class="t s3_3874">mode to handle an interrupt or exception generated in virtual-8086 mode. </span>
<span id="tv_3874" class="t s5_3874">21.2.7 </span><span id="tw_3874" class="t s5_3874">Sensitive Instructions </span>
<span id="tx_3874" class="t s3_3874">When an IA-32 processor is running in virtual-8086 mode, the CLI, STI, PUSHF, POPF, INT </span><span id="ty_3874" class="t s6_3874">n</span><span id="tz_3874" class="t s3_3874">, and IRET instructions </span>
<span id="t10_3874" class="t s3_3874">are sensitive to IOPL. The IN, INS, OUT, and OUTS instructions, which are sensitive to IOPL in protected mode, are </span>
<span id="t11_3874" class="t s3_3874">not sensitive in virtual-8086 mode. </span>
<span id="t12_3874" class="t s3_3874">The CPL is always 3 while running in virtual-8086 mode; if the IOPL is less than 3, an attempt to use the IOPL-sensi- </span>
<span id="t13_3874" class="t s3_3874">tive instructions listed above triggers a general-protection exception (#GP). These instructions are sensitive to </span>
<span id="t14_3874" class="t s3_3874">IOPL to give the virtual-8086 monitor a chance to emulate the facilities they affect. </span>
<span id="t15_3874" class="t s5_3874">21.2.8 </span><span id="t16_3874" class="t s5_3874">Virtual-8086 Mode I/O </span>
<span id="t17_3874" class="t s3_3874">Many 8086 programs written for non-multitasking systems directly access I/O ports. This practice may cause prob- </span>
<span id="t18_3874" class="t s3_3874">lems in a multitasking environment. If more than one program accesses the same port, they may interfere with </span>
<span id="t19_3874" class="t s3_3874">each other. Most multitasking systems require application programs to access I/O ports through the operating </span>
<span id="t1a_3874" class="t s3_3874">system. This results in simplified, centralized control. </span>
<span id="t1b_3874" class="t s3_3874">The processor provides I/O protection for creating I/O that is compatible with the environment and transparent to </span>
<span id="t1c_3874" class="t s3_3874">8086 programs. Designers may take any of several possible approaches to protecting I/O ports: </span>
<span id="t1d_3874" class="t s4_3874">• </span><span id="t1e_3874" class="t s3_3874">Protect the I/O address space and generate exceptions for all attempts to perform I/O directly. </span>
<span id="t1f_3874" class="t s4_3874">• </span><span id="t1g_3874" class="t s3_3874">Let the 8086 program perform I/O directly. </span>
<span id="t1h_3874" class="t s4_3874">• </span><span id="t1i_3874" class="t s3_3874">Generate exceptions on attempts to access specific I/O ports. </span>
<span id="t1j_3874" class="t s4_3874">• </span><span id="t1k_3874" class="t s3_3874">Generate exceptions on attempts to access specific memory-mapped I/O ports. </span>
<span id="t1l_3874" class="t s3_3874">The method of controlling access to I/O ports depends upon whether they are I/O-port mapped or memory </span>
<span id="t1m_3874" class="t s3_3874">mapped. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
