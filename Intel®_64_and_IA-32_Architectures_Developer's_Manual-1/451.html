<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p451" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_451{left:796px;bottom:68px;letter-spacing:0.08px;word-spacing:0.01px;}
#t2_451{left:834px;bottom:68px;letter-spacing:0.1px;}
#t3_451{left:428px;bottom:1141px;letter-spacing:-0.14px;}
#t4_451{left:70px;bottom:1079px;letter-spacing:0.15px;}
#t5_451{left:151px;bottom:1079px;letter-spacing:0.22px;word-spacing:-0.04px;}
#t6_451{left:70px;bottom:1054px;letter-spacing:-0.15px;word-spacing:-1.18px;}
#t7_451{left:70px;bottom:1037px;letter-spacing:-0.07px;word-spacing:-0.51px;}
#t8_451{left:70px;bottom:1020px;letter-spacing:-0.04px;word-spacing:-1.07px;}
#t9_451{left:70px;bottom:1004px;letter-spacing:-0.06px;word-spacing:-0.46px;}
#ta_451{left:70px;bottom:987px;letter-spacing:-0.05px;word-spacing:-0.46px;}
#tb_451{left:70px;bottom:919px;letter-spacing:0.14px;}
#tc_451{left:151px;bottom:919px;letter-spacing:0.2px;word-spacing:-0.02px;}
#td_451{left:70px;bottom:894px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#te_451{left:70px;bottom:877px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#tf_451{left:70px;bottom:860px;letter-spacing:-0.15px;word-spacing:-0.47px;}
#tg_451{left:70px;bottom:843px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#th_451{left:70px;bottom:826px;letter-spacing:-0.14px;word-spacing:-0.49px;}
#ti_451{left:70px;bottom:810px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tj_451{left:70px;bottom:793px;letter-spacing:-0.17px;word-spacing:-0.43px;}
#tk_451{left:70px;bottom:768px;letter-spacing:-0.16px;word-spacing:-0.46px;}
#tl_451{left:70px;bottom:752px;letter-spacing:-0.14px;word-spacing:-0.93px;}
#tm_451{left:70px;bottom:735px;letter-spacing:-0.16px;word-spacing:-0.46px;}
#tn_451{left:70px;bottom:718px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#to_451{left:70px;bottom:701px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#tp_451{left:70px;bottom:684px;letter-spacing:-0.16px;word-spacing:-0.59px;}
#tq_451{left:70px;bottom:668px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tr_451{left:70px;bottom:651px;letter-spacing:-0.16px;word-spacing:-0.42px;}
#ts_451{left:70px;bottom:592px;letter-spacing:0.13px;}
#tt_451{left:152px;bottom:592px;letter-spacing:0.15px;word-spacing:0.01px;}
#tu_451{left:70px;bottom:568px;letter-spacing:-0.15px;word-spacing:-0.68px;}
#tv_451{left:70px;bottom:551px;letter-spacing:-0.14px;word-spacing:-1.14px;}
#tw_451{left:70px;bottom:535px;letter-spacing:-0.14px;word-spacing:-1.13px;}
#tx_451{left:70px;bottom:518px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#ty_451{left:70px;bottom:501px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tz_451{left:70px;bottom:484px;letter-spacing:-0.15px;word-spacing:-0.47px;}
#t10_451{left:70px;bottom:467px;letter-spacing:-0.15px;word-spacing:-0.72px;}
#t11_451{left:70px;bottom:451px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t12_451{left:70px;bottom:434px;letter-spacing:-0.16px;word-spacing:-0.81px;}
#t13_451{left:70px;bottom:417px;letter-spacing:-0.15px;word-spacing:-0.48px;}
#t14_451{left:70px;bottom:400px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t15_451{left:70px;bottom:383px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t16_451{left:70px;bottom:367px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t17_451{left:70px;bottom:350px;letter-spacing:-0.13px;word-spacing:-0.51px;}
#t18_451{left:70px;bottom:325px;letter-spacing:-0.21px;word-spacing:-0.41px;}
#t19_451{left:70px;bottom:299px;}
#t1a_451{left:96px;bottom:302px;letter-spacing:-0.14px;word-spacing:-0.7px;}
#t1b_451{left:96px;bottom:286px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t1c_451{left:96px;bottom:269px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t1d_451{left:96px;bottom:252px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t1e_451{left:70px;bottom:226px;}
#t1f_451{left:96px;bottom:229px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#t1g_451{left:96px;bottom:212px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t1h_451{left:96px;bottom:195px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#t1i_451{left:70px;bottom:171px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t1j_451{left:70px;bottom:154px;letter-spacing:-0.14px;word-spacing:-0.78px;}
#t1k_451{left:70px;bottom:137px;letter-spacing:-0.14px;word-spacing:-0.63px;}
#t1l_451{left:70px;bottom:121px;letter-spacing:-0.16px;word-spacing:-0.45px;}

.s1_451{font-size:12px;font-family:NeoSansIntel_pgv;color:#000;}
.s2_451{font-size:14px;font-family:NeoSansIntel_pgv;color:#0860A8;}
.s3_451{font-size:21px;font-family:NeoSansIntelMedium_pgu;color:#0860A8;}
.s4_451{font-size:14px;font-family:Verdana_13-;color:#000;}
.s5_451{font-size:18px;font-family:NeoSansIntelMedium_pgu;color:#0860A8;}
.s6_451{font-size:21px;font-family:TimesNewRoman_143;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts451" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_pgu;
	src: url("fonts/NeoSansIntelMedium_pgu.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_pgv;
	src: url("fonts/NeoSansIntel_pgv.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_143;
	src: url("fonts/TimesNewRoman_143.woff") format("woff");
}

@font-face {
	font-family: Verdana_13-;
	src: url("fonts/Verdana_13-.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg451Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg451" style="-webkit-user-select: none;"><object width="935" height="1210" data="451/451.svg" type="image/svg+xml" id="pdf451" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_451" class="t s1_451">Vol. 1 </span><span id="t2_451" class="t s1_451">D-3 </span>
<span id="t3_451" class="t s2_451">GUIDELINES FOR WRITING SIMD FLOATING-POINT EXCEPTION HANDLERS </span>
<span id="t4_451" class="t s3_451">D.3 </span><span id="t5_451" class="t s3_451">EXCEPTION SYNCHRONIZATION </span>
<span id="t6_451" class="t s4_451">An SSE/SSE2/SSE3 instruction can execute in parallel with other similar instructions, with integer instructions, and </span>
<span id="t7_451" class="t s4_451">with floating-point or MMX instructions. Unlike for x87 instructions, special precaution for exception synchroniza- </span>
<span id="t8_451" class="t s4_451">tion is not necessary in this case. This is because floating-point exceptions for SSE/SSE2/SSE3 instructions occur </span>
<span id="t9_451" class="t s4_451">immediately and are not delayed until a subsequent floating-point instruction is executed. However, floating- </span>
<span id="ta_451" class="t s4_451">point emulation may be necessary when unmasked floating-point exceptions are generated. </span>
<span id="tb_451" class="t s3_451">D.4 </span><span id="tc_451" class="t s3_451">SIMD FLOATING-POINT EXCEPTIONS AND THE IEEE STANDARD 754 </span>
<span id="td_451" class="t s4_451">SSE/SSE2/SSE3 extensions are 100% compatible with the IEEE Standard 754 for Floating-Point Arithmetic, satis- </span>
<span id="te_451" class="t s4_451">fying all of its mandatory requirements (when the flush-to-zero or denormals-are-zeros modes are not enabled). </span>
<span id="tf_451" class="t s4_451">But a programming environment that includes SSE/SSE2/SSE3 instructions will comply with both the obligatory </span>
<span id="tg_451" class="t s4_451">and the strongly recommended requirements of the IEEE Standard 754 regarding floating-point exception </span>
<span id="th_451" class="t s4_451">handling, only as a combination of hardware and software (which is acceptable). The standard states that a user </span>
<span id="ti_451" class="t s4_451">should be able to request a trap on any of the five floating-point exceptions (note that the denormal exception is </span>
<span id="tj_451" class="t s4_451">an IA-32 addition), and it also specifies the values (operands or result) to be delivered to the exception handler. </span>
<span id="tk_451" class="t s4_451">The main issue is that for SSE/SSE2/SSE3 instructions that raise post-computation exceptions (traps: overflow, </span>
<span id="tl_451" class="t s4_451">underflow, or inexact), unlike for x87 FPU instructions, the processor does not provide the result recommended by </span>
<span id="tm_451" class="t s4_451">IEEE Standard 754 to the user handler. If a user program needs the result of an instruction that generated a post- </span>
<span id="tn_451" class="t s4_451">computation exception, it is the responsibility of the software to produce this result by emulating the faulting </span>
<span id="to_451" class="t s4_451">SSE/SSE2/SSE3 instruction. Another issue is that the standard does not specify explicitly how to handle multiple </span>
<span id="tp_451" class="t s4_451">floating-point exceptions that occur simultaneously. For packed operations, a logical OR of the flags that would be </span>
<span id="tq_451" class="t s4_451">set by each sub-operation is used to set the exception flags in the MXCSR. The following subsections present one </span>
<span id="tr_451" class="t s4_451">possible way to solve these problems. </span>
<span id="ts_451" class="t s5_451">D.4.1 </span><span id="tt_451" class="t s5_451">Floating-Point Emulation </span>
<span id="tu_451" class="t s4_451">Every operating system must provide a kernel level floating-point exception handler (a template was presented in </span>
<span id="tv_451" class="t s4_451">Section D.2, “Software Exception Handling,” above). In the following discussion, assume that a user mode floating- </span>
<span id="tw_451" class="t s4_451">point exception filter is supplied for SIMD floating-point exceptions (for example as part of a library of C functions), </span>
<span id="tx_451" class="t s4_451">that a user program can invoke in order to handle unmasked exceptions. The user mode floating-point exception </span>
<span id="ty_451" class="t s4_451">filter (not shown here) has to be able to emulate the subset of Intel SSE, SSE2, and SSE3 instructions that can </span>
<span id="tz_451" class="t s4_451">generate numeric exceptions, and has to be able to invoke a user provided floating-point exception handler for </span>
<span id="t10_451" class="t s4_451">floating-point exceptions. When a floating-point exception that is not masked is raised by an Intel SSE, SSE2, and </span>
<span id="t11_451" class="t s4_451">SSE3 instruction, the low-level floating-point exception handler will be called. This low-level handler may in turn </span>
<span id="t12_451" class="t s4_451">call the user mode floating-point exception filter. The filter function receives the original operands of the excepting </span>
<span id="t13_451" class="t s4_451">instruction as no results are provided by the hardware, whether a pre-computation or a post-computation excep- </span>
<span id="t14_451" class="t s4_451">tion has occurred. The filter will unpack the operands into up to four sets of sub-operands, and will submit them </span>
<span id="t15_451" class="t s4_451">one set at a time to an emulation function (See Example D-2 in Section D.4.3, “Example SIMD Floating-Point </span>
<span id="t16_451" class="t s4_451">Emulation Implementation.”) The emulation function will examine the sub-operands, and will possibly redo the </span>
<span id="t17_451" class="t s4_451">necessary calculation. </span>
<span id="t18_451" class="t s4_451">Two cases are possible: </span>
<span id="t19_451" class="t s6_451">• </span><span id="t1a_451" class="t s4_451">If an unmasked (enabled) exception would occur in this process, the emulation function will return to its caller </span>
<span id="t1b_451" class="t s4_451">(the filter function) with the appropriate information. The filter will invoke a (previously registered) user </span>
<span id="t1c_451" class="t s4_451">floating-point exception handler for this set of sub-operands, and will record the result upon return from the </span>
<span id="t1d_451" class="t s4_451">user handler (provided the user handler allows continuation of the execution). </span>
<span id="t1e_451" class="t s6_451">• </span><span id="t1f_451" class="t s4_451">If no unmasked (enabled) exception would occur, the emulation function will determine and will return to its </span>
<span id="t1g_451" class="t s4_451">caller the result of the operation for the current set of sub-operands (it has to be IEEE Standard 754 </span>
<span id="t1h_451" class="t s4_451">compliant). The filter function will record the result (plus any new flag settings). </span>
<span id="t1i_451" class="t s4_451">The user level filter function will then call the emulation function for the next set of sub-operands (if any). When </span>
<span id="t1j_451" class="t s4_451">done with all the operand sets, the partial results will be packed (if the excepting instruction has a packed floating- </span>
<span id="t1k_451" class="t s4_451">point result, which is true for most SSE/SSE2/SSE3 numeric instructions) and the filter will return to the low-level </span>
<span id="t1l_451" class="t s4_451">exception handler, which in turn will return from the interruption, allowing execution to continue. Note that the </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
