<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p992" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_992{left:69px;bottom:68px;letter-spacing:0.12px;}
#t2_992{left:110px;bottom:68px;letter-spacing:0.1px;}
#t3_992{left:69px;bottom:1141px;letter-spacing:-0.15px;word-spacing:0.01px;}
#t4_992{left:69px;bottom:1088px;letter-spacing:-0.14px;word-spacing:-0.43px;}
#t5_992{left:69px;bottom:1071px;letter-spacing:-0.14px;word-spacing:-0.42px;}
#t6_992{left:69px;bottom:1045px;}
#t7_992{left:95px;bottom:1048px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t8_992{left:95px;bottom:1031px;letter-spacing:-0.15px;word-spacing:-0.41px;}
#t9_992{left:69px;bottom:1005px;}
#ta_992{left:95px;bottom:1008px;letter-spacing:-0.14px;word-spacing:-0.67px;}
#tb_992{left:95px;bottom:991px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tc_992{left:95px;bottom:975px;letter-spacing:-0.14px;word-spacing:-0.4px;}
#td_992{left:69px;bottom:950px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#te_992{left:69px;bottom:933px;letter-spacing:-0.14px;word-spacing:-0.42px;}
#tf_992{left:69px;bottom:875px;letter-spacing:0.13px;}
#tg_992{left:151px;bottom:875px;letter-spacing:0.15px;word-spacing:0.01px;}
#th_992{left:69px;bottom:851px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#ti_992{left:69px;bottom:834px;letter-spacing:-0.16px;word-spacing:-0.65px;}
#tj_992{left:69px;bottom:817px;letter-spacing:-0.16px;word-spacing:-0.47px;}
#tk_992{left:69px;bottom:800px;letter-spacing:-0.16px;word-spacing:-0.48px;}
#tl_992{left:69px;bottom:776px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tm_992{left:69px;bottom:717px;letter-spacing:0.13px;}
#tn_992{left:151px;bottom:717px;letter-spacing:0.15px;}
#to_992{left:69px;bottom:694px;letter-spacing:-0.17px;word-spacing:-0.96px;}
#tp_992{left:462px;bottom:694px;letter-spacing:-0.14px;word-spacing:-1.03px;}
#tq_992{left:69px;bottom:677px;letter-spacing:-0.15px;word-spacing:-0.41px;}
#tr_992{left:69px;bottom:652px;letter-spacing:-0.15px;word-spacing:-0.43px;}
#ts_992{left:69px;bottom:635px;letter-spacing:-0.18px;word-spacing:-0.45px;}
#tt_992{left:69px;bottom:619px;letter-spacing:-0.15px;word-spacing:-1.2px;}
#tu_992{left:69px;bottom:602px;letter-spacing:-0.18px;word-spacing:-0.44px;}
#tv_992{left:69px;bottom:585px;letter-spacing:-0.17px;word-spacing:-0.44px;}
#tw_992{left:69px;bottom:561px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#tx_992{left:69px;bottom:544px;letter-spacing:-0.13px;word-spacing:-1.04px;}
#ty_992{left:235px;bottom:544px;letter-spacing:-0.14px;word-spacing:-1.05px;}
#tz_992{left:69px;bottom:527px;letter-spacing:-0.16px;word-spacing:-0.46px;}
#t10_992{left:69px;bottom:503px;letter-spacing:-0.16px;word-spacing:-0.46px;}
#t11_992{left:69px;bottom:486px;letter-spacing:-0.2px;}
#t12_992{left:95px;bottom:486px;letter-spacing:-0.13px;word-spacing:-1.31px;}
#t13_992{left:69px;bottom:469px;letter-spacing:-0.14px;word-spacing:-0.42px;}
#t14_992{left:69px;bottom:419px;letter-spacing:-0.09px;}
#t15_992{left:154px;bottom:419px;letter-spacing:-0.1px;word-spacing:0.01px;}
#t16_992{left:69px;bottom:395px;letter-spacing:-0.14px;word-spacing:-0.44px;}
#t17_992{left:69px;bottom:378px;letter-spacing:-0.16px;word-spacing:-1.13px;}
#t18_992{left:69px;bottom:361px;letter-spacing:-0.17px;word-spacing:-0.44px;}
#t19_992{left:69px;bottom:337px;letter-spacing:-0.16px;word-spacing:-0.6px;}
#t1a_992{left:69px;bottom:320px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t1b_992{left:69px;bottom:303px;letter-spacing:-0.15px;word-spacing:-0.44px;}
#t1c_992{left:69px;bottom:279px;letter-spacing:-0.14px;word-spacing:-1px;}
#t1d_992{left:69px;bottom:262px;letter-spacing:-0.13px;word-spacing:-0.48px;}
#t1e_992{left:69px;bottom:245px;letter-spacing:-0.13px;word-spacing:-0.47px;}
#t1f_992{left:69px;bottom:221px;letter-spacing:-0.15px;word-spacing:-0.44px;}
#t1g_992{left:69px;bottom:204px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#t1h_992{left:69px;bottom:187px;letter-spacing:-0.15px;word-spacing:-0.41px;}

.s1_992{font-size:12px;font-family:NeoSansIntel_1uk1;color:#000;}
.s2_992{font-size:14px;font-family:NeoSansIntel_1uk1;color:#0860A8;}
.s3_992{font-size:14px;font-family:Verdana_3e8;color:#000;}
.s4_992{font-size:21px;font-family:TimesNewRoman_3ec;color:#000;}
.s5_992{font-size:18px;font-family:NeoSansIntelMedium_1uk0;color:#0860A8;}
.s6_992{font-size:17px;font-family:NeoSansIntelMedium_1uk0;color:#0860A8;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts992" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_1uk0;
	src: url("fonts/NeoSansIntelMedium_1uk0.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_1uk1;
	src: url("fonts/NeoSansIntel_1uk1.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_3ec;
	src: url("fonts/TimesNewRoman_3ec.woff") format("woff");
}

@font-face {
	font-family: Verdana_3e8;
	src: url("fonts/Verdana_3e8.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg992Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg992" style="-webkit-user-select: none;"><object width="935" height="1210" data="992/992.svg" type="image/svg+xml" id="pdf992" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_992" class="t s1_992">26-16 </span><span id="t2_992" class="t s1_992">Vol. 3C </span>
<span id="t3_992" class="t s2_992">VMX NON-ROOT OPERATION </span>
<span id="t4_992" class="t s3_992">An MTF VM exit occurs on the instruction boundary on which it is pending unless a higher priority event takes </span>
<span id="t5_992" class="t s3_992">precedence or the MTF VM exit is blocked due to the activity state: </span>
<span id="t6_992" class="t s4_992">• </span><span id="t7_992" class="t s3_992">System-management interrupts (SMIs), INIT signals, and higher priority events take priority over MTF </span>
<span id="t8_992" class="t s3_992">VM exits. MTF VM exits take priority over debug-trap exceptions and lower priority events. </span>
<span id="t9_992" class="t s4_992">• </span><span id="ta_992" class="t s3_992">No MTF VM exit occurs if the processor is in either the shutdown activity state or wait-for-SIPI activity state. If </span>
<span id="tb_992" class="t s3_992">a non-maskable interrupt subsequently takes the logical processor out of the shutdown activity state without </span>
<span id="tc_992" class="t s3_992">causing a VM exit, an MTF VM exit is pending after delivery of that interrupt. </span>
<span id="td_992" class="t s3_992">Special treatment may apply to Intel SGX instructions or if the logical processor is in enclave mode. See Section </span>
<span id="te_992" class="t s3_992">40.2 for details. </span>
<span id="tf_992" class="t s5_992">26.5.3 </span><span id="tg_992" class="t s5_992">Translation of Guest-Physical Addresses Using EPT </span>
<span id="th_992" class="t s3_992">The extended page-table mechanism (EPT) is a feature that can be used to support the virtualization of physical </span>
<span id="ti_992" class="t s3_992">memory. When EPT is in use, certain physical addresses are treated as guest-physical addresses and are not used </span>
<span id="tj_992" class="t s3_992">to access memory directly. Instead, guest-physical addresses are translated by traversing a set of EPT paging </span>
<span id="tk_992" class="t s3_992">structures to produce physical addresses that are used to access memory. </span>
<span id="tl_992" class="t s3_992">Details of the EPT mechanism are given in Section 29.3. </span>
<span id="tm_992" class="t s5_992">26.5.4 </span><span id="tn_992" class="t s5_992">Translation of Guest-Physical Addresses Used by Intel Processor Trace </span>
<span id="to_992" class="t s3_992">As described in Chapter 33, Intel® Processor Trace (Intel </span><span id="tp_992" class="t s3_992">PT) captures information about software execution using </span>
<span id="tq_992" class="t s3_992">dedicated hardware facilities. </span>
<span id="tr_992" class="t s3_992">Intel PT can be configured so that the trace output is written to memory using physical addresses. For example, </span>
<span id="ts_992" class="t s3_992">when the ToPA (table of physical addresses) output mechanism is used, the IA32_RTIT_OUTPUT_BASE MSR </span>
<span id="tt_992" class="t s3_992">contains the physical address of the base of the current ToPA. Each entry in that table contains the physical address </span>
<span id="tu_992" class="t s3_992">of an output region in memory. When an output region becomes full, the ToPA output mechanism directs subse- </span>
<span id="tv_992" class="t s3_992">quent trace output to the next output region as indicated in the ToPA. </span>
<span id="tw_992" class="t s3_992">When the “Intel PT uses guest physical addresses” VM-execution control is 1, the logical processor treats the </span>
<span id="tx_992" class="t s3_992">addresses used by Intel </span><span id="ty_992" class="t s3_992">PT (the output addresses as well as those used to discover the output addresses) as guest- </span>
<span id="tz_992" class="t s3_992">physical addresses, translating to physical addresses using EPT before trace output is written to memory. </span>
<span id="t10_992" class="t s3_992">Translating these addresses through EPT implies that the trace-output mechanism may cause EPT violations and </span>
<span id="t11_992" class="t s3_992">VM </span><span id="t12_992" class="t s3_992">exits; details are provided in Section 26.5.4.1. Section 26.5.4.2 describes a mechanism that ensures that these </span>
<span id="t13_992" class="t s3_992">VM exits do not cause loss of trace data. </span>
<span id="t14_992" class="t s6_992">26.5.4.1 </span><span id="t15_992" class="t s6_992">Guest-Physical Address Translation for Intel PT: Details </span>
<span id="t16_992" class="t s3_992">When the “Intel PT uses guest physical addresses” VM-execution control is 1, the addresses used by Intel PT are </span>
<span id="t17_992" class="t s3_992">treated as guest-physical addresses and translated using EPT. These addresses include the addresses of the output </span>
<span id="t18_992" class="t s3_992">regions as well as the addresses of the ToPA entries that contain the output-region addresses. </span>
<span id="t19_992" class="t s3_992">Translation of accesses by the trace-output process may result in EPT violations or EPT misconfigurations (Section </span>
<span id="t1a_992" class="t s3_992">29.3.3), resulting in VM exits. EPT violations resulting for the trace-output process always cause VM exits and are </span>
<span id="t1b_992" class="t s3_992">never converted to virtualization exceptions (Section 26.5.7.1). </span>
<span id="t1c_992" class="t s3_992">If no EPT violation or EPT misconfiguration occurs and if page-modification logging (Section 29.3.6) is enabled, the </span>
<span id="t1d_992" class="t s3_992">address of an output region may be added to the page-modification log. If the log is full, a page-modification log- </span>
<span id="t1e_992" class="t s3_992">full event occurs, resulting in a VM exit. </span>
<span id="t1f_992" class="t s3_992">If the “virtualize APIC accesses” VM-execution control is 1, a guest-physical address used by the trace-output </span>
<span id="t1g_992" class="t s3_992">process may be translated to an address on the APIC-access page. In this case, the access by the trace-output </span>
<span id="t1h_992" class="t s3_992">process causes an APIC-access VM exit as discussed in Section 30.4.6.1. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
