<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p260" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_260{left:69px;bottom:68px;letter-spacing:0.1px;}
#t2_260{left:96px;bottom:68px;letter-spacing:0.1px;}
#t3_260{left:69px;bottom:1141px;letter-spacing:-0.14px;}
#t4_260{left:69px;bottom:1088px;letter-spacing:-0.14px;word-spacing:-0.44px;}
#t5_260{left:69px;bottom:1071px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t6_260{left:69px;bottom:1012px;letter-spacing:0.12px;}
#t7_260{left:151px;bottom:1012px;letter-spacing:0.14px;word-spacing:0.01px;}
#t8_260{left:69px;bottom:990px;letter-spacing:-0.14px;word-spacing:-0.68px;}
#t9_260{left:69px;bottom:973px;letter-spacing:-0.14px;word-spacing:-0.49px;}
#ta_260{left:69px;bottom:956px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#tb_260{left:480px;bottom:963px;}
#tc_260{left:487px;bottom:956px;}
#td_260{left:69px;bottom:932px;letter-spacing:-0.14px;}
#te_260{left:95px;bottom:932px;letter-spacing:-0.19px;word-spacing:-0.43px;}
#tf_260{left:69px;bottom:907px;letter-spacing:-0.13px;}
#tg_260{left:95px;bottom:907px;letter-spacing:-0.16px;word-spacing:-0.73px;}
#th_260{left:95px;bottom:891px;letter-spacing:-0.15px;word-spacing:-0.48px;}
#ti_260{left:95px;bottom:874px;letter-spacing:-0.22px;word-spacing:-0.43px;}
#tj_260{left:69px;bottom:849px;letter-spacing:-0.14px;}
#tk_260{left:95px;bottom:849px;letter-spacing:-0.14px;word-spacing:-1.34px;}
#tl_260{left:95px;bottom:833px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#tm_260{left:69px;bottom:810px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tn_260{left:69px;bottom:793px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#to_260{left:69px;bottom:770px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tp_260{left:69px;bottom:753px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tq_260{left:69px;bottom:730px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tr_260{left:69px;bottom:713px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#ts_260{left:69px;bottom:690px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#tt_260{left:69px;bottom:674px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#tu_260{left:69px;bottom:615px;letter-spacing:0.12px;}
#tv_260{left:151px;bottom:615px;letter-spacing:0.14px;word-spacing:0.01px;}
#tw_260{left:69px;bottom:593px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#tx_260{left:615px;bottom:593px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#ty_260{left:69px;bottom:576px;letter-spacing:-0.16px;}
#tz_260{left:157px;bottom:576px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t10_260{left:69px;bottom:553px;letter-spacing:-0.14px;word-spacing:-0.43px;}
#t11_260{left:69px;bottom:529px;letter-spacing:-0.13px;}
#t12_260{left:95px;bottom:529px;letter-spacing:-0.13px;word-spacing:-0.77px;}
#t13_260{left:95px;bottom:512px;letter-spacing:-0.14px;word-spacing:-0.5px;}
#t14_260{left:69px;bottom:487px;letter-spacing:-0.14px;}
#t15_260{left:95px;bottom:487px;letter-spacing:-0.14px;word-spacing:-0.73px;}
#t16_260{left:95px;bottom:470px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#t17_260{left:69px;bottom:446px;letter-spacing:-0.14px;}
#t18_260{left:95px;bottom:446px;letter-spacing:-0.16px;word-spacing:-0.51px;}
#t19_260{left:95px;bottom:429px;letter-spacing:-0.14px;word-spacing:-0.81px;}
#t1a_260{left:95px;bottom:412px;letter-spacing:-0.13px;word-spacing:-0.52px;}
#t1b_260{left:69px;bottom:389px;letter-spacing:-0.17px;word-spacing:-0.44px;}
#t1c_260{left:69px;bottom:373px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t1d_260{left:69px;bottom:356px;letter-spacing:-0.13px;word-spacing:-0.48px;}
#t1e_260{left:69px;bottom:333px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t1f_260{left:69px;bottom:316px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t1g_260{left:69px;bottom:293px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t1h_260{left:69px;bottom:276px;letter-spacing:-0.13px;word-spacing:-0.49px;}
#t1i_260{left:69px;bottom:260px;letter-spacing:-0.12px;word-spacing:-0.47px;}
#t1j_260{left:69px;bottom:237px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t1k_260{left:69px;bottom:220px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t1l_260{left:69px;bottom:203px;letter-spacing:-0.14px;word-spacing:-0.93px;}
#t1m_260{left:69px;bottom:186px;letter-spacing:-0.15px;word-spacing:-0.44px;}
#t1n_260{left:69px;bottom:149px;letter-spacing:-0.11px;}
#t1o_260{left:91px;bottom:149px;letter-spacing:-0.11px;}
#t1p_260{left:91px;bottom:133px;letter-spacing:-0.11px;}
#t1q_260{left:91px;bottom:116px;letter-spacing:-0.12px;word-spacing:0.01px;}

.s1_260{font-size:12px;font-family:NeoSansIntel_1uk1;color:#000;}
.s2_260{font-size:14px;font-family:NeoSansIntel_1uk1;color:#0860A8;}
.s3_260{font-size:14px;font-family:Verdana_3e8;color:#000;}
.s4_260{font-size:18px;font-family:NeoSansIntelMedium_1uk0;color:#0860A8;}
.s5_260{font-size:11px;font-family:Verdana_3e8;color:#000;}
.s6_260{font-size:14px;font-family:Verdana-Bold_3e7;color:#000;}
.s7_260{font-size:14px;font-family:NeoSansIntel_1uk1;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts260" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_1uk0;
	src: url("fonts/NeoSansIntelMedium_1uk0.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_1uk1;
	src: url("fonts/NeoSansIntel_1uk1.woff") format("woff");
}

@font-face {
	font-family: Verdana-Bold_3e7;
	src: url("fonts/Verdana-Bold_3e7.woff") format("woff");
}

@font-face {
	font-family: Verdana_3e8;
	src: url("fonts/Verdana_3e8.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg260Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg260" style="-webkit-user-select: none;"><object width="935" height="1210" data="260/260.svg" type="image/svg+xml" id="pdf260" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_260" class="t s1_260">7-6 </span><span id="t2_260" class="t s1_260">Vol. 3A </span>
<span id="t3_260" class="t s2_260">USER INTERRUPTS </span>
<span id="t4_260" class="t s3_260">A logical processor is not interruptible during either user-interrupt notification identification or user-interrupt noti- </span>
<span id="t5_260" class="t s3_260">fication processing or between those operations (when they occur in succession). </span>
<span id="t6_260" class="t s4_260">7.5.1 </span><span id="t7_260" class="t s4_260">User-Interrupt Notification Identification </span>
<span id="t8_260" class="t s3_260">If CR4.UINTR = IA32_EFER.LMA = 1, a logical processor performs user-interrupt notification identification when it </span>
<span id="t9_260" class="t s3_260">receives an ordinary interrupt. The following algorithm describes the response by the processor to an ordinary </span>
<span id="ta_260" class="t s3_260">maskable interrupt when CR4.UINTR = IA32_EFER.LMA = 1 </span>
<span id="tb_260" class="t s5_260">5 </span>
<span id="tc_260" class="t s3_260">: </span>
<span id="td_260" class="t s3_260">1. </span><span id="te_260" class="t s3_260">The local APIC is acknowledged; this provides the processor core with an interrupt vector, V. </span>
<span id="tf_260" class="t s3_260">2. </span><span id="tg_260" class="t s3_260">If V = UINV, the logical processor continues to the next step. Otherwise, an interrupt with vector V is delivered </span>
<span id="th_260" class="t s3_260">normally through the IDT; the remainder of this algorithm does not apply and user-interrupt notification </span>
<span id="ti_260" class="t s3_260">processing does not occur. </span>
<span id="tj_260" class="t s3_260">3. </span><span id="tk_260" class="t s3_260">The processor writes zero to the EOI register in the local APIC; this dismisses the interrupt with vector V = UINV </span>
<span id="tl_260" class="t s3_260">from the local APIC. </span>
<span id="tm_260" class="t s3_260">User-interrupt notification identification involves acknowledgment of the local APIC and thus occurs only when </span>
<span id="tn_260" class="t s3_260">ordinary interrupts are not masked. </span>
<span id="to_260" class="t s3_260">If user-interrupt notification identification completes step #3, the logical processor then performs user-interrupt </span>
<span id="tp_260" class="t s3_260">notification processing as described in Section 7.5.2. </span>
<span id="tq_260" class="t s3_260">An ordinary interrupt that occurs during transactional execution causes the transactional execution to abort and </span>
<span id="tr_260" class="t s3_260">transition to a non-transactional execution. This occurs before user-interrupt notification identification. </span>
<span id="ts_260" class="t s3_260">An ordinary interrupt that occurs while software is executing inside an enclave causes an asynchronous enclave </span>
<span id="tt_260" class="t s3_260">exit (AEX). This AEX occurs before user-interrupt notification identification. </span>
<span id="tu_260" class="t s4_260">7.5.2 </span><span id="tv_260" class="t s4_260">User-Interrupt Notification Processing </span>
<span id="tw_260" class="t s3_260">Once a logical processor has identified a user-interrupt notification, it performs </span><span id="tx_260" class="t s6_260">user-interrupt notification </span>
<span id="ty_260" class="t s6_260">processing </span><span id="tz_260" class="t s3_260">using the UPID at the linear address in the IA32_UINTR_PD MSR. </span>
<span id="t10_260" class="t s3_260">The following algorithm describes user-interrupt notification processing: </span>
<span id="t11_260" class="t s3_260">1. </span><span id="t12_260" class="t s3_260">The logical processor clears the outstanding-notification bit (bit 0) in the UPID. This is done atomically so as to </span>
<span id="t13_260" class="t s3_260">leave the remainder of the descriptor unmodified. </span>
<span id="t14_260" class="t s3_260">2. </span><span id="t15_260" class="t s3_260">The logical processor reads PIR (bits 127:64 of the UPID) into a temporary register and writes all zeros to PIR. </span>
<span id="t16_260" class="t s3_260">This is done atomically so as to ensure that each bit cleared in PIR is set in the temporary register. </span>
<span id="t17_260" class="t s3_260">3. </span><span id="t18_260" class="t s3_260">If any bit is set in the temporary register, the logical processor sets in UIRR each bit corresponding to a bit set </span>
<span id="t19_260" class="t s3_260">in the temporary register (e.g., with a logical OR) and recognizes a pending user interrupt (if it has not already </span>
<span id="t1a_260" class="t s3_260">done so). </span>
<span id="t1b_260" class="t s3_260">The logical processor performs the steps above in an uninterruptible manner. Steps #1 and #2 may be combined </span>
<span id="t1c_260" class="t s3_260">into a single atomic step. If step #3 leads to recognition of a user interrupt, the processor may deliver that user </span>
<span id="t1d_260" class="t s3_260">interrupt on the following instruction boundary (see Section 7.4.2). </span>
<span id="t1e_260" class="t s3_260">Although user-interrupt notification processing may occur at any privilege level, all of the memory accesses in </span>
<span id="t1f_260" class="t s3_260">steps #1 and #2 are performed with supervisor privilege. </span>
<span id="t1g_260" class="t s3_260">Step #1 and step #2 each access the UPID using a linear address and may therefore incur faults (page faults, or </span>
<span id="t1h_260" class="t s3_260">general-protection faults due to canonicality violations). If such a fault produces an error code that uses the EXT </span>
<span id="t1i_260" class="t s3_260">bit, that bit will be set to 1. </span>
<span id="t1j_260" class="t s3_260">If a fault occurs during user-interrupt notification processing, updates to architectural state performed by the </span>
<span id="t1k_260" class="t s3_260">earlier user-interrupt notification identification (Section 7.5.1) remain committed and are not undone; if such a </span>
<span id="t1l_260" class="t s3_260">fault occurs at step #2 (if it is not performed atomically with step #1), any update to architectural state performed </span>
<span id="t1m_260" class="t s3_260">by step #1 also remains committed. System software is advised to prevent such faults (e.g., by ensuring that no </span>
<span id="t1n_260" class="t s7_260">5. </span><span id="t1o_260" class="t s7_260">If the interrupt arrives between iterations of a REP-prefixed string instruction, the processor first updates state as follows: RIP is </span>
<span id="t1p_260" class="t s7_260">loaded to reference the string instruction; RCX, RSI, and RDI are updated as appropriate to reflect the iterations completed; and </span>
<span id="t1q_260" class="t s7_260">RFLAGS.RF is set to 1. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
