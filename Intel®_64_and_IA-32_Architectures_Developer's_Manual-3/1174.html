<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p1174" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_1174{left:69px;bottom:68px;letter-spacing:0.11px;}
#t2_1174{left:103px;bottom:68px;letter-spacing:0.09px;}
#t3_1174{left:69px;bottom:1141px;letter-spacing:-0.14px;}
#t4_1174{left:69px;bottom:1088px;letter-spacing:-0.16px;word-spacing:-0.55px;}
#t5_1174{left:69px;bottom:1071px;letter-spacing:-0.16px;word-spacing:-1.09px;}
#t6_1174{left:69px;bottom:1054px;letter-spacing:-0.14px;}
#t7_1174{left:69px;bottom:1031px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t8_1174{left:69px;bottom:1014px;letter-spacing:-0.16px;word-spacing:-0.36px;}
#t9_1174{left:69px;bottom:964px;letter-spacing:-0.09px;}
#ta_1174{left:154px;bottom:964px;letter-spacing:-0.09px;word-spacing:0.02px;}
#tb_1174{left:69px;bottom:942px;letter-spacing:-0.16px;word-spacing:-0.81px;}
#tc_1174{left:69px;bottom:925px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#td_1174{left:69px;bottom:908px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#te_1174{left:69px;bottom:891px;letter-spacing:-0.15px;word-spacing:-0.5px;}
#tf_1174{left:69px;bottom:868px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#tg_1174{left:69px;bottom:852px;letter-spacing:-0.14px;word-spacing:-0.91px;}
#th_1174{left:69px;bottom:835px;letter-spacing:-0.16px;word-spacing:-0.48px;}
#ti_1174{left:69px;bottom:818px;letter-spacing:-0.15px;word-spacing:-0.93px;}
#tj_1174{left:69px;bottom:801px;letter-spacing:-0.16px;word-spacing:-0.45px;}
#tk_1174{left:69px;bottom:784px;letter-spacing:-0.14px;word-spacing:-0.63px;}
#tl_1174{left:69px;bottom:768px;letter-spacing:-0.34px;}
#tm_1174{left:69px;bottom:745px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tn_1174{left:69px;bottom:728px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#to_1174{left:69px;bottom:711px;letter-spacing:-0.14px;word-spacing:-0.7px;}
#tp_1174{left:69px;bottom:694px;letter-spacing:-0.15px;word-spacing:-0.47px;}
#tq_1174{left:69px;bottom:671px;letter-spacing:-0.14px;word-spacing:-0.69px;}
#tr_1174{left:69px;bottom:655px;letter-spacing:-0.14px;word-spacing:-0.74px;}
#ts_1174{left:69px;bottom:638px;letter-spacing:-0.17px;word-spacing:-1.15px;}
#tt_1174{left:69px;bottom:621px;letter-spacing:-0.13px;word-spacing:-0.47px;}
#tu_1174{left:69px;bottom:598px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tv_1174{left:69px;bottom:581px;letter-spacing:-0.14px;word-spacing:-0.49px;}
#tw_1174{left:69px;bottom:558px;letter-spacing:-0.14px;word-spacing:-1.08px;}
#tx_1174{left:69px;bottom:542px;letter-spacing:-0.14px;word-spacing:-1.25px;}
#ty_1174{left:69px;bottom:525px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tz_1174{left:69px;bottom:502px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t10_1174{left:69px;bottom:485px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t11_1174{left:69px;bottom:447px;letter-spacing:0.14px;}
#t12_1174{left:69px;bottom:424px;letter-spacing:-0.15px;word-spacing:-0.98px;}
#t13_1174{left:69px;bottom:407px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t14_1174{left:69px;bottom:390px;letter-spacing:-0.15px;word-spacing:-0.47px;}
#t15_1174{left:69px;bottom:367px;letter-spacing:-0.16px;word-spacing:-1.17px;}
#t16_1174{left:69px;bottom:350px;letter-spacing:-0.17px;word-spacing:-0.44px;}
#t17_1174{left:69px;bottom:334px;letter-spacing:-0.18px;word-spacing:-0.54px;}
#t18_1174{left:69px;bottom:317px;letter-spacing:-0.19px;word-spacing:-0.43px;}
#t19_1174{left:69px;bottom:294px;letter-spacing:-0.2px;word-spacing:-0.4px;}
#t1a_1174{left:69px;bottom:277px;letter-spacing:-0.17px;word-spacing:-0.45px;}
#t1b_1174{left:69px;bottom:260px;letter-spacing:-0.18px;word-spacing:-0.45px;}
#t1c_1174{left:69px;bottom:244px;letter-spacing:-0.19px;word-spacing:-0.41px;}
#t1d_1174{left:69px;bottom:227px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t1e_1174{left:69px;bottom:204px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#t1f_1174{left:69px;bottom:187px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#t1g_1174{left:69px;bottom:164px;letter-spacing:-0.16px;word-spacing:-0.45px;}
#t1h_1174{left:69px;bottom:147px;letter-spacing:-0.18px;word-spacing:-0.43px;}

.s1_1174{font-size:12px;font-family:NeoSansIntel_1uk1;color:#000;}
.s2_1174{font-size:14px;font-family:NeoSansIntel_1uk1;color:#0860A8;}
.s3_1174{font-size:14px;font-family:Verdana_3e8;color:#000;}
.s4_1174{font-size:17px;font-family:NeoSansIntelMedium_1uk0;color:#0860A8;}
.s5_1174{font-size:15px;font-family:NeoSansIntelMedium_1uk0;color:#0860A8;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts1174" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_1uk0;
	src: url("fonts/NeoSansIntelMedium_1uk0.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_1uk1;
	src: url("fonts/NeoSansIntel_1uk1.woff") format("woff");
}

@font-face {
	font-family: Verdana_3e8;
	src: url("fonts/Verdana_3e8.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg1174Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg1174" style="-webkit-user-select: none;"><object width="935" height="1210" data="1174/1174.svg" type="image/svg+xml" id="pdf1174" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_1174" class="t s1_1174">33-6 </span><span id="t2_1174" class="t s1_1174">Vol. 3C </span>
<span id="t3_1174" class="t s2_1174">INTELÂ® PROCESSOR TRACE </span>
<span id="t4_1174" class="t s3_1174">CR3 matches IA32_RTIT_CR3_MATCH if the two registers are identical for bits 63:12, or 63:5 when in PAE paging </span>
<span id="t5_1174" class="t s3_1174">mode; the lower 5 bits of CR3 and IA32_RTIT_CR3_MATCH are ignored. CR3 filtering is independent of the value of </span>
<span id="t6_1174" class="t s3_1174">CR0.PG. </span>
<span id="t7_1174" class="t s3_1174">When CR3 filtering is in use, PIP packets may still be seen in the log if the processor is configured to trace when </span>
<span id="t8_1174" class="t s3_1174">CPL = 0 (IA32_RTIT_CTL.OS = 1). If not, no PIP packets will be seen. </span>
<span id="t9_1174" class="t s4_1174">33.2.5.3 </span><span id="ta_1174" class="t s4_1174">Filtering by IP </span>
<span id="tb_1174" class="t s3_1174">Trace packet generation with configurable filtering by IP is supported if CPUID.(EAX=14H, ECX=0):EBX[bit 2] = 1. </span>
<span id="tc_1174" class="t s3_1174">Intel PT can be configured to enable the generation of packets containing architectural states only when the </span>
<span id="td_1174" class="t s3_1174">processor is executing code within certain IP ranges. If the IP is outside of these ranges, generation of some </span>
<span id="te_1174" class="t s3_1174">packets is blocked. </span>
<span id="tf_1174" class="t s3_1174">IP filtering is enabled using the ADDRn_CFG fields in the IA32_RTIT_CTL MSR (Section 33.2.8.2), where the digit </span>
<span id="tg_1174" class="t s3_1174">'n' is a zero-based number that selects which address range is being configured. Each ADDRn_CFG field configures </span>
<span id="th_1174" class="t s3_1174">the use of the register pair IA32_RTIT_ADDRn_A and IA32_RTIT_ADDRn_B (Section 33.2.8.5). IA32_RTIT_AD- </span>
<span id="ti_1174" class="t s3_1174">DRn_A defines the base and IA32_RTIT_ADDRn_B specifies the limit of the range in which tracing is enabled. Thus </span>
<span id="tj_1174" class="t s3_1174">each range, referred to as the ADDRn range, is defined by [IA32_RTIT_ADDRn_A, IA32_RTIT_ADDRn_B]. There </span>
<span id="tk_1174" class="t s3_1174">can be multiple such ranges, software can query CPUID (Section 33.3.1) for the number of ranges supported on a </span>
<span id="tl_1174" class="t s3_1174">processor. </span>
<span id="tm_1174" class="t s3_1174">Default behavior (ADDRn_CFG=0) defines no IP filter range, meaning FilterEn is always set. In this case code at </span>
<span id="tn_1174" class="t s3_1174">any IP can be traced, though other filters, such as CR3 or CPL, could limit tracing. When ADDRn_CFG is set to </span>
<span id="to_1174" class="t s3_1174">enable IP filtering (see Section 33.3.1), tracing will commence when a taken branch or event is seen whose target </span>
<span id="tp_1174" class="t s3_1174">address is in the ADDRn range. </span>
<span id="tq_1174" class="t s3_1174">While inside a tracing region and with FilterEn is set, leaving the tracing region may only be detected once a taken </span>
<span id="tr_1174" class="t s3_1174">branch or event with a target outside the range is retired. If an ADDRn range is entered or exited by executing the </span>
<span id="ts_1174" class="t s3_1174">next sequential instruction, rather than by a control flow transfer, FilterEn may not toggle immediately. See Section </span>
<span id="tt_1174" class="t s3_1174">33.2.6.5 for more details on FilterEn. </span>
<span id="tu_1174" class="t s3_1174">Note that these address range base and limit values are inclusive, such that the range includes the first and last </span>
<span id="tv_1174" class="t s3_1174">instruction whose first instruction byte is in the ADDRn range. </span>
<span id="tw_1174" class="t s3_1174">Depending upon processor implementation, IP filtering may be based on linear or effective address. This can cause </span>
<span id="tx_1174" class="t s3_1174">different behavior between implementations if CSbase is not equal to zero or in real mode. See Section 33.3.1.1 for </span>
<span id="ty_1174" class="t s3_1174">details. Software can query CPUID to determine filters are based on linear or effective address (Section 33.3.1). </span>
<span id="tz_1174" class="t s3_1174">Note that some packets, such as MTC (Section 33.3.7) and other timing packets, do not depend on FilterEn. For </span>
<span id="t10_1174" class="t s3_1174">details on which packets depend on FilterEn, and hence are impacted by IP filtering, see Section 33.4.1. </span>
<span id="t11_1174" class="t s5_1174">TraceStop </span>
<span id="t12_1174" class="t s3_1174">The ADDRn ranges can also be configured to cause tracing to be disabled upon entry to the specified region. This is </span>
<span id="t13_1174" class="t s3_1174">intended for cases where unexpected code is executed, and the user wishes to immediately stop generating </span>
<span id="t14_1174" class="t s3_1174">packets in order to avoid overwriting previously written packets. </span>
<span id="t15_1174" class="t s3_1174">The TraceStop mechanism works much the same way that IP filtering does, and uses the same address comparison </span>
<span id="t16_1174" class="t s3_1174">logic. The TraceStop region base and limit values are programmed into one or more ADDRn ranges, but </span>
<span id="t17_1174" class="t s3_1174">IA32_RTIT_CTL.ADDRn_CFG is configured with the TraceStop encoding. Like FilterEn, TraceStop is detected when </span>
<span id="t18_1174" class="t s3_1174">a taken branch or event lands in a TraceStop region. </span>
<span id="t19_1174" class="t s3_1174">Further, TraceStop requires that TriggerEn=1 at the beginning of the branch/event, and ContextEn=1 upon </span>
<span id="t1a_1174" class="t s3_1174">completion of the branch/event. When this happens, the CPU will set IA32_RTIT_STATUS.Stopped, thereby </span>
<span id="t1b_1174" class="t s3_1174">clearing TriggerEn and hence disabling packet generation. This may generate a TIP.PGD packet with the target IP </span>
<span id="t1c_1174" class="t s3_1174">of the branch or event that entered the TraceStop region. Finally, a TraceStop packet will be inserted, to indicate </span>
<span id="t1d_1174" class="t s3_1174">that the condition was hit. </span>
<span id="t1e_1174" class="t s3_1174">If a TraceStop condition is encountered during buffer overflow (Section 33.3.8), it will not be dropped, but will </span>
<span id="t1f_1174" class="t s3_1174">instead be signaled once the overflow has resolved. </span>
<span id="t1g_1174" class="t s3_1174">Note that a TraceStop event does not guarantee that all internally buffered packets are flushed out of internal </span>
<span id="t1h_1174" class="t s3_1174">buffers. To ensure that this has occurred, the user should clear TraceEn. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
