<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p880" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_880{left:69px;bottom:68px;letter-spacing:0.12px;}
#t2_880{left:110px;bottom:68px;letter-spacing:0.1px;}
#t3_880{left:69px;bottom:1141px;letter-spacing:-0.15px;word-spacing:0.01px;}
#t4_880{left:95px;bottom:1088px;letter-spacing:-0.15px;word-spacing:-0.55px;}
#t5_880{left:95px;bottom:1071px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t6_880{left:95px;bottom:1054px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t7_880{left:95px;bottom:1037px;letter-spacing:-0.14px;word-spacing:-0.49px;}
#t8_880{left:95px;bottom:1020px;letter-spacing:-0.13px;word-spacing:-0.46px;}
#t9_880{left:69px;bottom:994px;}
#ta_880{left:95px;bottom:998px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tb_880{left:95px;bottom:981px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tc_880{left:95px;bottom:964px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#td_880{left:95px;bottom:947px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#te_880{left:95px;bottom:930px;letter-spacing:-0.14px;word-spacing:-0.89px;}
#tf_880{left:95px;bottom:914px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tg_880{left:95px;bottom:897px;letter-spacing:-0.14px;word-spacing:-0.44px;}
#th_880{left:95px;bottom:874px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#ti_880{left:95px;bottom:857px;letter-spacing:-0.14px;word-spacing:-1.24px;}
#tj_880{left:95px;bottom:840px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#tk_880{left:95px;bottom:823px;letter-spacing:-0.14px;word-spacing:-0.52px;}
#tl_880{left:69px;bottom:797px;}
#tm_880{left:95px;bottom:800px;letter-spacing:-0.13px;word-spacing:-0.49px;}
#tn_880{left:95px;bottom:784px;letter-spacing:-0.14px;word-spacing:-1.4px;}
#to_880{left:95px;bottom:767px;letter-spacing:-0.15px;word-spacing:-0.51px;}
#tp_880{left:69px;bottom:740px;}
#tq_880{left:95px;bottom:744px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#tr_880{left:95px;bottom:727px;letter-spacing:-0.17px;word-spacing:-0.45px;}
#ts_880{left:95px;bottom:710px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#tt_880{left:69px;bottom:686px;letter-spacing:-0.14px;word-spacing:-1.3px;}
#tu_880{left:69px;bottom:669px;letter-spacing:-0.15px;word-spacing:-0.45px;}
#tv_880{left:69px;bottom:611px;letter-spacing:0.13px;}
#tw_880{left:151px;bottom:611px;letter-spacing:0.14px;word-spacing:0.01px;}
#tx_880{left:69px;bottom:587px;letter-spacing:-0.2px;word-spacing:-0.86px;}
#ty_880{left:685px;bottom:587px;}
#tz_880{left:694px;bottom:587px;letter-spacing:-0.13px;word-spacing:-0.94px;}
#t10_880{left:69px;bottom:570px;letter-spacing:-0.16px;word-spacing:-0.84px;}
#t11_880{left:69px;bottom:553px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t12_880{left:69px;bottom:529px;letter-spacing:-0.15px;word-spacing:-1.19px;}
#t13_880{left:69px;bottom:512px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t14_880{left:69px;bottom:495px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t15_880{left:69px;bottom:436px;letter-spacing:0.13px;}
#t16_880{left:151px;bottom:436px;letter-spacing:0.15px;word-spacing:0.01px;}
#t17_880{left:69px;bottom:412px;letter-spacing:-0.15px;word-spacing:-0.98px;}
#t18_880{left:69px;bottom:396px;letter-spacing:-0.15px;word-spacing:-0.47px;}
#t19_880{left:69px;bottom:379px;letter-spacing:-0.16px;word-spacing:-0.46px;}
#t1a_880{left:69px;bottom:362px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t1b_880{left:69px;bottom:338px;letter-spacing:-0.14px;word-spacing:-0.64px;}
#t1c_880{left:69px;bottom:321px;letter-spacing:-0.15px;word-spacing:-0.48px;}
#t1d_880{left:69px;bottom:294px;}
#t1e_880{left:95px;bottom:298px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t1f_880{left:69px;bottom:271px;}
#t1g_880{left:95px;bottom:275px;letter-spacing:-0.18px;word-spacing:-0.42px;}
#t1h_880{left:69px;bottom:249px;}
#t1i_880{left:95px;bottom:252px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t1j_880{left:69px;bottom:226px;}
#t1k_880{left:95px;bottom:229px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#t1l_880{left:69px;bottom:205px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t1m_880{left:69px;bottom:188px;letter-spacing:-0.17px;}

.s1_880{font-size:12px;font-family:NeoSansIntel_1uk1;color:#000;}
.s2_880{font-size:14px;font-family:NeoSansIntel_1uk1;color:#0860A8;}
.s3_880{font-size:14px;font-family:Verdana_3e8;color:#000;}
.s4_880{font-size:21px;font-family:TimesNewRoman_3ec;color:#000;}
.s5_880{font-size:18px;font-family:NeoSansIntelMedium_1uk0;color:#0860A8;}
.s6_880{font-size:14px;font-family:Verdana-Italic_3eb;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts880" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_1uk0;
	src: url("fonts/NeoSansIntelMedium_1uk0.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_1uk1;
	src: url("fonts/NeoSansIntel_1uk1.woff") format("woff");
}

@font-face {
	font-family: TimesNewRoman_3ec;
	src: url("fonts/TimesNewRoman_3ec.woff") format("woff");
}

@font-face {
	font-family: Verdana-Italic_3eb;
	src: url("fonts/Verdana-Italic_3eb.woff") format("woff");
}

@font-face {
	font-family: Verdana_3e8;
	src: url("fonts/Verdana_3e8.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg880Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg880" style="-webkit-user-select: none;"><object width="935" height="1210" data="880/880.svg" type="image/svg+xml" id="pdf880" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_880" class="t s1_880">21-10 </span><span id="t2_880" class="t s1_880">Vol. 3B </span>
<span id="t3_880" class="t s2_880">8086 EMULATION </span>
<span id="t4_880" class="t s3_880">exception or hardware interrupt through the protected-mode IDT (normally through an interrupt or trap gate) </span>
<span id="t5_880" class="t s3_880">and the protected-mode exception- and interrupt-handlers. The processor may handle the exception or </span>
<span id="t6_880" class="t s3_880">interrupt within the context of the virtual 8086 task and return to virtual-8086 mode on a return from the </span>
<span id="t7_880" class="t s3_880">handler procedure. The processor may also execute a task switch and handle the exception or interrupt in the </span>
<span id="t8_880" class="t s3_880">context of another task. </span>
<span id="t9_880" class="t s4_880">• </span><span id="ta_880" class="t s3_880">The processor services a software interrupt generated by code executing in the virtual-8086 task (such as a </span>
<span id="tb_880" class="t s3_880">software interrupt to call a MS-DOS* operating system routine). The processor provides several methods of </span>
<span id="tc_880" class="t s3_880">handling these software interrupts, which are discussed in detail in Section 21.3.3, “Class 3—Software </span>
<span id="td_880" class="t s3_880">Interrupt Handling in Virtual-8086 Mode.” Most of them involve the processor entering protected mode, often </span>
<span id="te_880" class="t s3_880">by means of a general-protection (#GP) exception. In protected mode, the processor can send the interrupt to </span>
<span id="tf_880" class="t s3_880">the virtual-8086 monitor for handling and/or redirect the interrupt back to the application program running in </span>
<span id="tg_880" class="t s3_880">virtual-8086 mode task for handling. </span>
<span id="th_880" class="t s3_880">IA-32 processors that incorporate the virtual mode extension (enabled with the VME flag in control register </span>
<span id="ti_880" class="t s3_880">CR4) are capable of redirecting software-generated interrupts back to the program’s interrupt handlers without </span>
<span id="tj_880" class="t s3_880">leaving virtual-8086 mode. See Section 21.3.3.4, “Method 5: Software Interrupt Handling,” for more </span>
<span id="tk_880" class="t s3_880">information on this mechanism. </span>
<span id="tl_880" class="t s4_880">• </span><span id="tm_880" class="t s3_880">A hardware reset initiated by asserting the RESET or INIT pin is a special kind of interrupt. When a RESET or </span>
<span id="tn_880" class="t s3_880">INIT is signaled while the processor is in virtual-8086 mode, the processor leaves virtual-8086 mode and enters </span>
<span id="to_880" class="t s3_880">real-address mode. </span>
<span id="tp_880" class="t s4_880">• </span><span id="tq_880" class="t s3_880">Execution of the HLT instruction in virtual-8086 mode will cause a general-protection (GP#) fault, which the </span>
<span id="tr_880" class="t s3_880">protected-mode handler generally sends to the virtual-8086 monitor. The virtual-8086 monitor then </span>
<span id="ts_880" class="t s3_880">determines the correct execution sequence after verifying that it was entered as a result of a HLT execution. </span>
<span id="tt_880" class="t s3_880">See Section 21.3, “Interrupt and Exception Handling in Virtual-8086 Mode,” for information on leaving virtual-8086 </span>
<span id="tu_880" class="t s3_880">mode to handle an interrupt or exception generated in virtual-8086 mode. </span>
<span id="tv_880" class="t s5_880">21.2.7 </span><span id="tw_880" class="t s5_880">Sensitive Instructions </span>
<span id="tx_880" class="t s3_880">When an IA-32 processor is running in virtual-8086 mode, the CLI, STI, PUSHF, POPF, INT </span><span id="ty_880" class="t s6_880">n</span><span id="tz_880" class="t s3_880">, and IRET instructions </span>
<span id="t10_880" class="t s3_880">are sensitive to IOPL. The IN, INS, OUT, and OUTS instructions, which are sensitive to IOPL in protected mode, are </span>
<span id="t11_880" class="t s3_880">not sensitive in virtual-8086 mode. </span>
<span id="t12_880" class="t s3_880">The CPL is always 3 while running in virtual-8086 mode; if the IOPL is less than 3, an attempt to use the IOPL-sensi- </span>
<span id="t13_880" class="t s3_880">tive instructions listed above triggers a general-protection exception (#GP). These instructions are sensitive to </span>
<span id="t14_880" class="t s3_880">IOPL to give the virtual-8086 monitor a chance to emulate the facilities they affect. </span>
<span id="t15_880" class="t s5_880">21.2.8 </span><span id="t16_880" class="t s5_880">Virtual-8086 Mode I/O </span>
<span id="t17_880" class="t s3_880">Many 8086 programs written for non-multitasking systems directly access I/O ports. This practice may cause prob- </span>
<span id="t18_880" class="t s3_880">lems in a multitasking environment. If more than one program accesses the same port, they may interfere with </span>
<span id="t19_880" class="t s3_880">each other. Most multitasking systems require application programs to access I/O ports through the operating </span>
<span id="t1a_880" class="t s3_880">system. This results in simplified, centralized control. </span>
<span id="t1b_880" class="t s3_880">The processor provides I/O protection for creating I/O that is compatible with the environment and transparent to </span>
<span id="t1c_880" class="t s3_880">8086 programs. Designers may take any of several possible approaches to protecting I/O ports: </span>
<span id="t1d_880" class="t s4_880">• </span><span id="t1e_880" class="t s3_880">Protect the I/O address space and generate exceptions for all attempts to perform I/O directly. </span>
<span id="t1f_880" class="t s4_880">• </span><span id="t1g_880" class="t s3_880">Let the 8086 program perform I/O directly. </span>
<span id="t1h_880" class="t s4_880">• </span><span id="t1i_880" class="t s3_880">Generate exceptions on attempts to access specific I/O ports. </span>
<span id="t1j_880" class="t s4_880">• </span><span id="t1k_880" class="t s3_880">Generate exceptions on attempts to access specific memory-mapped I/O ports. </span>
<span id="t1l_880" class="t s3_880">The method of controlling access to I/O ports depends upon whether they are I/O-port mapped or memory </span>
<span id="t1m_880" class="t s3_880">mapped. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
