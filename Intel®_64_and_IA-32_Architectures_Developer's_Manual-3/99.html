<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p99" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_99{left:789px;bottom:68px;letter-spacing:0.09px;word-spacing:0.01px;}
#t2_99{left:835px;bottom:68px;letter-spacing:0.1px;}
#t3_99{left:599px;bottom:1141px;letter-spacing:-0.15px;}
#t4_99{left:96px;bottom:1088px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t5_99{left:96px;bottom:1071px;letter-spacing:-0.16px;}
#t6_99{left:70px;bottom:1046px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#t7_99{left:70px;bottom:988px;letter-spacing:0.13px;}
#t8_99{left:152px;bottom:988px;letter-spacing:0.15px;}
#t9_99{left:70px;bottom:964px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#ta_99{left:70px;bottom:947px;letter-spacing:-0.15px;word-spacing:-0.43px;}
#tb_99{left:70px;bottom:930px;letter-spacing:-0.14px;word-spacing:-0.54px;}
#tc_99{left:70px;bottom:914px;letter-spacing:-0.14px;word-spacing:-0.49px;}
#td_99{left:70px;bottom:889px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#te_99{left:70px;bottom:872px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tf_99{left:70px;bottom:855px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tg_99{left:70px;bottom:831px;letter-spacing:-0.14px;word-spacing:-0.66px;}
#th_99{left:70px;bottom:814px;letter-spacing:-0.15px;word-spacing:-1.33px;}
#ti_99{left:70px;bottom:797px;letter-spacing:-0.17px;word-spacing:-1.17px;}
#tj_99{left:70px;bottom:781px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#tk_99{left:70px;bottom:756px;letter-spacing:-0.14px;word-spacing:-1.15px;}
#tl_99{left:70px;bottom:739px;letter-spacing:-0.14px;word-spacing:-0.5px;}
#tm_99{left:70px;bottom:723px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#tn_99{left:70px;bottom:706px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#to_99{left:70px;bottom:681px;letter-spacing:-0.15px;word-spacing:-1.37px;}
#tp_99{left:70px;bottom:664px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tq_99{left:70px;bottom:648px;letter-spacing:-0.16px;word-spacing:-1.12px;}
#tr_99{left:70px;bottom:631px;letter-spacing:-0.13px;word-spacing:-0.47px;}
#ts_99{left:70px;bottom:606px;letter-spacing:-0.14px;word-spacing:-0.45px;}
#tt_99{left:70px;bottom:590px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#tu_99{left:70px;bottom:573px;letter-spacing:-0.15px;word-spacing:-0.46px;}
#tv_99{left:70px;bottom:556px;letter-spacing:-0.14px;word-spacing:-0.5px;}
#tw_99{left:70px;bottom:539px;letter-spacing:-0.13px;word-spacing:-0.48px;}
#tx_99{left:70px;bottom:515px;letter-spacing:-0.14px;word-spacing:-0.5px;}
#ty_99{left:70px;bottom:498px;letter-spacing:-0.14px;word-spacing:-0.58px;}
#tz_99{left:70px;bottom:481px;letter-spacing:-0.14px;word-spacing:-0.46px;}
#t10_99{left:70px;bottom:457px;letter-spacing:-0.16px;word-spacing:-0.44px;}
#t11_99{left:70px;bottom:440px;letter-spacing:-0.17px;word-spacing:-0.45px;}
#t12_99{left:70px;bottom:423px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t13_99{left:70px;bottom:406px;letter-spacing:-0.16px;word-spacing:-0.45px;}
#t14_99{left:70px;bottom:348px;letter-spacing:0.12px;}
#t15_99{left:152px;bottom:348px;letter-spacing:0.16px;word-spacing:0.01px;}
#t16_99{left:70px;bottom:324px;letter-spacing:-0.14px;word-spacing:-0.47px;}
#t17_99{left:70px;bottom:307px;letter-spacing:-0.14px;word-spacing:-0.48px;}
#t18_99{left:70px;bottom:290px;letter-spacing:-0.15px;word-spacing:-0.42px;}
#t19_99{left:70px;bottom:273px;letter-spacing:-0.15px;word-spacing:-0.42px;}

.s1_99{font-size:12px;font-family:NeoSansIntel_1uk1;color:#000;}
.s2_99{font-size:14px;font-family:NeoSansIntel_1uk1;color:#0860A8;}
.s3_99{font-size:14px;font-family:Verdana_3e8;color:#000;}
.s4_99{font-size:18px;font-family:NeoSansIntelMedium_1uk0;color:#0860A8;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts99" type="text/css" >

@font-face {
	font-family: NeoSansIntelMedium_1uk0;
	src: url("fonts/NeoSansIntelMedium_1uk0.woff") format("woff");
}

@font-face {
	font-family: NeoSansIntel_1uk1;
	src: url("fonts/NeoSansIntel_1uk1.woff") format("woff");
}

@font-face {
	font-family: Verdana_3e8;
	src: url("fonts/Verdana_3e8.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg99Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg99" style="-webkit-user-select: none;"><object width="935" height="1210" data="99/99.svg" type="image/svg+xml" id="pdf99" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_99" class="t s1_99">Vol. 3A </span><span id="t2_99" class="t s1_99">3-9 </span>
<span id="t3_99" class="t s2_99">PROTECTED-MODE MEMORY MANAGEMENT </span>
<span id="t4_99" class="t s3_99">the contents of the CS register (and sometimes other segment registers) as an incidental part of their </span>
<span id="t5_99" class="t s3_99">operation. </span>
<span id="t6_99" class="t s3_99">The MOV instruction can also be used to store the visible part of a segment register in a general-purpose register. </span>
<span id="t7_99" class="t s4_99">3.4.4 </span><span id="t8_99" class="t s4_99">Segment Loading Instructions in IA-32e Mode </span>
<span id="t9_99" class="t s3_99">Because ES, DS, and SS segment registers are not used in 64-bit mode, their fields (base, limit, and attribute) in </span>
<span id="ta_99" class="t s3_99">segment descriptor registers are ignored. Some forms of segment load instructions are also invalid (for example, </span>
<span id="tb_99" class="t s3_99">LDS, POP ES). Address calculations that reference the ES, DS, or SS segments are treated as if the segment base </span>
<span id="tc_99" class="t s3_99">is zero. </span>
<span id="td_99" class="t s3_99">The processor checks that all linear-address references are in canonical form instead of performing limit checks. </span>
<span id="te_99" class="t s3_99">Mode switching does not change the contents of the segment registers or the associated descriptor registers. </span>
<span id="tf_99" class="t s3_99">These registers are also not changed during 64-bit mode execution, unless explicit segment loads are performed. </span>
<span id="tg_99" class="t s3_99">In order to set up compatibility mode for an application, segment-load instructions (MOV to Sreg, POP Sreg) work </span>
<span id="th_99" class="t s3_99">normally in 64-bit mode. An entry is read from the system descriptor table (GDT or LDT) and is loaded in the hidden </span>
<span id="ti_99" class="t s3_99">portion of the segment register. The descriptor-register base, limit, and attribute fields are all loaded. However, the </span>
<span id="tj_99" class="t s3_99">contents of the data and stack segment selector and the descriptor registers are ignored. </span>
<span id="tk_99" class="t s3_99">When FS and GS segment overrides are used in 64-bit mode, their respective base addresses are used in the linear </span>
<span id="tl_99" class="t s3_99">address calculation: (FS or GS).base + index + displacement. FS.base and GS.base are then expanded to the full </span>
<span id="tm_99" class="t s3_99">linear-address size supported by the implementation. The resulting effective address calculation can wrap across </span>
<span id="tn_99" class="t s3_99">positive and negative addresses; the resulting linear address must be canonical. </span>
<span id="to_99" class="t s3_99">In 64-bit mode, memory accesses using FS-segment and GS-segment overrides are not checked for a runtime limit </span>
<span id="tp_99" class="t s3_99">nor subjected to attribute-checking. Normal segment loads (MOV to Sreg and POP Sreg) into FS and GS load a </span>
<span id="tq_99" class="t s3_99">standard 32-bit base value in the hidden portion of the segment register. The base address bits above the standard </span>
<span id="tr_99" class="t s3_99">32 bits are cleared to 0 to allow consistency for implementations that use less than 64 bits. </span>
<span id="ts_99" class="t s3_99">The hidden descriptor register fields for FS.base and GS.base are physically mapped to MSRs in order to load all </span>
<span id="tt_99" class="t s3_99">address bits supported by a 64-bit implementation. Software with CPL = 0 (privileged software) can load all </span>
<span id="tu_99" class="t s3_99">supported linear-address bits into FS.base or GS.base using WRMSR. Addresses written into the 64-bit FS.base </span>
<span id="tv_99" class="t s3_99">and GS.base registers must be in canonical form. A WRMSR instruction that attempts to write a non-canonical </span>
<span id="tw_99" class="t s3_99">address to those registers causes a #GP fault. </span>
<span id="tx_99" class="t s3_99">When in compatibility mode, FS and GS overrides operate as defined by 32-bit mode behavior regardless of the </span>
<span id="ty_99" class="t s3_99">value loaded into the upper 32 linear-address bits of the hidden descriptor register base field. Compatibility mode </span>
<span id="tz_99" class="t s3_99">ignores the upper 32 bits when calculating an effective address. </span>
<span id="t10_99" class="t s3_99">A new 64-bit mode instruction, SWAPGS, can be used to load GS base. SWAPGS exchanges the kernel data struc- </span>
<span id="t11_99" class="t s3_99">ture pointer from the IA32_KERNEL_GS_BASE MSR with the GS base register. The kernel can then use the GS </span>
<span id="t12_99" class="t s3_99">prefix on normal memory references to access the kernel data structures. An attempt to write a non-canonical </span>
<span id="t13_99" class="t s3_99">value (using WRMSR) to the IA32_KERNEL_GS_BASE MSR causes a #GP fault. </span>
<span id="t14_99" class="t s4_99">3.4.5 </span><span id="t15_99" class="t s4_99">Segment Descriptors </span>
<span id="t16_99" class="t s3_99">A segment descriptor is a data structure in a GDT or LDT that provides the processor with the size and location of </span>
<span id="t17_99" class="t s3_99">a segment, as well as access control and status information. Segment descriptors are typically created by </span>
<span id="t18_99" class="t s3_99">compilers, linkers, loaders, or the operating system or executive, but not application programs. Figure 3-8 illus- </span>
<span id="t19_99" class="t s3_99">trates the general descriptor format for all types of segment descriptors. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
