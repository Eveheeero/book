<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p108" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_108{left:110px;bottom:1129px;letter-spacing:-0.17px;}
#t2_108{left:418px;bottom:1129px;letter-spacing:-0.19px;word-spacing:1.45px;}
#t3_108{left:110px;bottom:1082px;letter-spacing:-0.2px;word-spacing:5.41px;}
#t4_108{left:110px;bottom:1062px;letter-spacing:-0.15px;word-spacing:2.17px;}
#t5_108{left:110px;bottom:1041px;letter-spacing:-0.18px;word-spacing:1.13px;}
#t6_108{left:110px;bottom:1020px;letter-spacing:-0.15px;word-spacing:1.92px;}
#t7_108{left:433px;bottom:1020px;letter-spacing:-0.43px;}
#t8_108{left:469px;bottom:1020px;letter-spacing:-0.14px;word-spacing:1.89px;}
#t9_108{left:110px;bottom:999px;letter-spacing:-0.18px;word-spacing:1.38px;}
#ta_108{left:197px;bottom:999px;letter-spacing:-0.14px;}
#tb_108{left:219px;bottom:999px;letter-spacing:-0.15px;word-spacing:1.38px;}
#tc_108{left:261px;bottom:999px;letter-spacing:-0.11px;}
#td_108{left:278px;bottom:999px;}
#te_108{left:152px;bottom:955px;word-spacing:3.43px;}
#tf_108{left:152px;bottom:937px;letter-spacing:-0.02px;word-spacing:1.89px;}
#tg_108{left:177px;bottom:918px;letter-spacing:0.07px;word-spacing:3.75px;}
#th_108{left:152px;bottom:900px;letter-spacing:-0.08px;word-spacing:3.57px;}
#ti_108{left:526px;bottom:900px;letter-spacing:0.1px;word-spacing:3.21px;}
#tj_108{left:152px;bottom:882px;letter-spacing:-0.04px;word-spacing:1.92px;}
#tk_108{left:110px;bottom:845px;letter-spacing:-0.15px;word-spacing:2.76px;}
#tl_108{left:110px;bottom:825px;letter-spacing:-0.18px;word-spacing:3.65px;}
#tm_108{left:758px;bottom:825px;letter-spacing:-0.13px;word-spacing:3.6px;}
#tn_108{left:110px;bottom:804px;letter-spacing:-0.15px;word-spacing:0.26px;}
#to_108{left:110px;bottom:783px;letter-spacing:-0.18px;word-spacing:2.97px;}
#tp_108{left:110px;bottom:762px;letter-spacing:-0.17px;word-spacing:2.45px;}
#tq_108{left:110px;bottom:742px;letter-spacing:-0.16px;word-spacing:1.4px;}
#tr_108{left:110px;bottom:706px;letter-spacing:-0.15px;word-spacing:2.17px;}
#ts_108{left:110px;bottom:685px;letter-spacing:-0.16px;word-spacing:0.91px;}
#tt_108{left:110px;bottom:664px;letter-spacing:-0.16px;word-spacing:1.54px;}
#tu_108{left:437px;bottom:664px;letter-spacing:-0.18px;word-spacing:4.58px;}
#tv_108{left:582px;bottom:664px;letter-spacing:-0.18px;word-spacing:1.05px;}
#tw_108{left:110px;bottom:644px;letter-spacing:-0.18px;word-spacing:1.46px;}
#tx_108{left:110px;bottom:608px;letter-spacing:-0.17px;word-spacing:3.22px;}
#ty_108{left:110px;bottom:587px;letter-spacing:-0.18px;word-spacing:2.39px;}
#tz_108{left:110px;bottom:566px;letter-spacing:-0.16px;word-spacing:2.65px;}
#t10_108{left:271px;bottom:566px;letter-spacing:-0.17px;word-spacing:4.58px;}
#t11_108{left:411px;bottom:566px;letter-spacing:-0.32px;word-spacing:3.15px;}
#t12_108{left:513px;bottom:566px;letter-spacing:-0.18px;}
#t13_108{left:598px;bottom:566px;letter-spacing:-0.12px;word-spacing:2.6px;}
#t14_108{left:110px;bottom:546px;letter-spacing:-0.32px;word-spacing:1.74px;}
#t15_108{left:211px;bottom:546px;letter-spacing:-0.17px;word-spacing:4.58px;}
#t16_108{left:351px;bottom:546px;}
#t17_108{left:152px;bottom:501px;letter-spacing:0.02px;word-spacing:2px;}
#t18_108{left:152px;bottom:483px;letter-spacing:-0.13px;word-spacing:2.1px;}
#t19_108{left:152px;bottom:438px;letter-spacing:-0.05px;word-spacing:3.66px;}
#t1a_108{left:700px;bottom:438px;letter-spacing:0.1px;word-spacing:3.33px;}
#t1b_108{left:152px;bottom:419px;letter-spacing:0.05px;word-spacing:1.66px;}
#t1c_108{left:152px;bottom:401px;letter-spacing:0.06px;word-spacing:1.71px;}
#t1d_108{left:110px;bottom:364px;letter-spacing:-0.17px;word-spacing:3.14px;}
#t1e_108{left:110px;bottom:344px;letter-spacing:-0.17px;word-spacing:1.95px;}
#t1f_108{left:443px;bottom:344px;letter-spacing:-0.18px;}
#t1g_108{left:487px;bottom:344px;letter-spacing:-0.15px;word-spacing:1.6px;}
#t1h_108{left:110px;bottom:323px;letter-spacing:-0.17px;word-spacing:1.38px;}
#t1i_108{left:110px;bottom:302px;letter-spacing:-0.17px;word-spacing:1.12px;}
#t1j_108{left:616px;bottom:302px;letter-spacing:-0.18px;}
#t1k_108{left:660px;bottom:302px;letter-spacing:-0.16px;word-spacing:0.81px;}
#t1l_108{left:110px;bottom:282px;letter-spacing:-0.17px;word-spacing:1.31px;}
#t1m_108{left:110px;bottom:261px;letter-spacing:-0.16px;word-spacing:2.12px;}
#t1n_108{left:110px;bottom:240px;letter-spacing:-0.14px;word-spacing:1.39px;}

.s1_108{font-size:17px;font-family:CMR10_1fw;color:#000;}
.s2_108{font-size:17px;font-family:CMSL10_1g7;color:#000;}
.s3_108{font-size:17px;font-family:CMTI10_1gf;color:#000;}
.s4_108{font-size:15px;font-family:CMTI10_1gf;color:#000;}
.s5_108{font-size:17px;font-family:CMTT10_1gl;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts108" type="text/css" >

@font-face {
	font-family: CMR10_1fw;
	src: url("fonts/CMR10_1fw.woff") format("woff");
}

@font-face {
	font-family: CMSL10_1g7;
	src: url("fonts/CMSL10_1g7.woff") format("woff");
}

@font-face {
	font-family: CMTI10_1gf;
	src: url("fonts/CMTI10_1gf.woff") format("woff");
}

@font-face {
	font-family: CMTT10_1gl;
	src: url("fonts/CMTT10_1gl.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg108Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg108" style="-webkit-user-select: none;"><object width="935" height="1210" data="108/108.svg" type="image/svg+xml" id="pdf108" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_108" class="t s1_108">94 </span><span id="t2_108" class="t s2_108">Volume II: RISC-V Privileged Architectures V20211203 </span>
<span id="t3_108" class="t s1_108">If the underlying physical memory attribute for a page is main memory, and the page has </span>
<span id="t4_108" class="t s1_108">PBMT=IO, then accesses to that page obey strong channel 0 I/O ordering rules with respect to </span>
<span id="t5_108" class="t s1_108">other accesses to physical main memory and to other accesses to pages with PBMT=IO. However, </span>
<span id="t6_108" class="t s1_108">accesses to such pages are considered to be </span><span id="t7_108" class="t s3_108">both </span><span id="t8_108" class="t s1_108">I/O and main memory accesses for the purposes </span>
<span id="t9_108" class="t s1_108">of FENCE, </span><span id="ta_108" class="t s3_108">.aq</span><span id="tb_108" class="t s1_108">, and </span><span id="tc_108" class="t s3_108">.rl</span><span id="td_108" class="t s1_108">. </span>
<span id="te_108" class="t s4_108">A device driver written to rely on I/O strong ordering rules will not operate correctly if the </span>
<span id="tf_108" class="t s4_108" data-mappings='[[55,"fi"]]'>address range is mapped with PBMT=NC. As such, this conﬁguration is discouraged. </span>
<span id="tg_108" class="t s4_108">It will often still be useful to map physical I/O regions using PBMT=NC so that write </span>
<span id="th_108" class="t s4_108">combining and speculative accesses can be performed. </span><span id="ti_108" class="t s4_108">Such optimizations will likely improve </span>
<span id="tj_108" class="t s4_108">performance when applied with adequate care. </span>
<span id="tk_108" class="t s1_108">When Svpbmt is used with non-zero PBMT encodings, it is possible for multiple virtual aliases </span>
<span id="tl_108" class="t s1_108" data-mappings='[[57,"ff"]]'>of the same physical page to exist simultaneously with diﬀerent memory attributes. </span><span id="tm_108" class="t s1_108">It is also </span>
<span id="tn_108" class="t s1_108" data-mappings='[[87,"ff"]]'>possible for a U-mode or S-mode mapping through a PTE with Svpbmt enabled to observe diﬀerent </span>
<span id="to_108" class="t s1_108">memory attributes for a given region of physical memory than a concurrent access to the same </span>
<span id="tp_108" class="t s1_108">page performed by M-mode or when MODE=Bare. In such cases, the behaviors dictated by the </span>
<span id="tq_108" class="t s1_108" data-mappings='[[55,"ff"]]'>attributes (including coherence, which is otherwise unaﬀected) may be violated. </span>
<span id="tr_108" class="t s1_108" data-mappings='[[36,"ff"]]'>Accessing the same location using diﬀerent attributes that are both non-cacheable (e.g., NC and </span>
<span id="ts_108" class="t s1_108">IO) does not cause loss of coherence, but might result in weaker memory ordering than the stricter </span>
<span id="tt_108" class="t s1_108">attribute ordinarily guarantees. Executing a </span><span id="tu_108" class="t s5_108">fence iorw, iorw </span><span id="tv_108" class="t s1_108">instruction between such accesses </span>
<span id="tw_108" class="t s1_108" data-mappings='[[2,"ffi"]]'>suﬃces to prevent loss of memory ordering. </span>
<span id="tx_108" class="t s1_108" data-mappings='[[36,"ff"]]'>Accessing the same location using diﬀerent cacheability attributes may cause loss of coherence. </span>
<span id="ty_108" class="t s1_108">Executing the following sequence between such accesses prevents both loss of coherence and loss </span>
<span id="tz_108" class="t s1_108">of memory ordering: </span><span id="t10_108" class="t s5_108">fence iorw, iorw</span><span id="t11_108" class="t s1_108">, followed by </span><span id="t12_108" class="t s5_108">cbo.flush </span><span id="t13_108" class="t s1_108">to an address of that location, </span>
<span id="t14_108" class="t s1_108">followed by a </span><span id="t15_108" class="t s5_108">fence iorw, iorw</span><span id="t16_108" class="t s1_108">. </span>
<span id="t17_108" class="t s4_108">It follows that, if the same location might later be referenced using the original attributes, then </span>
<span id="t18_108" class="t s4_108">this sequence must be repeated beforehand. </span>
<span id="t19_108" class="t s4_108" data-mappings='[[44,"ffi"]]'>In certain cases, a weaker sequence might suﬃce to prevent loss of coherence. </span><span id="t1a_108" class="t s4_108">These situa- </span>
<span id="t1b_108" class="t s4_108">tions will be detailed following the forthcoming formalization of the interaction of the RVWMO </span>
<span id="t1c_108" class="t s4_108">memory model with the instructions in the Zicbom extension. </span>
<span id="t1d_108" class="t s1_108">When two-stage address translation is enabled within the H extension, the page-based memory </span>
<span id="t1e_108" class="t s1_108">types are also applied in two stages. First, if </span><span id="t1f_108" class="t s5_108">hgatp</span><span id="t1g_108" class="t s1_108">.MODE is not equal to zero, non-zero G-stage </span>
<span id="t1h_108" class="t s1_108">PTE PBMT bits override the attributes in the PMA to produce an intermediate set of attributes. </span>
<span id="t1i_108" class="t s1_108">Otherwise, the PMAs serve as the intermediate attributes. Second, if </span><span id="t1j_108" class="t s5_108">vsatp</span><span id="t1k_108" class="t s1_108">.MODE is not equal to </span>
<span id="t1l_108" class="t s1_108" data-mappings='[[90,"fi"]]'>zero, non-zero VS-stage PTE PBMT bits override the intermediate attributes to produce the ﬁnal </span>
<span id="t1m_108" class="t s1_108">set of attributes used by accesses to the page in question. Otherwise, the intermediate attributes </span>
<span id="t1n_108" class="t s1_108" data-mappings='[[16,"fi"]]'>are used as the ﬁnal set of attributes. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
