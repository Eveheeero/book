<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p39" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_39{left:110px;bottom:1129px;letter-spacing:-0.19px;word-spacing:1.45px;}
#t2_39{left:808px;bottom:1129px;letter-spacing:-0.17px;}
#t3_39{left:152px;bottom:1065px;letter-spacing:0.04px;word-spacing:0.77px;}
#t4_39{left:152px;bottom:1046px;letter-spacing:0.03px;word-spacing:1.96px;}
#t5_39{left:152px;bottom:1028px;letter-spacing:-0.06px;word-spacing:1.96px;}
#t6_39{left:177px;bottom:1010px;letter-spacing:-0.17px;}
#t7_39{left:243px;bottom:1010px;letter-spacing:0.12px;}
#t8_39{left:282px;bottom:1010px;letter-spacing:0.03px;word-spacing:3.35px;}
#t9_39{left:152px;bottom:992px;word-spacing:1.83px;}
#ta_39{left:110px;bottom:955px;letter-spacing:-0.24px;word-spacing:0.97px;}
#tb_39{left:353px;bottom:955px;letter-spacing:-1px;}
#tc_39{left:416px;bottom:955px;letter-spacing:-0.15px;word-spacing:0.81px;}
#td_39{left:110px;bottom:934px;letter-spacing:-0.15px;}
#te_39{left:170px;bottom:934px;letter-spacing:-0.14px;}
#tf_39{left:204px;bottom:934px;letter-spacing:-0.11px;}
#tg_39{left:228px;bottom:934px;letter-spacing:-0.19px;word-spacing:3.21px;}
#th_39{left:110px;bottom:914px;letter-spacing:-0.17px;word-spacing:1.51px;}
#ti_39{left:110px;bottom:893px;letter-spacing:-0.13px;word-spacing:2.04px;}
#tj_39{left:110px;bottom:872px;letter-spacing:-0.17px;word-spacing:1.77px;}
#tk_39{left:110px;bottom:851px;letter-spacing:-0.16px;word-spacing:2.37px;}
#tl_39{left:110px;bottom:831px;letter-spacing:-0.14px;word-spacing:1.37px;}
#tm_39{left:152px;bottom:786px;letter-spacing:0.04px;word-spacing:4.07px;}
#tn_39{left:152px;bottom:768px;letter-spacing:0.12px;word-spacing:1.59px;}
#to_39{left:110px;bottom:731px;letter-spacing:-0.15px;word-spacing:1.34px;}
#tp_39{left:110px;bottom:711px;letter-spacing:-0.14px;word-spacing:1.58px;}
#tq_39{left:110px;bottom:690px;letter-spacing:-0.14px;word-spacing:1.25px;}
#tr_39{left:110px;bottom:669px;letter-spacing:-0.19px;word-spacing:1.46px;}
#ts_39{left:110px;bottom:633px;letter-spacing:-0.26px;word-spacing:2.1px;}
#tt_39{left:347px;bottom:633px;letter-spacing:-1px;}
#tu_39{left:412px;bottom:633px;letter-spacing:-0.14px;word-spacing:1.9px;}
#tv_39{left:110px;bottom:613px;letter-spacing:-0.16px;word-spacing:2.5px;}
#tw_39{left:110px;bottom:592px;letter-spacing:-0.13px;word-spacing:2.62px;}
#tx_39{left:110px;bottom:571px;letter-spacing:-0.12px;word-spacing:1.33px;}
#ty_39{left:152px;bottom:527px;letter-spacing:0.01px;word-spacing:1.57px;}
#tz_39{left:673px;bottom:527px;}
#t10_39{left:681px;bottom:527px;letter-spacing:0.11px;word-spacing:1.38px;}
#t11_39{left:152px;bottom:508px;letter-spacing:0.05px;word-spacing:1.72px;}
#t12_39{left:110px;bottom:448px;letter-spacing:-0.16px;}
#t13_39{left:183px;bottom:448px;letter-spacing:-0.2px;word-spacing:2.28px;}
#t14_39{left:428px;bottom:448px;letter-spacing:-0.18px;}
#t15_39{left:496px;bottom:448px;letter-spacing:-0.17px;}
#t16_39{left:110px;bottom:402px;letter-spacing:-0.16px;word-spacing:2.5px;}
#t17_39{left:110px;bottom:381px;letter-spacing:-0.15px;word-spacing:1.2px;}
#t18_39{left:110px;bottom:360px;letter-spacing:-0.12px;word-spacing:1.34px;}
#t19_39{left:152px;bottom:316px;letter-spacing:0.05px;word-spacing:1.6px;}
#t1a_39{left:152px;bottom:298px;letter-spacing:-0.01px;word-spacing:1.86px;}
#t1b_39{left:110px;bottom:261px;letter-spacing:-0.15px;word-spacing:1.55px;}
#t1c_39{left:291px;bottom:261px;letter-spacing:-1px;}
#t1d_39{left:355px;bottom:261px;letter-spacing:-0.15px;word-spacing:1.55px;}
#t1e_39{left:110px;bottom:240px;letter-spacing:-0.19px;word-spacing:1.33px;}
#t1f_39{left:110px;bottom:220px;letter-spacing:-0.16px;word-spacing:1.71px;}
#t1g_39{left:110px;bottom:199px;letter-spacing:-0.14px;word-spacing:0.79px;}
#t1h_39{left:458px;bottom:199px;letter-spacing:-0.18px;}
#t1i_39{left:475px;bottom:199px;}
#t1j_39{left:483px;bottom:199px;letter-spacing:-0.18px;}
#t1k_39{left:515px;bottom:199px;letter-spacing:-0.17px;word-spacing:0.77px;}
#t1l_39{left:620px;bottom:199px;letter-spacing:-0.18px;}
#t1m_39{left:655px;bottom:199px;}
#t1n_39{left:664px;bottom:199px;letter-spacing:-0.18px;}
#t1o_39{left:691px;bottom:199px;letter-spacing:-0.15px;word-spacing:0.88px;}
#t1p_39{left:732px;bottom:199px;letter-spacing:-0.18px;}
#t1q_39{left:784px;bottom:199px;letter-spacing:-0.16px;word-spacing:3.03px;}
#t1r_39{left:110px;bottom:178px;letter-spacing:-0.15px;word-spacing:0.98px;}
#t1s_39{left:741px;bottom:178px;letter-spacing:-0.18px;}
#t1t_39{left:758px;bottom:178px;}
#t1u_39{left:767px;bottom:178px;letter-spacing:-0.17px;}
#t1v_39{left:798px;bottom:178px;letter-spacing:-0.18px;}
#t1w_39{left:110px;bottom:157px;letter-spacing:-0.18px;word-spacing:2.07px;}
#t1x_39{left:186px;bottom:157px;letter-spacing:-0.17px;}
#t1y_39{left:221px;bottom:157px;}
#t1z_39{left:232px;bottom:157px;letter-spacing:-0.17px;}
#t20_39{left:267px;bottom:157px;}
#t21_39{left:278px;bottom:157px;letter-spacing:-0.17px;}
#t22_39{left:322px;bottom:157px;}
#t23_39{left:333px;bottom:157px;letter-spacing:-0.17px;}
#t24_39{left:385px;bottom:157px;}
#t25_39{left:396px;bottom:157px;letter-spacing:-0.18px;}
#t26_39{left:414px;bottom:157px;}
#t27_39{left:425px;bottom:157px;letter-spacing:-0.18px;}
#t28_39{left:468px;bottom:157px;letter-spacing:-0.15px;word-spacing:2.23px;}
#t29_39{left:512px;bottom:157px;letter-spacing:-0.18px;}
#t2a_39{left:556px;bottom:157px;letter-spacing:-0.13px;word-spacing:2.47px;}
#t2b_39{left:110px;bottom:137px;letter-spacing:-0.13px;word-spacing:2.72px;}
#t2c_39{left:519px;bottom:137px;letter-spacing:-0.23px;word-spacing:2.92px;}

.s1_39{font-size:17px;font-family:CMSL10_1g7;color:#000;}
.s2_39{font-size:17px;font-family:CMR10_1fw;color:#000;}
.s3_39{font-size:15px;font-family:CMTI10_1gf;color:#000;}
.s4_39{font-size:15px;font-family:CMTT10_1gl;color:#000;}
.s5_39{font-size:17px;font-family:CMBX10_1fg;color:#000;}
.s6_39{font-size:17px;font-family:CMR10_1fw;color:#000080;}
.s7_39{font-size:15px;font-family:CMTI10_1gf;color:#000080;}
.s8_39{font-size:17px;font-family:CMTT10_1gl;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts39" type="text/css" >

@font-face {
	font-family: CMBX10_1fg;
	src: url("fonts/CMBX10_1fg.woff") format("woff");
}

@font-face {
	font-family: CMR10_1fw;
	src: url("fonts/CMR10_1fw.woff") format("woff");
}

@font-face {
	font-family: CMSL10_1g7;
	src: url("fonts/CMSL10_1g7.woff") format("woff");
}

@font-face {
	font-family: CMTI10_1gf;
	src: url("fonts/CMTI10_1gf.woff") format("woff");
}

@font-face {
	font-family: CMTT10_1gl;
	src: url("fonts/CMTT10_1gl.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg39Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg39" style="-webkit-user-select: none;"><object width="935" height="1210" data="39/39.svg" type="image/svg+xml" id="pdf39" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_39" class="t s1_39">Volume II: RISC-V Privileged Architectures V20211203 </span><span id="t2_39" class="t s2_39">25 </span>
<span id="t3_39" class="t s3_39" data-mappings='[[43,"ffi"]]'>The TVM mechanism improves virtualization eﬃciency by permitting guest operating systems to </span>
<span id="t4_39" class="t s3_39">execute in S-mode, rather than classically virtualizing them in U-mode. This approach obviates </span>
<span id="t5_39" class="t s3_39">the need to trap accesses to most S-mode CSRs. </span>
<span id="t6_39" class="t s3_39">Trapping </span><span id="t7_39" class="t s4_39">satp </span><span id="t8_39" class="t s3_39">accesses and the SFENCE.VMA and SINVAL.VMA instructions provides </span>
<span id="t9_39" class="t s3_39">the hooks necessary to lazily populate shadow page tables. </span>
<span id="ta_39" class="t s2_39">The TW (Timeout Wait) bit is a </span><span id="tb_39" class="t s5_39">WARL </span><span id="tc_39" class="t s2_39" data-mappings='[[0,"fi"]]'>ﬁeld that supports intercepting the WFI instruction (see </span>
<span id="td_39" class="t s2_39">Section </span><span id="te_39" class="t s6_39">3.3.3</span><span id="tf_39" class="t s2_39">). </span><span id="tg_39" class="t s2_39">When TW=0, the WFI instruction may execute in lower privilege modes when </span>
<span id="th_39" class="t s2_39">not prevented for some other reason. When TW=1, then if WFI is executed in any less-privileged </span>
<span id="ti_39" class="t s2_39" data-mappings='[[61,"fi"]]'>mode, and it does not complete within an implementation-speciﬁc, bounded time limit, the WFI </span>
<span id="tj_39" class="t s2_39">instruction causes an illegal instruction exception. The time limit may always be 0, in which case </span>
<span id="tk_39" class="t s2_39">WFI always causes an illegal instruction exception in less-privileged modes when TW=1. TW is </span>
<span id="tl_39" class="t s2_39">read-only 0 when there are no modes less privileged than M. </span>
<span id="tm_39" class="t s3_39">Trapping the WFI instruction can trigger a world switch to another guest OS, rather than </span>
<span id="tn_39" class="t s3_39">wastefully idling in the current guest. </span>
<span id="to_39" class="t s2_39">When S-mode is implemented, then executing WFI in U-mode causes an illegal instruction excep- </span>
<span id="tp_39" class="t s2_39" data-mappings='[[56,"fi"]]'>tion, unless it completes within an implementation-speciﬁc, bounded time limit. A future revision </span>
<span id="tq_39" class="t s2_39" data-mappings='[[13,"fi"]]'>of this speciﬁcation might add a feature that allows S-mode to selectively permit WFI in U-mode. </span>
<span id="tr_39" class="t s2_39">Such a feature would only be active when TW=0. </span>
<span id="ts_39" class="t s2_39">The TSR (Trap SRET) bit is a </span><span id="tt_39" class="t s5_39">WARL </span><span id="tu_39" class="t s2_39" data-mappings='[[0,"fi"]]'>ﬁeld that supports intercepting the supervisor exception </span>
<span id="tv_39" class="t s2_39">return instruction, SRET. When TSR=1, attempts to execute SRET while executing in S-mode </span>
<span id="tw_39" class="t s2_39">will raise an illegal instruction exception. When TSR=0, this operation is permitted in S-mode. </span>
<span id="tx_39" class="t s2_39">TSR is read-only 0 when S-mode is not supported. </span>
<span id="ty_39" class="t s3_39">Trapping SRET is necessary to emulate the hypervisor extension (see Chapter </span><span id="tz_39" class="t s7_39">8</span><span id="t10_39" class="t s3_39">) on implemen- </span>
<span id="t11_39" class="t s3_39">tations that do not provide it. </span>
<span id="t12_39" class="t s5_39">3.1.6.6 </span><span id="t13_39" class="t s5_39">Extension Context Status in </span><span id="t14_39" class="t s8_39">mstatus </span><span id="t15_39" class="t s5_39">Register </span>
<span id="t16_39" class="t s2_39" data-mappings='[[88,"fi"]]'>Supporting substantial extensions is one of the primary goals of RISC-V, and hence we deﬁne a </span>
<span id="t17_39" class="t s2_39">standard interface to allow unchanged privileged-mode code, particularly a supervisor-level OS, to </span>
<span id="t18_39" class="t s2_39">support arbitrary user-mode state extensions. </span>
<span id="t19_39" class="t s3_39" data-mappings='[[63,"fi"]]'>To date, the V extension is the only standard extension that deﬁnes additional state beyond the </span>
<span id="t1a_39" class="t s3_39" data-mappings='[[0,"fl"]]'>ﬂoating-point CSR and data registers. </span>
<span id="t1b_39" class="t s2_39">The FS[1:0] and VS[1:0] </span><span id="t1c_39" class="t s5_39">WARL </span><span id="t1d_39" class="t s2_39" data-mappings='[[0,"fi"],[32,"fi"]]'>ﬁelds and the XS[1:0] read-only ﬁeld are used to reduce the cost </span>
<span id="t1e_39" class="t s2_39" data-mappings='[[77,"fl"]]'>of context save and restore by setting and tracking the current state of the ﬂoating-point unit and </span>
<span id="t1f_39" class="t s2_39" data-mappings='[[52,"fi"],[83,"fl"]]'>any other user-mode extensions respectively. The FS ﬁeld encodes the status of the ﬂoating-point </span>
<span id="t1g_39" class="t s2_39" data-mappings='[[26,"fl"]]'>unit state, including the ﬂoating-point registers </span><span id="t1h_39" class="t s8_39">f0</span><span id="t1i_39" class="t s2_39">–</span><span id="t1j_39" class="t s8_39">f31 </span><span id="t1k_39" class="t s2_39">and the CSRs </span><span id="t1l_39" class="t s8_39">fcsr</span><span id="t1m_39" class="t s2_39">, </span><span id="t1n_39" class="t s8_39">frm</span><span id="t1o_39" class="t s2_39">, and </span><span id="t1p_39" class="t s8_39">fflags</span><span id="t1q_39" class="t s2_39">. The </span>
<span id="t1r_39" class="t s2_39" data-mappings='[[3,"fi"]]'>VS ﬁeld encodes the status of the vector extension state, including the vector registers </span><span id="t1s_39" class="t s8_39">v0</span><span id="t1t_39" class="t s2_39">–</span><span id="t1u_39" class="t s8_39">v31 </span><span id="t1v_39" class="t s2_39">and </span>
<span id="t1w_39" class="t s2_39">the CSRs </span><span id="t1x_39" class="t s8_39">vcsr</span><span id="t1y_39" class="t s2_39">, </span><span id="t1z_39" class="t s8_39">vxrm</span><span id="t20_39" class="t s2_39">, </span><span id="t21_39" class="t s8_39">vxsat</span><span id="t22_39" class="t s2_39">, </span><span id="t23_39" class="t s8_39">vstart</span><span id="t24_39" class="t s2_39">, </span><span id="t25_39" class="t s8_39">vl</span><span id="t26_39" class="t s2_39">, </span><span id="t27_39" class="t s8_39">vtype</span><span id="t28_39" class="t s2_39">, and </span><span id="t29_39" class="t s8_39">vlenb</span><span id="t2a_39" class="t s2_39" data-mappings='[[9,"fi"]]'>. The XS ﬁeld encodes the status of </span>
<span id="t2b_39" class="t s2_39">additional user-mode extensions and associated state. </span><span id="t2c_39" class="t s2_39" data-mappings='[[6,"fi"]]'>These ﬁelds can be checked by a context </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
