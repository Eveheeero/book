<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p150" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_150{left:110px;bottom:1129px;letter-spacing:-0.17px;}
#t2_150{left:418px;bottom:1129px;letter-spacing:-0.19px;word-spacing:1.45px;}
#t3_150{left:110px;bottom:1082px;letter-spacing:0.12px;}
#t4_150{left:173px;bottom:1082px;letter-spacing:-0.07px;word-spacing:2.71px;}
#t5_150{left:110px;bottom:1036px;letter-spacing:-0.17px;word-spacing:1.74px;}
#t6_150{left:110px;bottom:1015px;letter-spacing:-0.16px;word-spacing:3.13px;}
#t7_150{left:742px;bottom:1015px;letter-spacing:-0.17px;}
#t8_150{left:810px;bottom:1015px;letter-spacing:-0.15px;}
#t9_150{left:110px;bottom:994px;letter-spacing:-0.17px;}
#ta_150{left:180px;bottom:994px;letter-spacing:-0.23px;word-spacing:3.4px;}
#tb_150{left:349px;bottom:994px;letter-spacing:-0.14px;}
#tc_150{left:371px;bottom:994px;}
#td_150{left:388px;bottom:994px;letter-spacing:-0.19px;word-spacing:3.13px;}
#te_150{left:507px;bottom:994px;letter-spacing:-0.18px;}
#tf_150{left:568px;bottom:994px;}
#tg_150{left:577px;bottom:994px;letter-spacing:-0.18px;}
#th_150{left:654px;bottom:994px;letter-spacing:-0.19px;word-spacing:3.35px;}
#ti_150{left:110px;bottom:973px;letter-spacing:-0.18px;word-spacing:1.81px;}
#tj_150{left:110px;bottom:953px;letter-spacing:-0.14px;}
#tk_150{left:143px;bottom:953px;letter-spacing:-0.17px;}
#tl_150{left:160px;bottom:953px;}
#tm_150{left:173px;bottom:953px;letter-spacing:-0.17px;}
#tn_150{left:208px;bottom:953px;}
#to_150{left:110px;bottom:917px;letter-spacing:-0.15px;word-spacing:1.04px;}
#tp_150{left:110px;bottom:896px;letter-spacing:-0.13px;word-spacing:1.36px;}
#tq_150{left:110px;bottom:860px;letter-spacing:-0.14px;word-spacing:1.05px;}
#tr_150{left:110px;bottom:840px;letter-spacing:-0.15px;word-spacing:1.6px;}
#ts_150{left:404px;bottom:840px;letter-spacing:-0.18px;}
#tt_150{left:465px;bottom:840px;letter-spacing:-0.18px;word-spacing:1.6px;}
#tu_150{left:541px;bottom:840px;letter-spacing:-0.18px;}
#tv_150{left:603px;bottom:840px;letter-spacing:-0.3px;word-spacing:1.89px;}
#tw_150{left:799px;bottom:840px;letter-spacing:-0.14px;}
#tx_150{left:820px;bottom:840px;}
#ty_150{left:110px;bottom:819px;letter-spacing:-0.16px;word-spacing:2px;}
#tz_150{left:233px;bottom:819px;letter-spacing:-0.17px;}
#t10_150{left:294px;bottom:819px;letter-spacing:-0.17px;word-spacing:2.08px;}
#t11_150{left:417px;bottom:819px;letter-spacing:-0.18px;}
#t12_150{left:485px;bottom:819px;letter-spacing:-0.21px;word-spacing:2.74px;}
#t13_150{left:110px;bottom:798px;letter-spacing:-0.14px;word-spacing:1.37px;}
#t14_150{left:591px;bottom:798px;letter-spacing:-0.18px;}
#t15_150{left:608px;bottom:798px;}
#t16_150{left:621px;bottom:798px;letter-spacing:-0.18px;}
#t17_150{left:656px;bottom:798px;}
#t18_150{left:110px;bottom:762px;letter-spacing:-0.16px;word-spacing:1.31px;}
#t19_150{left:771px;bottom:762px;letter-spacing:-0.15px;}
#t1a_150{left:801px;bottom:762px;letter-spacing:-0.12px;word-spacing:1.3px;}
#t1b_150{left:110px;bottom:741px;letter-spacing:-0.17px;}
#t1c_150{left:186px;bottom:741px;letter-spacing:-0.16px;word-spacing:1.39px;}
#t1d_150{left:581px;bottom:741px;letter-spacing:-0.18px;}
#t1e_150{left:599px;bottom:741px;}
#t1f_150{left:612px;bottom:741px;letter-spacing:-0.18px;}
#t1g_150{left:655px;bottom:741px;}

.s1_150{font-size:17px;font-family:CMR10_1fw;color:#000;}
.s2_150{font-size:17px;font-family:CMSL10_1g7;color:#000;}
.s3_150{font-size:18px;font-family:CMBX12_1fi;color:#000;}
.s4_150{font-size:17px;font-family:CMTT10_1gl;color:#000;}
.s5_150{font-size:17px;font-family:CMR10_1fw;color:#000080;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts150" type="text/css" >

@font-face {
	font-family: CMBX12_1fi;
	src: url("fonts/CMBX12_1fi.woff") format("woff");
}

@font-face {
	font-family: CMR10_1fw;
	src: url("fonts/CMR10_1fw.woff") format("woff");
}

@font-face {
	font-family: CMSL10_1g7;
	src: url("fonts/CMSL10_1g7.woff") format("woff");
}

@font-face {
	font-family: CMTT10_1gl;
	src: url("fonts/CMTT10_1gl.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg150Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg150" style="-webkit-user-select: none;"><object width="935" height="1210" data="150/150.svg" type="image/svg+xml" id="pdf150" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_150" class="t s1_150">136 </span><span id="t2_150" class="t s2_150">Volume II: RISC-V Privileged Architectures V20211203 </span>
<span id="t3_150" class="t s3_150">8.6.4 </span><span id="t4_150" class="t s3_150">Trap Return </span>
<span id="t5_150" class="t s1_150" data-mappings='[[75,"fi"]]'>The MRET instruction is used to return from a trap taken into M-mode. MRET ﬁrst determines </span>
<span id="t6_150" class="t s1_150">what the new privilege mode will be according to the values of MPP and MPV in </span><span id="t7_150" class="t s4_150">mstatus </span><span id="t8_150" class="t s1_150">or </span>
<span id="t9_150" class="t s4_150">mstatush</span><span id="ta_150" class="t s1_150">, as encoded in Table </span><span id="tb_150" class="t s5_150">8.8</span><span id="tc_150" class="t s1_150">. </span><span id="td_150" class="t s1_150">MRET then in </span><span id="te_150" class="t s4_150">mstatus</span><span id="tf_150" class="t s1_150">/</span><span id="tg_150" class="t s4_150">mstatush </span><span id="th_150" class="t s1_150">sets MPV=0, MPP=0, </span>
<span id="ti_150" class="t s1_150">MIE=MPIE, and MPIE=1. Lastly, MRET sets the privilege mode as previously determined, and </span>
<span id="tj_150" class="t s1_150">sets </span><span id="tk_150" class="t s4_150">pc</span><span id="tl_150" class="t s1_150">=</span><span id="tm_150" class="t s4_150">mepc</span><span id="tn_150" class="t s1_150">. </span>
<span id="to_150" class="t s1_150">The SRET instruction is used to return from a trap taken into HS-mode or VS-mode. Its behavior </span>
<span id="tp_150" class="t s1_150">depends on the current virtualization mode. </span>
<span id="tq_150" class="t s1_150" data-mappings='[[53,"fi"]]'>When executed in M-mode or HS-mode (i.e., V=0), SRET ﬁrst determines what the new privilege </span>
<span id="tr_150" class="t s1_150">mode will be according to the values in </span><span id="ts_150" class="t s4_150">hstatus</span><span id="tt_150" class="t s1_150">.SPV and </span><span id="tu_150" class="t s4_150">sstatus</span><span id="tv_150" class="t s1_150">.SPP, as encoded in Table </span><span id="tw_150" class="t s5_150">8.9</span><span id="tx_150" class="t s1_150">. </span>
<span id="ty_150" class="t s1_150">SRET then sets </span><span id="tz_150" class="t s4_150">hstatus</span><span id="t10_150" class="t s1_150">.SPV=0, and in </span><span id="t11_150" class="t s4_150">sstatus </span><span id="t12_150" class="t s1_150">sets SPP=0, SIE=SPIE, and SPIE=1. Lastly, </span>
<span id="t13_150" class="t s1_150">SRET sets the privilege mode as previously determined, and sets </span><span id="t14_150" class="t s4_150">pc</span><span id="t15_150" class="t s1_150">=</span><span id="t16_150" class="t s4_150">sepc</span><span id="t17_150" class="t s1_150">. </span>
<span id="t18_150" class="t s1_150">When executed in VS-mode (i.e., V=1), SRET sets the privilege mode according to Table </span><span id="t19_150" class="t s5_150">8.10</span><span id="t1a_150" class="t s1_150">, in </span>
<span id="t1b_150" class="t s4_150">vsstatus </span><span id="t1c_150" class="t s1_150">sets SPP=0, SIE=SPIE, and SPIE=1, and lastly sets </span><span id="t1d_150" class="t s4_150">pc</span><span id="t1e_150" class="t s1_150">=</span><span id="t1f_150" class="t s4_150">vsepc</span><span id="t1g_150" class="t s1_150">. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
