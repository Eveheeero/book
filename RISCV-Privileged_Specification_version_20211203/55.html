<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p55" style="overflow: hidden; position: relative; background-color: white; width: 935px; height: 1210px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_55{left:110px;bottom:1129px;letter-spacing:-0.19px;word-spacing:1.45px;}
#t2_55{left:808px;bottom:1129px;letter-spacing:-0.17px;}
#t3_55{left:110px;bottom:1082px;letter-spacing:0.13px;}
#t4_55{left:183px;bottom:1082px;letter-spacing:-0.06px;word-spacing:2.68px;}
#t5_55{left:462px;bottom:1082px;letter-spacing:0.14px;}
#t6_55{left:509px;bottom:1082px;}
#t7_55{left:110px;bottom:1036px;letter-spacing:-0.19px;}
#t8_55{left:143px;bottom:1036px;letter-spacing:-0.17px;}
#t9_55{left:191px;bottom:1036px;letter-spacing:-0.16px;word-spacing:0.04px;}
#ta_55{left:728px;bottom:1036px;letter-spacing:-0.15px;}
#tb_55{left:758px;bottom:1036px;letter-spacing:-0.17px;word-spacing:1.4px;}
#tc_55{left:110px;bottom:1015px;letter-spacing:-0.17px;word-spacing:0.33px;}
#td_55{left:307px;bottom:1015px;letter-spacing:-0.17px;}
#te_55{left:355px;bottom:1015px;letter-spacing:-0.13px;word-spacing:0.26px;}
#tf_55{left:110px;bottom:994px;letter-spacing:-0.17px;word-spacing:1.93px;}
#tg_55{left:485px;bottom:994px;letter-spacing:-0.18px;}
#th_55{left:535px;bottom:994px;letter-spacing:-0.2px;word-spacing:1.67px;}
#ti_55{left:110px;bottom:973px;letter-spacing:-0.18px;word-spacing:1.73px;}
#tj_55{left:110px;bottom:953px;letter-spacing:-0.2px;word-spacing:1.73px;}
#tk_55{left:219px;bottom:953px;letter-spacing:-0.17px;}
#tl_55{left:268px;bottom:953px;letter-spacing:-0.18px;word-spacing:1.91px;}
#tm_55{left:110px;bottom:932px;letter-spacing:-0.13px;word-spacing:1.35px;}
#tn_55{left:409px;bottom:932px;letter-spacing:-0.18px;}
#to_55{left:458px;bottom:932px;letter-spacing:-0.21px;word-spacing:1.52px;}
#tp_55{left:640px;bottom:932px;letter-spacing:-0.18px;}
#tq_55{left:690px;bottom:932px;letter-spacing:-0.14px;word-spacing:1.39px;}
#tr_55{left:110px;bottom:896px;letter-spacing:-0.11px;}
#ts_55{left:128px;bottom:896px;letter-spacing:-0.17px;}
#tt_55{left:178px;bottom:896px;letter-spacing:-0.16px;word-spacing:2.68px;}
#tu_55{left:110px;bottom:875px;letter-spacing:-0.15px;word-spacing:3.38px;}
#tv_55{left:657px;bottom:875px;letter-spacing:-0.18px;}
#tw_55{left:708px;bottom:875px;letter-spacing:-0.19px;word-spacing:3.33px;}
#tx_55{left:110px;bottom:855px;letter-spacing:-0.14px;word-spacing:1.38px;}
#ty_55{left:152px;bottom:810px;word-spacing:2.04px;}
#tz_55{left:453px;bottom:810px;letter-spacing:0.12px;}
#t10_55{left:498px;bottom:810px;letter-spacing:0.07px;word-spacing:1.88px;}
#t11_55{left:152px;bottom:792px;letter-spacing:0.02px;word-spacing:2.93px;}
#t12_55{left:494px;bottom:792px;letter-spacing:-0.03px;word-spacing:3.04px;}
#t13_55{left:152px;bottom:774px;letter-spacing:0.04px;word-spacing:1.76px;}
#t14_55{left:220px;bottom:742px;letter-spacing:0.12px;}
#t15_55{left:704px;bottom:742px;}
#t16_55{left:450px;bottom:724px;letter-spacing:-0.16px;}
#t17_55{left:437px;bottom:707px;letter-spacing:-0.23px;}
#t18_55{left:314px;bottom:665px;letter-spacing:-0.26px;word-spacing:1.97px;}
#t19_55{left:110px;bottom:625px;letter-spacing:-0.11px;}
#t1a_55{left:127px;bottom:625px;letter-spacing:-0.17px;}
#t1b_55{left:176px;bottom:625px;letter-spacing:-0.16px;word-spacing:1.53px;}
#t1c_55{left:110px;bottom:605px;letter-spacing:-0.15px;word-spacing:1.66px;}
#t1d_55{left:306px;bottom:605px;letter-spacing:-0.17px;}
#t1e_55{left:356px;bottom:605px;letter-spacing:-0.14px;word-spacing:1.63px;}
#t1f_55{left:110px;bottom:584px;letter-spacing:-0.14px;word-spacing:1.39px;}
#t1g_55{left:110px;bottom:548px;letter-spacing:-0.11px;}
#t1h_55{left:127px;bottom:548px;letter-spacing:-0.17px;}
#t1i_55{left:177px;bottom:548px;letter-spacing:-0.16px;word-spacing:2.1px;}
#t1j_55{left:110px;bottom:527px;letter-spacing:-0.15px;word-spacing:0.76px;}
#t1k_55{left:534px;bottom:527px;letter-spacing:-0.18px;}
#t1l_55{left:582px;bottom:527px;letter-spacing:-0.16px;word-spacing:0.76px;}
#t1m_55{left:110px;bottom:507px;letter-spacing:-0.13px;word-spacing:1.73px;}
#t1n_55{left:539px;bottom:507px;letter-spacing:-0.18px;}
#t1o_55{left:580px;bottom:507px;letter-spacing:-0.12px;word-spacing:1.7px;}
#t1p_55{left:110px;bottom:486px;letter-spacing:-0.14px;}
#t1q_55{left:110px;bottom:450px;letter-spacing:-0.19px;}
#t1r_55{left:144px;bottom:450px;letter-spacing:-0.17px;}
#t1s_55{left:194px;bottom:450px;letter-spacing:-0.13px;word-spacing:1.47px;}
#t1t_55{left:110px;bottom:429px;letter-spacing:-0.14px;word-spacing:0.91px;}
#t1u_55{left:274px;bottom:429px;letter-spacing:-0.17px;}
#t1v_55{left:315px;bottom:429px;letter-spacing:-0.14px;word-spacing:1.22px;}
#t1w_55{left:670px;bottom:429px;letter-spacing:-0.18px;}
#t1x_55{left:718px;bottom:429px;letter-spacing:-0.14px;word-spacing:0.91px;}
#t1y_55{left:110px;bottom:409px;letter-spacing:-0.16px;word-spacing:1.57px;}
#t1z_55{left:598px;bottom:409px;letter-spacing:-0.18px;}
#t20_55{left:648px;bottom:409px;letter-spacing:-0.17px;word-spacing:1.61px;}
#t21_55{left:110px;bottom:388px;letter-spacing:-0.12px;}
#t22_55{left:152px;bottom:352px;letter-spacing:-0.14px;word-spacing:1.4px;}
#t23_55{left:152px;bottom:331px;letter-spacing:-0.14px;word-spacing:1.39px;}
#t24_55{left:152px;bottom:311px;letter-spacing:-0.15px;word-spacing:1.39px;}
#t25_55{left:110px;bottom:275px;letter-spacing:-0.26px;word-spacing:3.26px;}
#t26_55{left:281px;bottom:275px;letter-spacing:-0.17px;}
#t27_55{left:332px;bottom:275px;letter-spacing:-0.16px;word-spacing:3.09px;}
#t28_55{left:110px;bottom:254px;letter-spacing:-0.12px;word-spacing:1.34px;}
#t29_55{left:152px;bottom:209px;letter-spacing:0.1px;word-spacing:2.07px;}
#t2a_55{left:402px;bottom:209px;letter-spacing:0.12px;}
#t2b_55{left:448px;bottom:209px;letter-spacing:-0.01px;word-spacing:2.31px;}
#t2c_55{left:152px;bottom:191px;letter-spacing:0.06px;word-spacing:0.72px;}
#t2d_55{left:152px;bottom:173px;word-spacing:1.7px;}
#t2e_55{left:152px;bottom:155px;letter-spacing:0.05px;word-spacing:2.43px;}
#t2f_55{left:152px;bottom:136px;letter-spacing:0.04px;word-spacing:1.76px;}

.s1_55{font-size:17px;font-family:CMSL10_1g7;color:#000;}
.s2_55{font-size:17px;font-family:CMR10_1fw;color:#000;}
.s3_55{font-size:18px;font-family:CMBX12_1fi;color:#000;}
.s4_55{font-size:18px;font-family:CMTT12_1gn;color:#000;}
.s5_55{font-size:17px;font-family:CMTT10_1gl;color:#000;}
.s6_55{font-size:17px;font-family:CMR10_1fw;color:#000080;}
.s7_55{font-size:15px;font-family:CMTI10_1gf;color:#000;}
.s8_55{font-size:15px;font-family:CMTT10_1gl;color:#000;}
.s9_55{font-size:12px;font-family:CMR8_1g3;color:#000;}
.sa_55{font-size:14px;font-family:CMTT9_1gr;color:#000;}
.sb_55{font-size:14px;font-family:CMR9_1g5;color:#000;}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts55" type="text/css" >

@font-face {
	font-family: CMBX12_1fi;
	src: url("fonts/CMBX12_1fi.woff") format("woff");
}

@font-face {
	font-family: CMR10_1fw;
	src: url("fonts/CMR10_1fw.woff") format("woff");
}

@font-face {
	font-family: CMR8_1g3;
	src: url("fonts/CMR8_1g3.woff") format("woff");
}

@font-face {
	font-family: CMR9_1g5;
	src: url("fonts/CMR9_1g5.woff") format("woff");
}

@font-face {
	font-family: CMSL10_1g7;
	src: url("fonts/CMSL10_1g7.woff") format("woff");
}

@font-face {
	font-family: CMTI10_1gf;
	src: url("fonts/CMTI10_1gf.woff") format("woff");
}

@font-face {
	font-family: CMTT10_1gl;
	src: url("fonts/CMTT10_1gl.woff") format("woff");
}

@font-face {
	font-family: CMTT12_1gn;
	src: url("fonts/CMTT12_1gn.woff") format("woff");
}

@font-face {
	font-family: CMTT9_1gr;
	src: url("fonts/CMTT9_1gr.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg55Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg55" style="-webkit-user-select: none;"><object width="935" height="1210" data="55/55.svg" type="image/svg+xml" id="pdf55" style="width:935px; height:1210px; -moz-transform:scale(1); z-index: 0;"></object></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_55" class="t s1_55">Volume II: RISC-V Privileged Architectures V20211203 </span><span id="t2_55" class="t s2_55">41 </span>
<span id="t3_55" class="t s3_55">3.1.16 </span><span id="t4_55" class="t s3_55">Machine Trap Value Register (</span><span id="t5_55" class="t s4_55">mtval</span><span id="t6_55" class="t s3_55">) </span>
<span id="t7_55" class="t s2_55">The </span><span id="t8_55" class="t s5_55">mtval </span><span id="t9_55" class="t s2_55">register is an MXLEN-bit read-write register formatted as shown in Figure </span><span id="ta_55" class="t s6_55">3.23</span><span id="tb_55" class="t s2_55">. When a </span>
<span id="tc_55" class="t s2_55">trap is taken into M-mode, </span><span id="td_55" class="t s5_55">mtval </span><span id="te_55" class="t s2_55" data-mappings='[[53,"fi"]]'>is either set to zero or written with exception-speciﬁc information </span>
<span id="tf_55" class="t s2_55">to assist software in handling the trap. Otherwise, </span><span id="tg_55" class="t s5_55">mtval </span><span id="th_55" class="t s2_55">is never written by the implementation, </span>
<span id="ti_55" class="t s2_55">though it may be explicitly written by software. The hardware platform will specify which excep- </span>
<span id="tj_55" class="t s2_55">tions must set </span><span id="tk_55" class="t s5_55">mtval </span><span id="tl_55" class="t s2_55">informatively and which may unconditionally set it to zero. If the hardware </span>
<span id="tm_55" class="t s2_55" data-mappings='[[14,"fi"]]'>platform speciﬁes that no exceptions set </span><span id="tn_55" class="t s5_55">mtval </span><span id="to_55" class="t s2_55">to a nonzero value, then </span><span id="tp_55" class="t s5_55">mtval </span><span id="tq_55" class="t s2_55">is read-only zero. </span>
<span id="tr_55" class="t s2_55">If </span><span id="ts_55" class="t s5_55">mtval </span><span id="tt_55" class="t s2_55">is written with a nonzero value when a breakpoint, address-misaligned, access-fault, or </span>
<span id="tu_55" class="t s2_55">page-fault exception occurs on an instruction fetch, load, or store, then </span><span id="tv_55" class="t s5_55">mtval </span><span id="tw_55" class="t s2_55">will contain the </span>
<span id="tx_55" class="t s2_55">faulting virtual address. </span>
<span id="ty_55" class="t s7_55">When page-based virtual memory is enabled, </span><span id="tz_55" class="t s8_55">mtval </span><span id="t10_55" class="t s7_55">is written with the faulting virtual address, </span>
<span id="t11_55" class="t s7_55">even for physical-memory access-fault exceptions. </span><span id="t12_55" class="t s7_55">This design reduces datapath cost for most </span>
<span id="t13_55" class="t s7_55">implementations, particularly those with hardware page-table walkers. </span>
<span id="t14_55" class="t s9_55">MXLEN-1 </span><span id="t15_55" class="t s9_55">0 </span>
<span id="t16_55" class="t sa_55">mtval </span>
<span id="t17_55" class="t sb_55">MXLEN </span>
<span id="t18_55" class="t s2_55">Figure 3.23: Machine Trap Value register. </span>
<span id="t19_55" class="t s2_55">If </span><span id="t1a_55" class="t s5_55">mtval </span><span id="t1b_55" class="t s2_55">is written with a nonzero value when a misaligned load or store causes an access-fault or </span>
<span id="t1c_55" class="t s2_55">page-fault exception, then </span><span id="t1d_55" class="t s5_55">mtval </span><span id="t1e_55" class="t s2_55">will contain the virtual address of the portion of the access that </span>
<span id="t1f_55" class="t s2_55">caused the fault. </span>
<span id="t1g_55" class="t s2_55">If </span><span id="t1h_55" class="t s5_55">mtval </span><span id="t1i_55" class="t s2_55">is written with a nonzero value when an instruction access-fault or page-fault exception </span>
<span id="t1j_55" class="t s2_55">occurs on a system with variable-length instructions, then </span><span id="t1k_55" class="t s5_55">mtval </span><span id="t1l_55" class="t s2_55">will contain the virtual address of </span>
<span id="t1m_55" class="t s2_55">the portion of the instruction that caused the fault, while </span><span id="t1n_55" class="t s5_55">mepc </span><span id="t1o_55" class="t s2_55">will point to the beginning of the </span>
<span id="t1p_55" class="t s2_55">instruction. </span>
<span id="t1q_55" class="t s2_55">The </span><span id="t1r_55" class="t s5_55">mtval </span><span id="t1s_55" class="t s2_55">register can optionally also be used to return the faulting instruction bits on an illegal </span>
<span id="t1t_55" class="t s2_55">instruction exception (</span><span id="t1u_55" class="t s5_55">mepc </span><span id="t1v_55" class="t s2_55">points to the faulting instruction in memory). If </span><span id="t1w_55" class="t s5_55">mtval </span><span id="t1x_55" class="t s2_55">is written with </span>
<span id="t1y_55" class="t s2_55">a nonzero value when an illegal-instruction exception occurs, then </span><span id="t1z_55" class="t s5_55">mtval </span><span id="t20_55" class="t s2_55">will contain the shortest </span>
<span id="t21_55" class="t s2_55">of: </span>
<span id="t22_55" class="t s2_55">the actual faulting instruction </span>
<span id="t23_55" class="t s2_55" data-mappings='[[4,"fi"]]'>the ﬁrst ILEN bits of the faulting instruction </span>
<span id="t24_55" class="t s2_55" data-mappings='[[4,"fi"]]'>the ﬁrst MXLEN bits of the faulting instruction </span>
<span id="t25_55" class="t s2_55">The value loaded into </span><span id="t26_55" class="t s5_55">mtval </span><span id="t27_55" class="t s2_55" data-mappings='[[50,"fi"]]'>on an illegal-instruction exception is right-justiﬁed and all unused </span>
<span id="t28_55" class="t s2_55">upper bits are cleared to zero. </span>
<span id="t29_55" class="t s7_55">Capturing the faulting instruction in </span><span id="t2a_55" class="t s8_55">mtval </span><span id="t2b_55" class="t s7_55">reduces the overhead of instruction emulation, po- </span>
<span id="t2c_55" class="t s7_55">tentially avoiding several partial instruction loads if the instruction is misaligned, and likely data </span>
<span id="t2d_55" class="t s7_55">cache misses or slow uncached accesses when loads are used to fetch the instruction into a data </span>
<span id="t2e_55" class="t s7_55">register. There is also a problem of atomicity if another agent is manipulating the instruction </span>
<span id="t2f_55" class="t s7_55">memory, as might occur in a dynamic translation system. </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
